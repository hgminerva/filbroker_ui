/*
    *
    * Wijmo Library 5.20173.380
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,l=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(l=(r<3?n(l):r>3?n(t,o,l):n(t,o))||l);return r>3&&l&&Object.defineProperty(t,o,l),l},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};define("wijmo/wijmo.angular2.grid",["require","exports","@angular/core","@angular/core","@angular/core","@angular/common","@angular/forms","wijmo/wijmo.angular2.directiveBase"],function(e,t,o,i,n,r,l,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wjFlexGridMeta={selector:"wj-flex-grid",template:"<div><ng-content></ng-content></div>",inputs:["wjModelProperty","isDisabled","newRowAtTop","allowAddNew","allowDelete","allowDragging","allowMerging","allowResizing","allowSorting","quickAutoSize","autoSizeMode","autoGenerateColumns","childItemsPath","groupHeaderFormat","headersVisibility","showSelectedHeaders","showMarquee","itemFormatter","isReadOnly","imeEnabled","mergeManager","selectionMode","showGroups","showSort","showDropDown","showAlternatingRows","showErrors","validateEdits","treeIndent","itemsSource","autoClipboard","frozenRows","frozenColumns","cloneFrozenCells","deferResizing","sortRowIndex","stickyHeaders","preserveSelectedState","preserveOutlineState","keyActionTab","keyActionEnter","rowHeaderPath","virtualizationThreshold"],outputs:["initialized","gotFocusNg: gotFocus","lostFocusNg: lostFocus","beginningEditNg: beginningEdit","cellEditEndedNg: cellEditEnded","cellEditEndingNg: cellEditEnding","prepareCellForEditNg: prepareCellForEdit","formatItemNg: formatItem","resizingColumnNg: resizingColumn","resizedColumnNg: resizedColumn","autoSizingColumnNg: autoSizingColumn","autoSizedColumnNg: autoSizedColumn","draggingColumnNg: draggingColumn","draggingColumnOverNg: draggingColumnOver","draggedColumnNg: draggedColumn","sortingColumnNg: sortingColumn","sortedColumnNg: sortedColumn","resizingRowNg: resizingRow","resizedRowNg: resizedRow","autoSizingRowNg: autoSizingRow","autoSizedRowNg: autoSizedRow","draggingRowNg: draggingRow","draggingRowOverNg: draggingRowOver","draggedRowNg: draggedRow","deletingRowNg: deletingRow","deletedRowNg: deletedRow","loadingRowsNg: loadingRows","loadedRowsNg: loadedRows","rowEditStartingNg: rowEditStarting","rowEditStartedNg: rowEditStarted","rowEditEndingNg: rowEditEnding","rowEditEndedNg: rowEditEnded","rowAddedNg: rowAdded","groupCollapsedChangedNg: groupCollapsedChanged","groupCollapsedChangingNg: groupCollapsedChanging","itemsSourceChangedNg: itemsSourceChanged","selectionChangingNg: selectionChanging","selectionChangedNg: selectionChanged","scrollPositionChangedNg: scrollPositionChanged","updatingViewNg: updatingView","updatedViewNg: updatedView","updatingLayoutNg: updatingLayout","updatedLayoutNg: updatedLayout","pastingNg: pasting","pastedNg: pasted","pastingCellNg: pastingCell","pastedCellNg: pastedCell","copyingNg: copying","copiedNg: copied"],providers:[{provide:l.NG_VALUE_ACCESSOR,useFactory:a.WjValueAccessorFactory,multi:!0,deps:["WjComponent"]}]};var d=function(e){function r(t,o,i,n){var r=e.call(this,a.WjDirectiveBehavior.getHostElement(t,o))||this;r.isInitialized=!1;r._wjBehaviour=a.WjDirectiveBehavior.attach(r,t,o,i);return new c(r,n),r.deferUpdate(function(){if(r.rows.defaultSize<10){var e=r.hostElement,t=getComputedStyle(e),o=getComputedStyle(document.body),i=2*parseInt(t.fontSize&&wijmo.contains(document.body,e)?t.fontSize:o.fontSize);r.rows.defaultSize=i,r.columns.defaultSize=4*i,r.columnHeaders.rows.defaultSize=i,r.rowHeaders.columns.defaultSize=Math.round(1.25*i)}}),r.created(),r}return __extends(r,e),l=r,r.prototype.created=function(){},r.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},r.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},r.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},r.prototype.addEventListener=function(t,o,i,n){var r=this;void 0===n&&(n=!1);var l=a.WjDirectiveBehavior,d=l.ngZone;d&&l.outsideZoneEvents[o]?d.runOutsideAngular(function(){e.prototype.addEventListener.call(r,t,o,i,n)}):e.prototype.addEventListener.call(this,t,o,i,n)},r.meta={outputs:t.wjFlexGridMeta.outputs},r=l=__decorate([o.Component({selector:t.wjFlexGridMeta.selector,template:t.wjFlexGridMeta.template,inputs:t.wjFlexGridMeta.inputs,outputs:t.wjFlexGridMeta.outputs,providers:[{provide:"WjComponent",useExisting:i.forwardRef(function(){return l})}].concat(t.wjFlexGridMeta.providers)}),__param(0,n.Inject(i.ElementRef)),__param(1,n.Inject(i.Injector)),__param(2,n.Inject("WjComponent")),__param(2,n.SkipSelf()),__param(2,i.Optional()),__param(3,n.Inject(n.ChangeDetectorRef))],r);var l}(wijmo.grid.FlexGrid);t.WjFlexGrid=d,t.wjFlexGridColumnMeta={selector:"wj-flex-grid-column",template:"<div><ng-content></ng-content></div>",inputs:["asyncBindings","wjProperty","name","dataMap","dataType","binding","sortMemberPath","format","header","width","maxLength","minWidth","maxWidth","align","allowDragging","allowSorting","allowResizing","allowMerging","aggregate","isReadOnly","cssClass","isContentHtml","isSelected","visible","wordWrap","mask","inputType","isRequired","showDropDown","dropDownCssClass","quickAutoSize"],outputs:["initialized","isSelectedChangePC: isSelectedChange"],providers:[]};var s=function(e){function r(t,o,i){var n=e.call(this)||this;n.isInitialized=!1,n.wjProperty="columns";var r=(n._wjBehaviour=a.WjDirectiveBehavior.attach(n,t,o,i)).parentBehavior.directive;return r.autoGenerateColumns&&(r.autoGenerateColumns=!1,r.columns.clear()),n.created(),n}return __extends(r,e),l=r,r.prototype.created=function(){},r.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},r.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},r.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},r.meta={outputs:t.wjFlexGridColumnMeta.outputs,changeEvents:{"grid.selectionChanged":["isSelected"]}},r=l=__decorate([o.Component({selector:t.wjFlexGridColumnMeta.selector,template:t.wjFlexGridColumnMeta.template,inputs:t.wjFlexGridColumnMeta.inputs,outputs:t.wjFlexGridColumnMeta.outputs,providers:[{provide:"WjComponent",useExisting:i.forwardRef(function(){return l})}].concat(t.wjFlexGridColumnMeta.providers)}),__param(0,n.Inject(i.ElementRef)),__param(1,n.Inject(i.Injector)),__param(2,n.Inject("WjComponent")),__param(2,n.SkipSelf()),__param(2,i.Optional())],r);var l}(wijmo.grid.Column);t.WjFlexGridColumn=s;var u=function(){function e(e,t,o,i,n,r,l){this.viewContainerRef=e,this.templateRef=t,this.elRef=o,this.domRenderer=n,this.cdRef=l,this.autoSizeRows=!0,this.forceFullEdit=!0,i instanceof d?this.grid=i:i instanceof s&&(this.column=i,this.grid=a.WjDirectiveBehavior.getBehavior(i).parentBehavior.directive)}return t=e,e._getTemplContextProp=function(e){return"$__cellTempl"+p[e]},e.prototype.ngOnInit=function(){this.ownerControl=this.column&&this.column.grid===this.grid?this.column:this.grid,this._attachToControl()},e.prototype.ngOnDestroy=function(){this.cellTypeStr&&(this.viewContainerRef.clear(),this.ownerControl[t._getTemplContextProp(this.cellType)]=null,this.grid.invalidate())},e.prototype._instantiateTemplate=function(e,t){return a.WjDirectiveBehavior.instantiateTemplate(e,this.viewContainerRef,this.templateRef,this.domRenderer,!1,t)},e.prototype._attachToControl=function(){if(this.cellTypeStr){var e=this.cellType=wijmo.asEnum(this.cellTypeStr,p),o=this.ownerControl;o[t._getTemplContextProp(e)]=this,o instanceof wijmo.grid.Column&&(e===p.Cell||e===p.ColumnHeader||e===p.ColumnFooter)&&o._setFlag(wijmo.grid.RowColFlags.HasTemplate,!0),this.grid.invalidate()}},e=t=__decorate([i.Directive({selector:"[wjFlexGridCellTemplate]",inputs:["wjFlexGridCellTemplate","cellTypeStr: cellType","cellOverflow","valuePaths","autoSizeRows","forceFullEdit"],exportAs:"wjFlexGridCellTemplate",providers:[{provide:"WjComponent",useExisting:i.forwardRef(function(){return t})}]}),__param(0,n.Inject(i.ViewContainerRef)),__param(1,n.Inject(i.TemplateRef)),__param(1,i.Optional()),__param(2,n.Inject(i.ElementRef)),__param(3,n.Inject("WjComponent")),__param(3,n.SkipSelf()),__param(3,i.Optional()),__param(4,n.Inject(i.Renderer)),__param(5,n.Inject(i.Injector)),__param(6,n.Inject(n.ChangeDetectorRef))],e);var t}();t.WjFlexGridCellTemplate=u;var p;!function(e){e[e.Cell=0]="Cell",e[e.CellEdit=1]="CellEdit",e[e.ColumnHeader=2]="ColumnHeader",e[e.RowHeader=3]="RowHeader",e[e.RowHeaderEdit=4]="RowHeaderEdit",e[e.TopLeft=5]="TopLeft",e[e.GroupHeader=6]="GroupHeader",e[e.Group=7]="Group",e[e.NewCellTemplate=8]="NewCellTemplate",e[e.ColumnFooter=9]="ColumnFooter",e[e.BottomLeft=10]="BottomLeft"}(p=t.CellTemplateType||(t.CellTemplateType={}));var c=function(e){function t(o,i){var n=e.call(this)||this;if(n._needsCdCheck=!1,n._lastApplyTimeStamp=0,n._noApplyLag=!1,n._startingEditing=!1,n._cellStampCounter=0,n._composing=!1,n.grid=o,n._gridCdRef=i,!t._templateTypes){t._templateTypes=[];for(var r in p)isNaN(r)&&t._templateTypes.push(r)}var l=n;return n._baseCf=o.cellFactory,o.cellFactory=n,n._evtInput=document.createEvent("HTMLEvents"),n._evtInput.initEvent("input",!0,!1),n._evtBlur=document.createEvent("HTMLEvents"),n._evtBlur.initEvent("blur",!1,!1),o.prepareCellForEdit.addHandler(function(e,t){l._noApplyLag=!0}),o.cellEditEnded.addHandler(function(e,t){(t.range.col<0||t.range.col<o.columns.length&&!o.columns[t.range.col][u._getTemplContextProp(p.CellEdit)])&&(l._editChar=null),setTimeout(function(){l._noApplyLag=!1},300)}),o.beginningEdit.addHandler(function(e,t){l._startingEditing=!0}),o.hostElement.addEventListener("keydown",function(e){l._startingEditing=!1},!0),o.hostElement.addEventListener("keypress",function(e){var t=e.charCode>32?String.fromCharCode(e.charCode):null;t&&(!o.activeEditor||l._startingEditing?l._editChar=t:l._editChar&&(l._editChar+=t))},!0),o.hostElement.addEventListener("compositionstart",function(e){l._composing=!0},!0),o.hostElement.addEventListener("compositionend",function(e){l._composing=!1},!0),o.updatedView.addHandler(function(){n._needsCdCheck&&(n._needsCdCheck=!1,n._gridCdRef.markForCheck())},n),n}return __extends(t,e),t.prototype.updateCell=function(e,o,i,n,r){var l=this;this._cellStampCounter=(this._cellStampCounter+1)%1e7;var a=n[t._cellStampProp]=this._cellStampCounter;n.style.overflow&&(n.style.overflow="");var d,s=this,c=e.grid,g=c.editRange,m=e.rows[o],f=m.dataItem,w=!1,C=!1,v=!1,h=!1;switch(e.cellType){case wijmo.grid.CellType.Cell:if(g&&g.row===o&&g.col===i)d=p.CellEdit,C=v=!0;else if(m instanceof wijmo.grid.GroupRow){var _=!((h=f instanceof wijmo.collections.CollectionViewGroup)||m.hasChildren);i==e.columns.firstVisibleIndex?d=_?p.Cell:p.GroupHeader:(d=_?p.Cell:p.Group,C=!0)}else m instanceof wijmo.grid._NewRowTemplate?d=p.NewCellTemplate:wijmo.grid.detail&&wijmo.grid.detail.DetailRow&&m instanceof wijmo.grid.detail.DetailRow||(d=p.Cell);break;case wijmo.grid.CellType.ColumnHeader:d=p.ColumnHeader;break;case wijmo.grid.CellType.RowHeader:d=c.collectionView&&c.collectionView.currentEditItem===f?p.RowHeaderEdit:p.RowHeader,w=!0;break;case wijmo.grid.CellType.TopLeft:d=p.TopLeft,w=!0;break;case wijmo.grid.CellType.ColumnFooter:d=p.ColumnFooter,C=!0;break;case wijmo.grid.CellType.BottomLeft:d=p.BottomLeft,w=!0}var E=!1;if(null!=d){var y=h&&d==p.GroupHeader?c.columns.getColumn(f.groupDescription.propertyName):i>=0&&i<e.columns.length?e.columns[i]:null;if(y){var j=u._getTemplContextProp(d),R=(w?c:y)[j];if(R||(d===p.RowHeaderEdit?(d=p.RowHeader,j=u._getTemplContextProp(d),R=c[j]):d!==p.Group&&d!==p.GroupHeader||h||(d=p.Cell,j=u._getTemplContextProp(d),R=y[j])),R){var S;C&&(S=e.getCellData(o,i,!1)),E=!0;var T=n.getAttribute(wijmo.grid.FlexGrid._WJS_MEASURE),x=T&&"true"===T.toLowerCase();v&&this._baseCf.updateCell(e,o,i,n,r,!0);var N,I=n[j]||{},F=I.column!==y||!I.viewRef||I.templateContextProperty!==j||n.firstChild!=I.rootElement,H=v&&this._composing&&c.imeEnabled;if(F){if(v){var z=n.firstElementChild;z&&(H||n.focus(),z.style.display="none")}else n.textContent="";this._doDisposeCell(n);var b={};N=this._setViewRefContext(b,m,y,f,S,R.valuePaths);var G=R._instantiateTemplate(n,b);I.column=y,I.viewRef=G.viewRef,I.rootElement=G.rootElement,I.templateContextProperty=j,n[j]=I}else N=this._setViewRefContext(I.viewRef.context,m,y,f,S,R.valuePaths);if(R.cellOverflow&&(n.style.overflow=R.cellOverflow),x?R.cdRef.detectChanges():R.autoSizeRows&&!H?setTimeout(function(){if(a===n[t._cellStampProp]){var i=n.scrollHeight,d=e.rows,u=r&&r.rowSpan||1;if(o<d.length&&d[o].renderHeight*u<i-1){if(d.defaultSize=i/u,v){var p=s._isFullEdit();return c.refresh(),void c.startEditing(p)}}else v&&l._initEditInput(I,R,null)}},0):v&&setTimeout(function(){H?l._initImeEditInput(I,R):l._initEditInput(I,R,null)},0),v){s._cellEditorVars=N.localVars;var O=function(e,t){if(c.cellEditEnding.removeHandler(O),!t.stayInEditMode){var o=wijmo.getActiveElement();o&&o.dispatchEvent(s._evtBlur),n.focus()}if(s._triggerEditorEvents(n),!t.cancel&&!t.stayInEditMode)for(var i=N.localVars,r=0,l=Object.getOwnPropertyNames(N.bindings);r<l.length;r++){var a=l[r];N.bindings[a].setValue(i,N.localVars.values[a])}var d=n.querySelectorAll(".wj-dropdown");[].forEach.call(d,function(e){var t=wijmo.Control.getControl(e);t&&wijmo.input&&t instanceof wijmo.input.DropDown&&(t.isDroppedDown=!1)})},D=function(e,t){c.cellEditEnded.removeHandler(D),s._cellEditorVars=null};c.cellEditEnding.addHandler(O),c.cellEditEnded.addHandler(D)}else this._baseCf.updateCell(e,o,i,n,r,!1)}}}E||(this._doDisposeCell(n),this._baseCf.updateCell(e,o,i,n,r))},t.prototype.getEditorValue=function(t){if(this._cellEditorVars){var o=t.editRange;return o&&o.isValid&&this._triggerEditorEvents(t.cells.getCellElement(o.row,o.col)),this._cellEditorVars.value}return e.prototype.getEditorValue.call(this,t)},t.prototype.disposeCell=function(e){this._doDisposeCell(e)},t.prototype._doDisposeCell=function(e){for(var o=t._templateTypes,i=0;i<o.length;i++){var n=u._getTemplContextProp(p[o[i]]),r=e[n];if(r&&r.viewRef){var l=(r.column||this.grid)[n];if(l){var a=l.viewContainerRef.indexOf(r.viewRef);a>-1&&l.viewContainerRef.remove(a)}r.viewRef=null,r.rootElement=null,r.column=null,r.templateContextProperty=null,e[n]=null}}},t.prototype._setViewRefContext=function(e,t,o,i,n,r){this._needsCdCheck=!0,e.row=t,e.col=o,e.item=i;var l={},a=e.cell||{},d={},s={localVars:a,bindings:d};if(a.row=t,a.col=o,a.item=i,a.value=n,a.values=l,r)for(var u=0,p=Object.getOwnPropertyNames(r);u<p.length;u++){var c=p[u],g=new wijmo.Binding(r[c]);d[c]=g,l[c]=g.getValue(a)}return e.cell!==a&&(e.cell=a),s},t.prototype._initEditInput=function(e,t,o){var i=this;this._setFullEdit(t);var n=this._findInitialInput(e);if(n){var r=window.getComputedStyle(n);if("none"!==r.display&&"visible"===r.visibility){var l=function(){n.removeEventListener("focus",l),setTimeout(function(){setTimeout(function(){var e=null!=o?o:i._editChar;if(e){var t=n.selectionStart+e.length;n.value=e,i._editChar=null,n.dispatchEvent(i._evtInput),setTimeout(function(){setTimeout(function(){wijmo.setSelectionRange(n,Math.min(t,n.value.length),n.value.length)},0)},0)}},0)},0)};n.addEventListener("focus",l),n.focus()}}},t.prototype._initImeEditInput=function(e,t){var o=this,i=wijmo.getActiveElement();if(i&&i instanceof HTMLInputElement&&wijmo.hasClass(i,"wj-grid-ime")){var n=function(r){i.removeEventListener("compositionend",n),wijmo.setCss(i,wijmo.grid._ImeHandler._cssHidden),o._initEditInput(e,t,i.value)};i.addEventListener("compositionend",n);var r=this._findInitialInput(e);if(r){var l=r.getBoundingClientRect(),a=i.getBoundingClientRect(),d=window.getComputedStyle(i),s=parseFloat(d.left),u=parseFloat(d.top);wijmo.setCss(i,{left:s+l.left-a.left+"px",top:u+l.top-a.top+"px",width:l.width+"px",height:l.height+"px"})}}},t.prototype._findInitialInput=function(e){var t=e&&e.rootElement&&e.rootElement.querySelectorAll("input");if(t)for(var o=0;o<t.length;o++){var i=t[o],n=window.getComputedStyle(i);if("none"!==n.display&&"visible"===n.visibility)return i}return null},t.prototype._triggerEditorEvents=function(e){if(e)for(var t=e.querySelectorAll(".wj-control"),o=0;o<t.length;o++){var i=t[o],n=wijmo.Control.getControl(i);if(n){var r=a.WjDirectiveBehavior.getBehavior(n);r&&r.flushPendingEvents()}}},t.prototype._isFullEdit=function(){var e=this.grid;return!e.activeEditor||e._edtHdl._fullEdit},t.prototype._setFullEdit=function(e){var t=this.grid;e.forceFullEdit&&t.activeEditor&&(t._edtHdl._fullEdit=!0)},t._cellStampProp="__wjCellStamp",t}(wijmo.grid.CellFactory),g=[d,s,u],m=function(){function e(){}return e=__decorate([o.NgModule({imports:[a.WjDirectiveBaseModule,r.CommonModule],declarations:g.slice(),exports:g.slice()})],e)}();t.WjGridModule=m});