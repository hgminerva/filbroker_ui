/*
    *
    * Wijmo Library 5.20173.380
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),wijmo;!function(e){!function(t){!function(r){"use strict";var i=function(r){function i(i,n){var o=r.call(this,i)||this;o._hideGroupedCols=!0,o._maxGroups=6;e.assert(null!=t,"Missing dependency: GroupPanel requires wijmo.grid.");var s=o.getTemplate();o.applyTemplate("wj-grouppanel wj-control",s,{_divMarkers:"div-markers",_divPH:"div-ph"});var a=o.hostElement;return o.addEventListener(a,"dragstart",o._dragStart.bind(o)),o.addEventListener(a,"dragover",o._dragOver.bind(o)),o.addEventListener(a,"drop",o._drop.bind(o)),o.addEventListener(a,"dragend",o._dragEnd.bind(o)),o.addEventListener(a,"click",o._click.bind(o)),o.initialize(n),o}return __extends(i,r),Object.defineProperty(i.prototype,"hideGroupedColumns",{get:function(){return this._hideGroupedCols},set:function(t){t!=this._hideGroupedCols&&(this._hideGroupedCols=e.asBoolean(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxGroups",{get:function(){return this._maxGroups},set:function(t){t!=this._maxGroups&&(this._maxGroups=e.asNumber(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"placeholder",{get:function(){return this._divPH.textContent},set:function(e){this._divPH.textContent=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"grid",{get:function(){return this._g},set:function(r){(r=e.asType(r,t.FlexGrid,!0))!=this._g&&(this._g&&(this._g.draggingColumn.removeHandler(this._draggingColumn),this._g.sortedColumn.removeHandler(this.invalidate),this._g.itemsSourceChanged.removeHandler(this._itemsSourceChanged),this._g.columns.collectionChanged.removeHandler(this._itemsSourceChanged)),this._g=r,this._g&&(this._g.draggingColumn.addHandler(this._draggingColumn,this),this._g.sortedColumn.addHandler(this.invalidate,this),this._g.itemsSourceChanged.addHandler(this._itemsSourceChanged,this),this._g.columns.collectionChanged.addHandler(this._itemsSourceChanged,this)),this._itemsSourceChanged(this._g,null))},enumerable:!0,configurable:!0}),i.prototype.refresh=function(){if(r.prototype.refresh.call(this),this._divMarkers.innerHTML="",this._dragMarker=this._dragCol=null,this._gds){for(var t=0;t<this._gds.length;t++){for(var i=this._gds[t],n=this._g.columnHeaders,o=-1,s=-1,a=n.rows.length-1;a>=0&&s<0;a--)for(var d=0;d<n.columns.length&&s<0;d++){var l=this._g._getBindingColumn(n,a,n.columns[d]);if(l&&l.binding==i.propertyName){s=d,o=a;break}}if(s>-1&&o>-1){var h=document.createElement("div");this._g.cellFactory.updateCell(this._g.columnHeaders,o,s,h),h.setAttribute("class","wj-cell wj-header wj-groupmarker"),e.setCss(h,{position:"static",display:"inline-block",verticalAlign:"top",left:"",top:"",right:"",height:"auto",width:"auto"});var g=h.querySelector(".wj-elem-filter");g&&g.parentElement.removeChild(g);e.createElement('<span wj-remove="" style="font-weight:normal;cursor:pointer;pointer;padding:12px;padding-right:3px">&times;</span>',h);this._divMarkers.appendChild(h)}}this._divMarkers.children.length>0?(this._divPH.style.display="none",this._divMarkers.style.display=""):(this._divPH.style.display="",this._divMarkers.style.display="none")}},i.prototype._addGroup=function(t,r){for(var i=this._getIndex(r),n=this._gds,o=0;o<n.length;o++)if(n[o].propertyName==t.binding){n.removeAt(o),o<i&&i--;break}for(o=this.maxGroups-1;o<n.length;o++)this._removeGroup(o,n),o<i&&i--;n.deferUpdate(function(){var r=new e.collections.PropertyGroupDescription(t.binding);n.insert(i,r)}),t&&this.hideGroupedColumns&&(t.visible=!1),this.invalidate()},i.prototype._moveGroup=function(e,t){var r=this._gds,i=this._getElementIndex(this._dragMarker),n=this._getIndex(t);n>i&&n--,n>=this._gds.length&&(n=this._gds.length),i!=n&&r.deferUpdate(function(){var e=r[i];r.removeAt(i),r.insert(n,e)})},i.prototype._removeGroup=function(e,t){void 0===t&&(t=this._gds);var r=t[e].propertyName,i=this._g.columns.getColumn(r);t.removeAt(e),i&&(i.visible=!0)},i.prototype._getIndex=function(e){for(var t=this._divMarkers.children,r=0;r<t.length;r++){var i=t[r].getBoundingClientRect();if(e.clientX<i.left+i.width/2)return r}return t.length},i.prototype._getElementIndex=function(e){if(e&&e.parentElement)for(var t=e.parentElement.children,r=0;r<t.length;r++)if(t[r]==e)return r;return-1},i.prototype._draggingColumn=function(e,t){var r=this._g,i=r._getBindingColumn(t.panel,t.row,r.columns[t.col]);this._dragCol=i.binding?i:null},i.prototype._itemsSourceChanged=function(e,t){this._gds&&this._gds.collectionChanged.removeHandler(this._groupsChanged),this._gds=null,this._g.collectionView&&(this._gds=this._g.collectionView.groupDescriptions,this._gds.collectionChanged.addHandler(this._groupsChanged,this)),this.invalidate()},i.prototype._groupsChanged=function(e,t){this.invalidate()},i.prototype._dragStart=function(t){e._startDrag(t.dataTransfer,"move"),this._dragMarker=t.target,this._dragCol=null},i.prototype._dragOver=function(e){(this._dragCol||this._dragMarker)&&(e.dataTransfer.dropEffect="move",e.preventDefault(),e.stopPropagation())},i.prototype._drop=function(e){this._dragMarker?this._moveGroup(this._dragMarker,e):this._dragCol&&this._addGroup(this._dragCol,e)},i.prototype._dragEnd=function(e){this._dragMarker=this._dragCol=null},i.prototype._click=function(t){for(var r=document.elementFromPoint(t.clientX,t.clientY),i=null!=r.getAttribute("wj-remove"),n=r;n.parentElement&&!e.hasClass(n,"wj-cell");)n=n.parentElement;if(e.hasClass(n,"wj-cell")){var o=this._getElementIndex(n),s=this._g.collectionView.sortDescriptions;if(i)this._removeGroup(o);else if(t.ctrlKey)s.clear(),this.invalidate();else{for(var a=this._gds[o],d=!0,l=0;l<s.length;l++)if(s[l].property==a.propertyName){d=!s[l].ascending;break}var h=new e.collections.SortDescription(a.propertyName,d);s.splice(0,s.length,h),this.invalidate()}}},i.controlTemplate='<div style="cursor:default;overflow:hidden;height:100%;width:100%;min-height:1em"><div wj-part="div-ph"></div><div wj-part="div-markers"></div></div>',i}(e.Control);r.GroupPanel=i}(t.grouppanel||(t.grouppanel={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));