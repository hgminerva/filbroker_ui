/*
    *
    * Wijmo Library 5.20173.380
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","wijmo/wijmo","wijmo/wijmo.grid"],function(e,t,i,o){"use strict";function n(){var e;return(e=window.wijmo)&&e.input}Object.defineProperty(t,"__esModule",{value:!0}),window.wijmo=window.wijmo||{},window.wijmo.grid=o,i.culture.FlexGrid=window.wijmo.culture.FlexGrid||{groupHeaderFormat:"{name}: <b>{value}</b> ({count:n0} items)"};var r;!function(e){e[e.None=0]="None",e[e.Column=1]="Column",e[e.Row=2]="Row",e[e.All=3]="All"}(r=t.HeadersVisibility||(t.HeadersVisibility={}));var s=function(e){function t(t,o){var n=e.call(this,t,null,!0)||this;n._szClient=new i.Size(0,0),n._ptScrl=new i.Point(0,0),n._cellPadding=3,n._autoGenCols=!0,n._autoClipboard=!0,n._readOnly=!1,n._indent=14,n._autoSizeMode=O.Both,n._hdrVis=r.All,n._alSorting=!0,n._alAddNew=!1,n._alDelete=!1,n._alResizing=D.Columns,n._alDragging=j.Columns,n._alMerging=R.None,n._ssHdr=r.None,n._shSort=!0,n._shGroups=!0,n._shAlt=!0,n._shErr=!0,n._shDropDown=!0,n._valEdt=!0,n._deferResizing=!1,n._pSel=!0,n._pOutline=!0,n._vt=0,n.itemsSourceChanged=new i.Event,n.scrollPositionChanged=new i.Event,n.selectionChanging=new i.Event,n.selectionChanged=new i.Event,n.loadingRows=new i.Event,n.loadedRows=new i.Event,n.updatingLayout=new i.Event,n.updatedLayout=new i.Event,n.resizingColumn=new i.Event,n.resizedColumn=new i.Event,n.autoSizingColumn=new i.Event,n.autoSizedColumn=new i.Event,n.draggingColumn=new i.Event,n.draggingColumnOver=new i.Event,n.draggedColumn=new i.Event,n.resizingRow=new i.Event,n.resizedRow=new i.Event,n.autoSizingRow=new i.Event,n.autoSizedRow=new i.Event,n.draggingRow=new i.Event,n.draggingRowOver=new i.Event,n.draggedRow=new i.Event,n.groupCollapsedChanging=new i.Event,n.groupCollapsedChanged=new i.Event,n.sortingColumn=new i.Event,n.sortedColumn=new i.Event,n.beginningEdit=new i.Event,n.prepareCellForEdit=new i.Event,n.cellEditEnding=new i.Event,n.cellEditEnded=new i.Event,n.rowEditStarting=new i.Event,n.rowEditStarted=new i.Event,n.rowEditEnding=new i.Event,n.rowEditEnded=new i.Event,n.rowAdded=new i.Event,n.deletingRow=new i.Event,n.deletedRow=new i.Event,n.copying=new i.Event,n.copied=new i.Event,n.pasting=new i.Event,n.pasted=new i.Event,n.pastingCell=new i.Event,n.pastedCell=new i.Event,n.formatItem=new i.Event,n.updatingView=new i.Event,n.updatedView=new i.Event,n._mappedColumns=null;var s=n.hostElement;i.isIE()&&(s.style.borderRadius="0px");var l=n.getTemplate();n.applyTemplate("wj-control wj-flexgrid wj-content",l,{_root:"root",_eSz:"sz",_eCt:"cells",_fCt:"fcells",_eTL:"tl",_eBL:"bl",_eCHdr:"ch",_eRHdr:"rh",_eCFtr:"cf",_eTLCt:"tlcells",_eBLCt:"blcells",_eCHdrCt:"chcells",_eCFtrCt:"cfcells",_eRHdrCt:"rhcells",_eMarquee:"marquee",_eFocus:"focus"}),n._tabIndex=s.tabIndex,s.tabIndex=-1;var a=n._getDefaultRowHeight();return n.deferUpdate(function(){n._rows=new C(n,a),n._cols=new y(n,4*a),n._hdrRows=new C(n,a),n._hdrCols=new y(n,Math.round(1.25*a)),n._ftrRows=new C(n,a),n._gpTL=new u(n,c.TopLeft,n._hdrRows,n._hdrCols,n._eTLCt),n._gpCHdr=new u(n,c.ColumnHeader,n._hdrRows,n._cols,n._eCHdrCt),n._gpRHdr=new u(n,c.RowHeader,n._rows,n._hdrCols,n._eRHdrCt),n._gpCells=new u(n,c.Cell,n._rows,n._cols,n._eCt),n._gpBL=new u(n,c.BottomLeft,n._ftrRows,n._hdrCols,n._eBLCt),n._gpCFtr=new u(n,c.ColumnFooter,n._ftrRows,n._cols,n._eCFtrCt),n._hdrRows.push(new w),n._hdrCols.push(new _),n._hdrCols[0].align="center",n._cf=new d,n._keyHdl=new T(n),n._mouseHdl=new L(n),n._edtHdl=new I(n),n._selHdl=new P(n),n._addHdl=new A(n),n._mrgMgr=new E(n),n._bndSortConverter=n._sortConverter.bind(n),n._bndScroll=n._scroll.bind(n),i.setAttribute(n.cells.hostElement,"role","grid",!0),n.selectionMode=z.CellRange,n.initialize(o)}),n.addEventListener(n._root,"scroll",function(e){n._updateScrollPosition()&&(n.finishEditing(),n._updateContent(!0))}),n.addEventListener(s,"focus",function(e){if(s.tabIndex>-1){var t=e.target;if(t instanceof HTMLElement&&t.tabIndex<0)return void n._setFocus(!0)}},!0),n}return __extends(t,e),t.prototype._handleResize=function(){this._rcBounds=null,e.prototype._handleResize.call(this)},Object.defineProperty(t.prototype,"headersVisibility",{get:function(){return this._hdrVis},set:function(e){e!=this._hdrVis&&(this._hdrVis=i.asEnum(e,r),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stickyHeaders",{get:function(){return this._stickyHdr},set:function(e){e!=this._stickyHdr&&(this._stickyHdr=i.asBoolean(e),this._updateStickyHeaders(),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveSelectedState",{get:function(){return this._pSel},set:function(e){this._pSel=i.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveOutlineState",{get:function(){return this._pOutline},set:function(e){this._pOutline=i.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"virtualizationThreshold",{get:function(){return this._vt},set:function(e){this._vt=i.asNumber(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_virtualizationThreshold",{get:function(){return this._vt},set:function(e){i._deprecated("_virtualizationThreshold","virtualizationThreshold"),this._vt=i.asNumber(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoGenerateColumns",{get:function(){return this._autoGenCols},set:function(e){this._autoGenCols=i.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoClipboard",{get:function(){return this._autoClipboard},set:function(e){this._autoClipboard=i.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnLayout",{get:function(){for(var e=t._getSerializableProperties(_),o=new _,n=[],r=0;r<this.columns.length;r++){for(var s=this.columns[r],l={},a=0;a<e.length;a++){var h=e[a],c=s[h];c!=o[h]&&i.isPrimitive(c)&&"size"!=h&&(l[h]=c)}n.push(l)}return JSON.stringify({columns:n})},set:function(e){var t=JSON.parse(i.asString(e));if(!t||null==t.columns)throw"Invalid columnLayout data.";this.columns.clear(),this.initialize(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReadOnly",{get:function(){return this._readOnly},set:function(e){e!=this._readOnly&&(this._readOnly=i.asBoolean(e),this.finishEditing(),this.invalidate(!0),this._addHdl.updateNewRowTemplate(),i.toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly),this._setAria("readonly",this.isReadOnly?"true":null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imeEnabled",{get:function(){return null!=this._imeHdl},set:function(e){e!=this.imeEnabled&&(this._imeHdl&&(this._imeHdl.dispose(),this._imeHdl=null),e&&(this._imeHdl=new k(this)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowResizing",{get:function(){return this._alResizing},set:function(e){this._alResizing=i.asEnum(e,D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deferResizing",{get:function(){return this._deferResizing},set:function(e){this._deferResizing=i.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoSizeMode",{get:function(){return this._autoSizeMode},set:function(e){this._autoSizeMode=i.asEnum(e,O)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quickAutoSize",{get:function(){return this._quickSize},set:function(e){this._quickSize=i.asBoolean(e,!0)},enumerable:!0,configurable:!0}),t.prototype._getQuickAutoSize=function(){return i.isBoolean(this._quickSize)?this._quickSize:!this.formatItem.hasHandlers&&null==this.itemFormatter},Object.defineProperty(t.prototype,"allowSorting",{get:function(){return this._alSorting},set:function(e){this._alSorting=i.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowAddNew",{get:function(){return this._alAddNew},set:function(e){e!=this._alAddNew&&(this._alAddNew=i.asBoolean(e),this._addHdl.updateNewRowTemplate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"newRowAtTop",{get:function(){return this._addHdl.newRowAtTop},set:function(e){this._addHdl.newRowAtTop=i.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowDelete",{get:function(){return this._alDelete},set:function(e){e!=this._alDelete&&(this._alDelete=i.asBoolean(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowMerging",{get:function(){return this._alMerging},set:function(e){e!=this._alMerging&&(this._alMerging=i.asEnum(e,R),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSelectedHeaders",{get:function(){return this._ssHdr},set:function(e){e!=this._ssHdr&&(this._ssHdr=i.asEnum(e,r),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showMarquee",{get:function(){return!this._eMarquee.style.display},set:function(e){if(e!=this.showMarquee){var t=this._eMarquee.style;t.visibility="collapse",t.display=i.asBoolean(e)?"":"none",this.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSort",{get:function(){return this._shSort},set:function(e){e!=this._shSort&&(this._shSort=i.asBoolean(e),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showGroups",{get:function(){return this._shGroups},set:function(e){e!=this._shGroups&&(this._shGroups=i.asBoolean(e),this._bindGrid(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showAlternatingRows",{get:function(){return this._shAlt},set:function(e){e!=this._shAlt&&(this._shAlt=i.asBoolean(e),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showErrors",{get:function(){return this._shErr},set:function(e){e!=this._shErr&&(this._clearCells(),this._shErr=i.asBoolean(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemValidator",{get:function(){return this._itemValidator},set:function(e){e!=this.itemValidator&&(this._itemValidator=i.asFunction(e),this._hasValidation=i.isFunction(this._itemValidator)||this._cv&&i.isFunction(this._cv.getError),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validateEdits",{get:function(){return this._valEdt},set:function(e){this._valEdt=i.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupHeaderFormat",{get:function(){return this._gHdrFmt},set:function(e){e!=this._gHdrFmt&&(this._gHdrFmt=i.asString(e),this._bindGrid(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowDragging",{get:function(){return this._alDragging},set:function(e){e!=this._alDragging&&(this._alDragging=i.asEnum(e,j),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemsSource",{get:function(){return this._items},set:function(e){if(e!=this._items){if(this._cv&&((t=i.tryCast(this._cv,i.CollectionView))&&t.sortConverter==this._bndSortConverter&&(t.sortConverter=null),this._cv.currentChanged.removeHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this),this._cv=null),this._items=e,this._cv=this._getCollectionView(e),this._lastCount=0,this._hasValidation=i.isFunction(this._itemValidator)||this._cv&&i.isFunction(this._cv.getError),this._cv){this._cv.currentChanged.addHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this);var t=i.tryCast(this._cv,i.CollectionView);t&&!t.sortConverter&&(t.sortConverter=this._bndSortConverter)}this._bindGrid(!0),this.onItemsSourceChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editableCollectionView",{get:function(){return i.tryCast(this._cv,"IEditableCollectionView")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childItemsPath",{get:function(){return this._childItemsPath},set:function(e){e!=this._childItemsPath&&(i.assert(null==e||i.isArray(e)||i.isString(e),"childItemsPath should be an array or a string."),this._childItemsPath=e,this._bindGrid(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeaderPath",{get:function(){return this._rowHdrPath?this._rowHdrPath.path:null},set:function(e){e!=this.rowHeaderPath&&(e=i.asString(e),this._rowHdrPath=e?new i.Binding(e):null,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cells",{get:function(){return this._gpCells},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnHeaders",{get:function(){return this._gpCHdr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnFooters",{get:function(){return this._gpCFtr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeaders",{get:function(){return this._gpRHdr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeftCells",{get:function(){return this._gpTL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeftCells",{get:function(){return this._gpBL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0}),t.prototype.getColumn=function(e){return this.columns.getColumn(e)},Object.defineProperty(t.prototype,"frozenRows",{get:function(){return this.rows.frozen},set:function(e){this.rows.frozen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frozenColumns",{get:function(){return this.columns.frozen},set:function(e){this.columns.frozen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cloneFrozenCells",{get:function(){return this._fzClone},set:function(e){e!=this.cloneFrozenCells&&(this._fzClone=i.asBoolean(e,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortRowIndex",{get:function(){return this._sortRowIndex},set:function(e){e!=this._sortRowIndex&&(this._sortRowIndex=i.asNumber(e,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollPosition",{get:function(){return this._ptScrl.clone()},set:function(e){var i=this._root,o=-e.x;if(this.rightToLeft)switch(t._getRtlMode()){case"rev":o=i.scrollWidth-i.clientWidth+e.x;break;case"neg":o=e.x;break;default:o=-e.x}i.scrollLeft=o,i.scrollTop=-e.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientSize",{get:function(){return this._szClient},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controlRect",{get:function(){return this._rcBounds||(this._rcBounds=i.getElementRect(this._root)),this._rcBounds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollSize",{get:function(){return new i.Size(this._gpCells.width,this._heightBrowser)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewRange",{get:function(){return this._gpCells.viewRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellFactory",{get:function(){return this._cf},set:function(e){e!=this._cf&&(this._clearCells(),this._cf=i.asType(e,d,!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemFormatter",{get:function(){return this._itemFormatter},set:function(e){e!=this._itemFormatter&&(this._clearCells(),this._itemFormatter=i.asFunction(e))},enumerable:!0,configurable:!0}),t.prototype.canEditCell=function(e,t){return this._edtHdl._allowEditing(e,t)},t.prototype.getCellData=function(e,t,i){return this.cells.getCellData(e,t,i)},t.prototype.getCellBoundingRect=function(e,t,i){return this.cells.getCellBoundingRect(e,t,i)},t.prototype.setCellData=function(e,t,i,o,n){return void 0===o&&(o=!0),void 0===n&&(n=!0),this.cells.setCellData(e,t,i,o,n)},t.prototype.hitTest=function(e,t){return i.isNumber(e)&&i.isNumber(t)&&(e=new i.Point(e,t)),i.isBoolean(t)&&t&&(this._rcBounds=null),new b(this,e)},t.prototype.getClipString=function(e){return this._edtHdl.getClipString(e)},t.prototype.setClipString=function(e,t){this._edtHdl.setClipString(e,t)},t.prototype.focus=function(){this._setFocus(!1)},t.prototype.dispose=function(){this.finishEditing(!0),this.itemsSource=null,e.prototype.dispose.call(this)},t.prototype.refresh=function(t){void 0===t&&(t=!0),e.prototype.refresh.call(this,t),this.finishEditing(),t&&(this._updateColumnTypes(),this.scrollPosition=this._ptScrl),this.refreshCells(t)},t.prototype.refreshCells=function(e,t,i){this.isUpdating||(e?this._updateLayout():this._updateContent(t,i))},t.prototype.autoSizeColumn=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=4),this.autoSizeColumns(e,e,t,i)},t.prototype.autoSizeColumns=function(e,o,n,r){var s=this;void 0===n&&(n=!1),void 0===r&&(r=4);var l=0,a=n?this.topLeftCells:this.columnHeaders,h=n?this.bottomLeftCells:this.columnFooters,c=n?this.rowHeaders:this.cells,u=this.viewRange;e=null==e?0:i.asInt(e),o=null==o?c.columns.length-1:i.asInt(o),u.row=Math.max(0,u.row-1e3),u.row2=Math.min(u.row2+1e3,this.rows.length-1),this.finishEditing()&&this.columns.deferUpdate(function(){i.setCss(s._eCt,{width:s._gpCells.width});var n=document.createElement("div");n.setAttribute(t._WJS_MEASURE,"true"),n.style.visibility="hidden",c.hostElement.parentElement.appendChild(n);for(var d=s._getCanvasContext(),g=e;g<=o&&g>-1&&g<c.columns.length;g++){var p=c.columns[g];if(p.isVisible){if(l=0,s.autoSizeMode&O.Headers){for(f=0;f<a.rows.length;f++)if(a.rows[f].isVisible){_=s._getDesiredWidth(a,f,g,n);l=Math.max(l,_)}for(f=0;f<h.rows.length;f++)if(h.rows[f].isVisible){_=s._getDesiredWidth(h,f,g,n);l=Math.max(l,_)}}if(s.autoSizeMode&O.Cells)if(p._getQuickAutoSize()){var f=s._getWidestRow(c,u,g,d),_=s._getDesiredWidth(c,f,g,n);l=Math.max(l,_)}else for(f=u.row;f<=u.row2&&f>-1&&f<c.rows.length;f++)if(c.rows[f].isVisible){_=s._getDesiredWidth(c,f,g,n);l=Math.max(l,_)}p.width=l+r+2}}s.cellFactory.disposeCell(n),n.parentElement.removeChild(n)})},t.prototype.autoSizeRow=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=0),this.autoSizeRows(e,e,t,i)},t.prototype.autoSizeRows=function(e,o,n,r){var s=this;void 0===n&&(n=!1),void 0===r&&(r=0);var l=0,a=n?this.topLeftCells:this.rowHeaders,h=n?this.columnHeaders:this.cells;n=i.asBoolean(n),r=i.asNumber(r),e=null==e?0:i.asInt(e),o=null==o?h.rows.length-1:i.asInt(o),this.finishEditing()&&this.rows.deferUpdate(function(){i.setCss(s._eCt,{width:s._gpCells.width});var n=document.createElement("div");n.setAttribute(t._WJS_MEASURE,"true"),n.style.visibility="hidden",h.hostElement.appendChild(n);for(var c={},u=e;u<=o&&u>-1&&u<h.rows.length;u++)if(h.rows[u].isVisible){if(l=0,s.autoSizeMode&O.Headers)for(g=0;g<a.columns.length;g++)if(a.columns[g].isVisible>0){_=s._getDesiredHeight(a,u,g,n);l=Math.max(l,_)}if(s.autoSizeMode&O.Cells)for(var d=!0,g=0;g<h.columns.length;g++){var p=h.columns[g],f=p._getQuickAutoSize();if(p.isVisible&&(d||p.wordWrap||p.cssClass||p.dataType==i.DataType.Boolean||!f)){var _=void 0;if(f){var w={col:g,content:p.dataType==i.DataType.Number?"1":h.getCellData(u,g,!0)},m=JSON.stringify(w);null==(_=c[m])&&(_=s._getDesiredHeight(h,u,g,n),c[m]=_)}else _=s._getDesiredHeight(h,u,g,n);l=Math.max(l,_),d=!1}}h.rows[u].height=l+r}s.cellFactory.disposeCell(n),n.parentElement.removeChild(n)})},Object.defineProperty(t.prototype,"treeIndent",{get:function(){return this._indent},set:function(e){e!=this._indent&&(this._indent=i.asNumber(e,!1,!0),this.columns.onCollectionChanged())},enumerable:!0,configurable:!0}),t.prototype.collapseGroupsToLevel=function(e){if(this.finishEditing()){var t=this.rows;t.deferUpdate(function(){for(var o=0;o<t.length;o++){var n=i.tryCast(t[o],m);n&&(n.isCollapsed=n.level>=e)}})}},Object.defineProperty(t.prototype,"selectionMode",{get:function(){return this._selHdl.selectionMode},set:function(e){e!=this.selectionMode&&(this._clearCells(),this._selHdl.selectionMode=i.asEnum(e,z))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this._selHdl.selection.clone()},set:function(e){this._selHdl.selection=e},enumerable:!0,configurable:!0}),t.prototype.select=function(e,t){void 0===t&&(t=!0),this._selHdl.select(e,t)},t.prototype.getSelectedState=function(e,t){return this.cells.getSelectedState(e,t,null)},Object.defineProperty(t.prototype,"selectedRows",{get:function(){var e=[];if(this.selectionMode==z.ListBox)for(i=0;i<this.rows.length;i++)this.rows[i].isSelected&&e.push(this.rows[i]);else if(this.rows.length)for(var t=this.selection,i=t.topRow;i>-1&&i<=t.bottomRow;i++)e.push(this.rows[i]);return e},set:function(e){var t=this;i.assert(this.selectionMode==z.ListBox,"This property can be set only in ListBox mode."),e=i.asArray(e),this.deferUpdate(function(){for(var i=0,o=!0;i<t.rows.length;i++){var n=t.rows[i],r=e&&e.indexOf(n)>-1;r&&o&&(o=!1,t.select(i,t.selection.col)),n.isSelected=r}})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){for(var e=this.selectedRows,t=0;t<e.length;t++)e[t]=e[t].dataItem;return e},set:function(e){var t=this;i.assert(this.selectionMode==z.ListBox,"This property can be set only in ListBox mode."),e=i.asArray(e),this.deferUpdate(function(){for(var i=0,o=!0;i<t.rows.length;i++){var n=t.rows[i],r=e&&e.indexOf(n.dataItem)>-1;r&&o&&(o=!1,t.select(i,t.selection.col)),n.isSelected=r}})},enumerable:!0,configurable:!0}),t.prototype.scrollIntoView=function(e,t){null==this._maxOffsetY&&this._updateLayout();var o=this.scrollPosition,n=this._szClient.width,r=this._szClient.height-this._gpCFtr.rows.getTotalSize(),s=this.cells._getFrozenPos();if((e=i.asInt(e))>-1&&e<this._rows.length&&e>=this._rows.frozen){var l=this._rows[e],a=this.cells.height>r?Math.round(l.pos/(this.cells.height-r)*100)/100:0,h=Math.round(this._maxOffsetY*a),c=l.pos-h,u=c+l.renderSize;u>r-o.y&&(o.y=Math.max(-c,r-u)),c-s.y<-o.y&&(o.y=-(c-s.y))}if((t=i.asInt(t))>-1&&t<this._cols.length&&t>=this._cols.frozen){var d=this._cols[t],g=d.pos+d.renderSize;g>-o.x+n&&(o.x=Math.max(-d.pos,n-g)),d.pos-s.x<-o.x&&(o.x=-(d.pos-s.x))}return!o.equals(this._ptScrl)&&(this.scrollPosition=o,!0)},t.prototype.isRangeValid=function(e){return e.isValid&&e.bottomRow<this.rows.length&&e.rightCol<this.columns.length},t.prototype.startEditing=function(e,t,i,o){return void 0===e&&(e=!0),this._edtHdl.startEditing(e,t,i,o)},t.prototype.finishEditing=function(e){return void 0===e&&(e=!1),this._edtHdl.finishEditing(e)},Object.defineProperty(t.prototype,"activeEditor",{get:function(){return this._edtHdl.activeEditor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editRange",{get:function(){return this._edtHdl.editRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mergeManager",{get:function(){return this._mrgMgr},set:function(e){e!=this._mrgMgr&&(this._mrgMgr=i.asType(e,E,!0),this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.getMergedRange=function(e,t,i,o){return void 0===o&&(o=!0),this._mrgMgr?this._mrgMgr.getMergedRange(e,t,i,o):null},Object.defineProperty(t.prototype,"keyActionTab",{get:function(){return this._keyHdl._kaTab},set:function(e){this._keyHdl._kaTab=i.asEnum(e,M)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keyActionEnter",{get:function(){return this._keyHdl._kaEnter},set:function(e){this._keyHdl._kaEnter=i.asEnum(e,M)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showDropDown",{get:function(){return this._shDropDown},set:function(e){e!=this._shDropDown&&(this._shDropDown=i.asBoolean(e,!0),this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.toggleDropDownList=function(){this._tglDropDown||(this._tglDropDown=!0,this._edtHdl._toggleListBox(null),this._tglDropDown=!1)},t.prototype.onItemsSourceChanged=function(e){this.itemsSourceChanged.raise(this,e)},t.prototype.onScrollPositionChanged=function(e){this.scrollPositionChanged.raise(this,e)},t.prototype.onSelectionChanging=function(e){return this.selectionChanging.raise(this,e),!e.cancel},t.prototype.onSelectionChanged=function(e){this.selectionChanged.raise(this,e)},t.prototype.onLoadingRows=function(e){return this.loadingRows.raise(this,e),!e.cancel},t.prototype.onLoadedRows=function(e){this.loadedRows.raise(this,e)},t.prototype.onUpdatingLayout=function(e){return this.updatingLayout.raise(this,e),!e.cancel},t.prototype.onUpdatedLayout=function(e){this.updatedLayout.raise(this,e)},t.prototype.onResizingColumn=function(e){return this.resizingColumn.raise(this,e),!e.cancel},t.prototype.onResizedColumn=function(e){this.resizedColumn.raise(this,e)},t.prototype.onAutoSizingColumn=function(e){return this.autoSizingColumn.raise(this,e),!e.cancel},t.prototype.onAutoSizedColumn=function(e){this.autoSizedColumn.raise(this,e)},t.prototype.onDraggingColumn=function(e){return this.draggingColumn.raise(this,e),!e.cancel},t.prototype.onDraggingColumnOver=function(e){return this.draggingColumnOver.raise(this,e),!e.cancel},t.prototype.onDraggedColumn=function(e){this.draggedColumn.raise(this,e)},t.prototype.onResizingRow=function(e){return this.resizingRow.raise(this,e),!e.cancel},t.prototype.onResizedRow=function(e){this.resizedRow.raise(this,e)},t.prototype.onAutoSizingRow=function(e){return this.autoSizingRow.raise(this,e),!e.cancel},t.prototype.onAutoSizedRow=function(e){this.autoSizedRow.raise(this,e)},t.prototype.onDraggingRow=function(e){return this.draggingRow.raise(this,e),!e.cancel},t.prototype.onDraggingRowOver=function(e){return this.draggingRowOver.raise(this,e),!e.cancel},t.prototype.onDraggedRow=function(e){this.draggedRow.raise(this,e)},t.prototype.onGroupCollapsedChanging=function(e){return this.groupCollapsedChanging.raise(this,e),!e.cancel},t.prototype.onGroupCollapsedChanged=function(e){this.groupCollapsedChanged.raise(this,e)},t.prototype.onSortingColumn=function(e){return this.sortingColumn.raise(this,e),!e.cancel},t.prototype.onSortedColumn=function(e){this.sortedColumn.raise(this,e)},t.prototype.onBeginningEdit=function(e){return this.beginningEdit.raise(this,e),!e.cancel},t.prototype.onPrepareCellForEdit=function(e){this.prepareCellForEdit.raise(this,e)},t.prototype.onCellEditEnding=function(e){return this.cellEditEnding.raise(this,e),!e.cancel&&!e.stayInEditMode},t.prototype.onCellEditEnded=function(e){this.cellEditEnded.raise(this,e)},t.prototype.onRowEditStarting=function(e){this.rowEditStarting.raise(this,e)},t.prototype.onRowEditStarted=function(e){this.rowEditStarted.raise(this,e)},t.prototype.onRowEditEnding=function(e){this.rowEditEnding.raise(this,e)},t.prototype.onRowEditEnded=function(e){this.rowEditEnded.raise(this,e)},t.prototype.onRowAdded=function(e){return this.rowAdded.raise(this,e),!e.cancel},t.prototype.onDeletingRow=function(e){return this.deletingRow.raise(this,e),!e.cancel},t.prototype.onDeletedRow=function(e){this.deletedRow.raise(this,e)},t.prototype.onCopying=function(e){return this.copying.raise(this,e),!e.cancel},t.prototype.onCopied=function(e){this.copied.raise(this,e)},t.prototype.onPasting=function(e){return this.pasting.raise(this,e),!e.cancel},t.prototype.onPasted=function(e){this.pasted.raise(this,e)},t.prototype.onPastingCell=function(e){return this.pastingCell.raise(this,e),!e.cancel},t.prototype.onPastedCell=function(e){this.pastedCell.raise(this,e)},t.prototype.onFormatItem=function(e){this.formatItem.raise(this,e)},t.prototype.onUpdatingView=function(e){return this.updatingView.raise(this,e),!e.cancel},t.prototype.onUpdatedView=function(e){this.updatedView.raise(this,e)},t.prototype._getShowErrors=function(){return this.showErrors&&this._hasValidation},t.prototype._getHasValidation=function(){return this._hasValidation},t.prototype._getError=function(e,t,o){if(i.isFunction(this.itemValidator)){if(e==this.cells)return this.itemValidator(t,o);if(e==this.rowHeaders)for(o=0;o<this.columns.length;o++)if(c=this.itemValidator(t,o))return c}var n=this.collectionView,r=n?n.getError:null;if(i.isFunction(r)){var s=e.rows,l=this.columns,a=s[t].dataItem;if(a)for(;t<s.length&&s[t].dataItem==a;t++){if(e==this.cells)return r(a,(h=this._getBindingColumn(this.cells,t,l[o])).binding);if(e==this.rowHeaders)for(o=0;o<l.length;o++){var h=this._getBindingColumn(this.cells,t,l[o]),c=r(a,h.binding);if(c)return c}}}return null},t.prototype._setAria=function(e,t){i.setAttribute(this.cells.hostElement,"aria-"+e,t)},t.prototype._setFocus=function(e){if(this.hostElement&&(e||!this.containsFocus())){var t=i.getActiveElement(),o=this._eFocus,n="tabindex";this.activeEditor?i.contains(this.activeEditor,t)||(this._setFocusNoScroll(this.activeEditor),o.removeAttribute(n)):this._activeCell?i.contains(this._activeCell,t)||(this._setFocusNoScroll(this._activeCell),o.removeAttribute(n)):i.contains(o,t)||(o.tabIndex=this._tabIndex,o.focus()),this.containsFocus()||(o.tabIndex=this._tabIndex,o.focus())}},t.prototype._setFocusNoScroll=function(e){var t=this.scrollPosition,i=e.style,o=i.position;i.position="fixed",e.tabIndex=this._tabIndex,e.focus(),i.position=o,this.scrollPosition=t;var n=this.hostElement;n.scrollTop=n.scrollLeft=0},t.prototype._getDefaultRowHeight=function(){var e=this.hostElement,t=document.body,o=null;if(t&&!i.contains(t,e)){for(var n=e;n;n=n.parentElement)o=n;o&&t.appendChild(o)}var r=i.createElement('<div class="wj-cell">123</div>',e),s=r.scrollHeight+2;return e.removeChild(r),o&&t.removeChild(o),(s<=6||isNaN(s)||!t)&&(s=28),s},t.prototype._getCollectionView=function(e){return i.asCollectionView(e)},t.prototype._getCanvasContext=function(){var e=document.createElement("canvas").getContext("2d"),t=getComputedStyle(this.hostElement);return e.font=t.fontSize+" "+t.fontFamily.split(",")[0],e},t.prototype._getWidestRow=function(e,t,o,n){for(var r=0,s=0,l=e.columns[o].dataType,a=l==i.DataType.Number,h=l==i.DataType.Boolean,c=t.row;c<=t.row2;c++)if(e.rows[c].isVisible){var u=e.getCellData(c,o,!0),d=l==a?u.length:n.measureText(u).width;if(d>s&&(s=d,r=c),h)break}return r},t.prototype._getDesiredWidth=function(e,t,i,o){var n=this.getMergedRange(e,t,i),r=o.style;return this.cellFactory.updateCell(e,t,i,o,n),r.width=r.top=r.left="",o.offsetWidth/(n&&n.columnSpan>1?n.columnSpan:1)},t.prototype._getDesiredHeight=function(e,t,i,o){var n=this.getMergedRange(e,t,i),r=o.style;return this.cellFactory.updateCell(e,t,i,o,n),r.height=r.top=r.left="",o.offsetHeight/(n&&n.rowSpan>1?n.rowSpan:1)},t.prototype._getSortRowIndex=function(){return null!=this._sortRowIndex?this._sortRowIndex:this.columnHeaders.rows.length-1},t.prototype._sortConverter=function(e,t,i,o){var n;if(o){if(this._mappedColumns=null,this.collectionView)for(var r=this.collectionView.sortDescriptions,s=0;s<r.length;s++)(n=this.getColumn(r[s].property))&&n.dataMap&&(this._mappedColumns||(this._mappedColumns={}),this._mappedColumns[n.binding]=n.dataMap);this._mouseHdl._htDown&&this._mouseHdl._htDown.col>-1&&(n=this.columns[this._mouseHdl._htDown.col],this._mappedColumns&&n.dataMap&&(this._mappedColumns[n.binding]=n.dataMap))}if(this._mappedColumns){var l=this._mappedColumns[e.property];l&&l.sortByDisplayValues&&(i=l.getDisplayValue(i))}return i},t.prototype._bindGrid=function(e){var t=this;if(this.deferUpdate(function(){0==t._lastCount&&t._cv&&t._cv.items&&t._cv.items.length&&(e=!0);var o=[];if(t.preserveSelectedState&&t.selectionMode==z.ListBox&&!t.childItemsPath)for(u=0;u<t.rows.length;u++){var n=t.rows[u];n.isSelected&&n.dataItem&&o.push(n.dataItem)}var r;if(t.preserveOutlineState&&i.isFunction(window.Map)&&t.rows.maxGroupLevel>-1){r=new Map;for(u=0;u<t.rows.length;u++){var s=t.rows[u];if(s instanceof m&&s.isCollapsed&&s.dataItem){var l=s.dataItem;l instanceof i.CollectionViewGroup&&(l=l._path),r.set(l,!0)}}}e&&t.columns.deferUpdate(function(){t._bindColumns()});var a=new i.CancelEventArgs;t.onLoadingRows(a)&&(t.rows.deferUpdate(function(){t._bindRows()}),t.onLoadedRows(a));var h=0;if(o.length)for(u=0;u<t.rows.length&&h<o.length;u++)o.indexOf(t.rows[u].dataItem)>-1&&(t.rows[u].isSelected=!0,h++);if(t.selectionMode==z.ListBox&&0==h)for(var c=t.selection,u=c.topRow;u<=c.bottomRow&&u>-1&&u<t.rows.length;u++)t.rows[u].isSelected=!0;r&&t.rows.deferUpdate(function(){for(var e=0;e<t.rows.length;e++){var o=t.rows[e];if(o instanceof m){var n=o.dataItem;n instanceof i.CollectionViewGroup&&(n=n._path),r.get(n)&&(o.isCollapsed=!0)}}}),!t._lastCount&&t._cv&&t._cv.items&&(t._lastCount=t._cv.items.length)}),!this.rows.length){var o=this._selHdl.selection;o.row=o.row2=-1}this.collectionView&&this._cvCurrentChanged(this.collectionView,i.EventArgs.empty)},t.prototype._cvCollectionChanged=function(e,t){if(this.autoGenerateColumns&&0==this.columns.length)this._bindGrid(!0);else if(this.childItemsPath&&t.action!=i.NotifyCollectionChangedAction.Change)this._bindGrid(!1);else{switch(t.action){case i.NotifyCollectionChangedAction.Change:return void this.invalidate();case i.NotifyCollectionChangedAction.Add:if(t.index==this.collectionView.items.length-1){var o=this.rows.length;return this.rows[o-1]instanceof N&&o--,void this.rows.insert(o,new w(t.item))}i.assert(!1,"added item should be the last one.");break;case i.NotifyCollectionChangedAction.Remove:var n=this._findRow(t.item);if(n>-1)return this.rows.removeAt(n),void this._cvCurrentChanged(e,t);i.assert(!1,"removed item not found in grid.")}this._bindGrid(!1)}},t.prototype._cvCurrentChanged=function(e,t){if(this.collectionView&&this.selectionMode!=z.None){var o=this.selection,n=o.row>-1&&o.row<this.rows.length?this.rows[o.row].dataItem:null;if(n instanceof i.CollectionViewGroup&&(n=null),!(n==this.collectionView.currentItem||this.childItemsPath&&this.editableCollectionView&&this.editableCollectionView.currentAddItem)){var r=this._getRowIndex(this.collectionView.currentPosition);r==o.row&&this.childItemsPath||(o.row=o.row2=r,this.select(o,!1),this.selectionMode&&this.scrollIntoView(o.row,-1))}}},t.prototype._getRowIndex=function(e){if(this.collectionView){if(e>-1){for(var t=this.collectionView.items[e];e<this.rows.length;e++)if(this.rows[e].dataItem===t)return e;return-1}if(1==this.rows.length&&this.rows[0]instanceof N)return 0;var i=this.selection.row,o=i>-1?this.rows[i]:null;return o&&(o instanceof m||null==o.dataItem)?i:-1}return this.selection.row},t.prototype._getCvIndex=function(e){if(e>-1&&this.collectionView){var t=this.rows[e].dataItem;for(e=Math.min(e,this.collectionView.items.length);e>-1;e--)if(this.collectionView.items[e]===t)return e}return-1},t.prototype._findRow=function(e){for(var t=0;t<this.rows.length;t++)if(this.rows[t].dataItem==e)return t;return-1},t.prototype._updateLayout=function(){var e=new i.CancelEventArgs;if(this.onUpdatingLayout(e)){var o=this._hdrVis&r.Row?this._hdrCols.getTotalSize():0,n=this._hdrVis&r.Column?this._hdrRows.getTotalSize():0,s=this._ftrRows.getTotalSize(),l=this._rows.getTotalSize()+s;if(l<1&&(l=1),this._heightBrowser=Math.min(l,t._getMaxSupportedCssHeight()),this._maxOffsetY=Math.max(0,l-this._heightBrowser),this.cells.hostElement){var a=i.createElement('<div class="wj-cell"></div>',this.cells.hostElement),h=getComputedStyle(a);this._cellPadding=parseInt(this.rightToLeft?h.paddingRight:h.paddingLeft),a.parentElement.removeChild(a)}var c=this._heightBrowser+n-s;this.rightToLeft?(i.setCss(this._eTL,{right:0,top:0,width:o,height:n}),i.setCss(this._eCHdr,{right:o,top:0,height:n}),i.setCss(this._eRHdr,{right:0,top:n,width:o}),i.setCss(this._eCt,{right:o,top:n,width:this._gpCells.width,height:this._heightBrowser}),i.setCss(this._fCt,{right:o,top:n}),i.setCss(this._eBL,{right:0,top:c,width:o,height:s}),i.setCss(this._eCFtr,{right:o,top:c,height:s})):(i.setCss(this._eTL,{left:0,top:0,width:o,height:n}),i.setCss(this._eCHdr,{left:o,top:0,height:n}),i.setCss(this._eRHdr,{left:0,top:n,width:o}),i.setCss(this._eCt,{left:o,top:n,width:this._gpCells.width,height:this._heightBrowser}),i.setCss(this._fCt,{left:o,top:n}),i.setCss(this._eBL,{left:0,top:c,width:o,height:s}),i.setCss(this._eCFtr,{left:o,top:c,height:s})),this._stickyHdr&&this._updateStickyHeaders(),i.setCss([this._eTL,this._eBL,this._eCHdr,this._eCFtr,this._eRHdr,this._eMarquee],{zIndex:this.frozenRows||this.frozenColumns?"3":""});var u=this._root,d=u.offsetWidth-u.clientWidth,g=u.offsetHeight-u.clientHeight;i.setCss(this._eSz,{width:o+d+this._gpCells.width,height:n+g+this._heightBrowser});var p=null;this.columns._updateStarSizes(u.clientWidth-o)&&(p=u.clientWidth,i.setCss(this._eCt,{width:this._gpCells.width})),this._szClient=new i.Size(u.clientWidth-o,u.clientHeight-n),this._rcBounds=null,this._updateScrollHandler(),this._updateContent(!1),d=u.offsetWidth-u.clientWidth,g=u.offsetHeight-u.clientHeight,i.setCss(this._eSz,{width:o+d+this._gpCells.width,height:n+g+this._heightBrowser}),this._szClient=new i.Size(u.clientWidth-o,u.clientHeight-n),p&&p!=u.clientWidth&&this.columns._updateStarSizes(u.clientWidth-o)&&(i.setCss(this._eCt,{width:this._gpCells.width}),this._updateContent(!1)),i.setCss([this._eCHdr,this._eCFtr,this._fCt],{width:this._szClient.width}),i.setCss([this._eRHdr,this._fCt],{height:this._szClient.height}),s&&(c=Math.min(c,this._szClient.height+n-s),i.setCss([this._eBL,this._eCFtr],{top:c})),this.onUpdatedLayout(e)}},t.prototype._updateStickyHeaders=function(){var e=!1,o=0;if(this._stickyHdr){for(var n=0,r=null,s=this.hostElement;s;s=s.parentElement){var l=s.getBoundingClientRect();null==r&&(r=l.top),n=Math.max(n,l.top)}o=-(r=Math.max(0,n-r-1)),e=r>0,this._rcBounds=null}this._eTL.style.top=this._eCHdr.style.top=e?-o+"px":"",i.toggleClass(this._eTL,t._WJS_STICKY,e),i.toggleClass(this._eCHdr,t._WJS_STICKY,e)},t.prototype._updateScrollHandler=function(){var e=this._stickyHdr||this._clipToScreen();e!=this._scrollHandlerAttached&&(this._scrollHandlerAttached=e,e?this.addEventListener(window,"scroll",this._bndScroll,!0):this.removeEventListener(window,"scroll",this._bndScroll,!0))},t.prototype._clipToScreen=function(){if(this.rows.length<=t._MIN_VIRT_ROWS)return!1;if(this._root.clientHeight!=this._root.scrollHeight)return!1;for(var e=this.hostElement;e&&e!=document.documentElement;e=e.parentElement)if("auto"==getComputedStyle(e).overflow)return!1;return!0},t.prototype._scroll=function(e){var t=this;i.contains(e.target,this.hostElement)&&(this._clipToScreen()&&(this._afScrl&&cancelAnimationFrame(this._afScrl),this._afScrl=requestAnimationFrame(function(){t.finishEditing(),t._updateContent(!0),t._afScrl=null})),this._stickyHdr&&(this._toSticky&&cancelAnimationFrame(this._toSticky),this._toSticky=requestAnimationFrame(function(){t._toSticky=null;var e=new i.CancelEventArgs;t.onUpdatingLayout(e)&&(t._updateStickyHeaders(),t.onUpdatedLayout(e))})))},t.prototype._updateScrollPosition=function(){var e=this._root,o=e.scrollTop,n=e.scrollLeft;this.rightToLeft&&"rev"==t._getRtlMode()&&(n=e.scrollWidth-e.clientWidth-n);var r=new i.Point(-Math.abs(n),-o);return!this._ptScrl.equals(r)&&(this._ptScrl=r,this.onScrollPositionChanged(),!0)},t.prototype._updateContent=function(e,t){var o=i.getActiveElement(),n=i.contains(this.hostElement,o)?o:null,s=this._activeCell,l=new i.CancelEventArgs;if(this.onUpdatingView(l)){if(this._offsetY=0,this._heightBrowser>this._szClient.height){var a=Math.round(-this._ptScrl.y/(this._heightBrowser-this._szClient.height)*100)/100;this._offsetY=Math.round(this._maxOffsetY*a)}this._updateScrollPosition();var h=this._gpCells._updateContent(e,t,this._offsetY);if(this._hdrVis&r.Column&&(!t||this._ssHdr&r.Column)&&this._gpCHdr._updateContent(e,t,0),this._hdrVis&r.Row&&(!t||this._ssHdr&r.Row)&&this._gpRHdr._updateContent(e,t,this._offsetY),this._hdrVis&&!t&&this._gpTL._updateContent(e,t,0),this._gpCFtr.rows.length&&(this._gpBL._updateContent(e,t,0),this._gpCFtr._updateContent(e,t,0)),this.showMarquee){var c=this._selHdl.selection,u=this._eMarquee;if(this.isRangeValid(c)){var d=this._getMarqueeRect(c),g=this.cells.hostElement,p=u.firstChild,f=u.offsetWidth-p.offsetWidth,_=u.offsetHeight-p.offsetHeight;i.setCss(u,{left:d.left+g.offsetLeft-f/2,top:d.top+g.offsetTop-_/2,width:d.width+f,height:d.height+_,visibility:d.width>0&&d.height>0?"":"collapse"})}else i.setCss(u,{left:0,top:0,width:0,height:0,visibility:"collapse"})}if(this._useFrozenDiv()&&(this._updateFrozenCells(t),h&&i.hasClass(h,"wj-frozen")&&(h=null)),this._activeCell=h,n)if(n!=this._root&&n!=this._eFocus&&i.contains(this.hostElement,n)&&!i.contains(this.cells.hostElement,n))n.focus();else{var w=h!=s;this._setFocus(w)}!n&&h&&(h.tabIndex=this._tabIndex),s&&s!=h&&s.removeAttribute("tabindex"),this._rcBounds=null,this.onUpdatedView(l)}},t.prototype._clearCells=function(){for(var e in this)if("_"==e[0]){var t=this[e];t instanceof u&&t._clearCells()}this.invalidate()},t.prototype._useFrozenDiv=function(){return i.isBoolean(this._fzClone)?this._fzClone:i.isIE()||i.isFirefox()||i.isMobile()},t.prototype._updateFrozenCells=function(e){if(this.frozenRows||this.frozenColumns){var t=this._eCt.querySelectorAll(".wj-frozen");if(e&&this._fCt.children.length==t.length){for(o=0;o<t.length;o++)this._fCt.children[o].className=t[o].className;return}if(i.setText(this._fCt,null),!this.activeEditor)for(var o=0;o<t.length;o++){var n=t[o].cloneNode(!0);n.style.pointerEvents="auto",this._fCt.appendChild(n)}}else i.setText(this._fCt,null)},t.prototype._getMarqueeRect=function(e){var t=this.getMergedRange(this.cells,e.topRow,e.leftCol)||new g(e.topRow,e.leftCol),o=this.getMergedRange(this.cells,e.bottomRow,e.rightCol)||new g(e.bottomRow,e.rightCol),n=this.cells.getCellBoundingRect(t.topRow,t.leftCol,!0),r=this.cells.getCellBoundingRect(o.bottomRow,o.rightCol,!0);if(this.rows.frozen){var s=Math.min(this.rows.length,this.rows.frozen),l=this.cells.getCellBoundingRect(s-1,0,!0);e.topRow>=s&&n.top<l.bottom&&(n.top=l.bottom),e.bottomRow>=s&&r.bottom<l.bottom&&(r.height=l.bottom-r.top)}if(this.columns.frozen){var a=Math.min(this.columns.length,this.columns.frozen),l=this.cells.getCellBoundingRect(0,a-1,!0);this.rightToLeft?(e.leftCol>=a&&n.right>l.left&&(n.left=l.left-n.width),e.rightCol>=a&&r.left>l.left&&(r.left=l.left)):(e.leftCol>=a&&n.left<l.right&&(n.left=l.right),e.rightCol>=a&&r.right<l.right&&(r.width=l.right-r.left))}return this.rightToLeft?new i.Rect(r.left,n.top,n.right-r.left,r.bottom-n.top):new i.Rect(n.left,n.top,r.right-n.left,r.bottom-n.top)},t.prototype._bindColumns=function(){for(var e=0;e<this.columns.length;e++)(a=this.columns[e])._getFlag(p.AutoGenerated)&&(this.columns.removeAt(e),e--);var t=this.collectionView,o=t?t.sourceCollection:null,n=o&&o.length?o[0]:null;if(n&&this.autoGenerateColumns)for(var r in n)for(var s=null,l=0;l<o.length&&l<1e3&&null==s;l++)if(s=o[l][r],i.isPrimitive(s)){var a=new _;a._setFlag(p.AutoGenerated,!0),a.binding=a.name=r,a.header=i.toHeaderCase(r),a.dataType=i.getType(s),a.dataType==i.DataType.Number&&(a.width=80);var h=Object.getOwnPropertyDescriptor(n,r);!h||h.writable||i.isFunction(h.set)||a._setFlag(p.ReadOnly,!0),this.columns.push(a)}this._updateColumnTypes()},t.prototype._updateColumnTypes=function(){var e=this.collectionView;if(i.hasItems(e))for(var t=e.items[0],o=this.columns,n=0;n<o.length;n++){var r=o[n];null==r.dataType&&r._binding&&(r.dataType=i.getType(r._binding.getValue(t)))}},t.prototype._getBindingColumn=function(e,t,i){return i},t.prototype._getRowHeaderPath=function(){return this._rowHdrPath},t.prototype._bindRows=function(){this.rows.clear();var e=this.collectionView;if(e&&e.items){var t=e.items,i=e.groups;if(this.childItemsPath)for(o=0;o<t.length;o++)this._addNode(t,o,0);else if(null!=i&&i.length>0&&this.showGroups)for(o=0;o<i.length;o++)this._addGroup(i[o]);else for(var o=0;o<t.length;o++)this._addBoundRow(t,o)}},t.prototype._addBoundRow=function(e,t){this.rows.push(new w(e[t]))},t.prototype._addNode=function(e,t,o){var n=new m,r=this.childItemsPath,s=i.isArray(r)?r[o]:r,l=e[t],a=l[s];if(n.dataItem=l,n.level=o,this.rows.push(n),i.isArray(a))for(var h=0;h<a.length;h++)this._addNode(a,h,o+1)},t.prototype._addGroup=function(e){var t=new m;if(t.level=e.level,t.dataItem=e,this.rows.push(t),e.isBottomLevel)for(var i=e.items,o=0;o<i.length;o++)this._addBoundRow(i,o);else for(o=0;o<e.groups.length;o++)this._addGroup(e.groups[o])},t._getSerializableProperties=function(e){var t=[];for(e=e.prototype;e!=Object.prototype;e=Object.getPrototypeOf(e))for(var i=Object.getOwnPropertyNames(e),o=0;o<i.length;o++){var n=i[o],r=Object.getOwnPropertyDescriptor(e,n);r&&r.set&&r.get&&"_"!=n[0]&&!n.match(/disabled|required/)&&t.push(n)}return t},t.prototype._copy=function(e,t){if("columns"==e){this.columns.clear();for(var o=i.asArray(t),n=0;n<o.length;n++){var r=new _;i.copy(r,o[n]),this.columns.push(r)}return!0}return!1},t.prototype._isInputElement=function(e){if(e instanceof HTMLElement){if("true"==e.contentEditable)return!0;var t=e.tagName.match(/^(BUTTON|A|INPUT|TEXTAREA|SELECT|OPTION)$/i);return t&&t.length>0}return!1},t.prototype._wantsInput=function(e){return this._isInputElement(e)&&!this.activeEditor&&!this._edtHdl._isNativeCheckbox(e)&&!i.hasClass(e,"wj-grid-ime")&&i.contains(document.body,e)},t._getMaxSupportedCssHeight=function(){if(!t._maxCssHeight){var e=1e6,i=document.createElement("div");i.style.visibility="hidden",document.body.appendChild(i);for(var o=e;o<=6e7&&(i.style.height=o+"px",i.offsetHeight==o);o+=5e5)e=o;document.body.removeChild(i),t._maxCssHeight=e}return t._maxCssHeight},t._getRtlMode=function(){if(!t._rtlMode){var e=i.createElement('<div dir="rtl" style="visibility:hidden;width:100px;height:100px;overflow:auto"><div style="width:2000px;height:2000px"></div></div>');document.body.appendChild(e);var o=e.scrollLeft;e.scrollLeft=-1e3;var n=e.scrollLeft;document.body.removeChild(e),t._rtlMode=n<0?"neg":o>0?"rev":"std"}return t._rtlMode},t._WJS_STICKY="wj-state-sticky",t._WJS_MEASURE="wj-state-measuring",t._WJS_UPDATING="wj-state-updating",t._MIN_VIRT_ROWS=200,t.controlTemplate='<div style="position:relative;width:100%;height:100%;overflow:hidden;max-width:inherit;max-height:inherit"><div wj-part="focus" aria-hidden="true" style="position:fixed;opacity:0;pointer-events:none;left:-10px;top:-10px"></div><div wj-part="root" style="position:absolute;width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch;max-width:inherit;max-height:inherit"><div wj-part="cells" class="wj-cells" style="position:absolute"></div><div wj-part="marquee" aria-hidden="true" class="wj-marquee" style="display:none;pointer-events:none;"><div style="width:100%;height:100%"></div></div></div><div wj-part="fcells" aria-hidden="true" class="wj-cells" style="position:absolute;pointer-events:none;overflow:hidden"></div><div wj-part="rh" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="rhcells" class="wj-rowheaders" style="position:relative"></div></div><div wj-part="cf" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="cfcells" class="wj-colfooters" style="position:relative"></div></div><div wj-part="ch" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="chcells" class="wj-colheaders" style="position:relative"></div></div><div wj-part="bl" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="blcells" class="wj-bottomleft" style="position:relative"></div></div><div wj-part="tl" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="tlcells" class="wj-topleft" style="position:relative"></div></div><div wj-part="sz" aria-hidden="true" style="position:relative;visibility:hidden"></div></div>',t}(i.Control);t.FlexGrid=s;var l=function(e){function t(t,o,n){var r=e.call(this)||this;return r._p=i.asType(t,u),r._rng=i.asType(o,g),r._data=n,r}return __extends(t,e),Object.defineProperty(t.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this._rng.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._rng.row},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._rng.col},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),t}(i.CancelEventArgs);t.CellRangeEventArgs=l;var a=function(e){function t(t,o,n){var r=e.call(this,t,o)||this;return r._cell=i.asType(n,HTMLElement),r}return __extends(t,e),Object.defineProperty(t.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0}),t}(l);t.FormatItemEventArgs=a;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"stayInEditMode",{get:function(){return this._stayInEditMode},set:function(e){this._stayInEditMode=i.asBoolean(e)},enumerable:!0,configurable:!0}),t}(l);t.CellEditEndingEventArgs=h;var c;!function(e){e[e.None=0]="None",e[e.Cell=1]="Cell",e[e.ColumnHeader=2]="ColumnHeader",e[e.RowHeader=3]="RowHeader",e[e.TopLeft=4]="TopLeft",e[e.ColumnFooter=5]="ColumnFooter",e[e.BottomLeft=6]="BottomLeft"}(c=t.CellType||(t.CellType={}));var u=function(){function e(e,t,o,n,r){this._offsetY=0,this._g=i.asType(e,s),this._ct=i.asInt(t),this._rows=i.asType(o,C),this._cols=i.asType(n,y),this._e=i.asType(r,HTMLElement),this._vrb=new g}return Object.defineProperty(e.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellType",{get:function(){return this._ct},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRange",{get:function(){return this._getViewRange()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._cols.getTotalSize()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._rows.getTotalSize()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0}),e.prototype.getCellData=function(e,t,o){var n,r=this._rows[i.asNumber(e,!1,!0)],s=null;if(i.isString(t)&&(t=this._cols.indexOf(t))<0)throw"Invalid column name or binding.";n=this._cols[i.asNumber(t,!1,!0)];var l=this._g?this._g._getBindingColumn(this,e,n):n;if(!l.binding||!r.dataItem||r.dataItem instanceof i.CollectionViewGroup?r._ubv&&(s=r._ubv[n._hash]):s=l._binding.getValue(r.dataItem),null==s)switch(this._ct){case c.ColumnHeader:e!=this._rows.length-1&&l==n||(s=l.header);break;case c.ColumnFooter:if(l.aggregate!=i.Aggregate.None&&r instanceof m){var a=this._g.collectionView;if(a){var h=i.tryCast(a,i.CollectionView);s=h?h.getAggregate(l.aggregate,l.binding):i.getAggregate(l.aggregate,a.items,l.binding)}}break;case c.Cell:if(l.aggregate!=i.Aggregate.None&&r instanceof m){var u=i.tryCast(r.dataItem,i.CollectionViewGroup);u&&(s=u.getAggregate(l.aggregate,l.binding,this._g.collectionView))}}return o&&(this.cellType==c.Cell&&l.dataMap&&(s=l.dataMap.getDisplayValue(s)),s=null!=s?i.Globalize.format(s,l.format):""),s},e.prototype.setCellData=function(e,t,o,n,r){void 0===n&&(n=!0),void 0===r&&(r=!0);var s,l=this._rows[i.asNumber(e,!1,!0)];if(i.isString(t)&&(t=this._cols.indexOf(t))<0)throw"Invalid column name or binding.";s=this._cols[i.asNumber(t,!1,!0)];var a=this._g?this._g._getBindingColumn(this,e,s):s;if(this._ct==c.Cell){if(a.dataMap&&null!=o&&(a.isRequired||""!=o)){var h=a.dataMap,u=h.getKeyValue(o);if(null==u&&null==h.getDisplayValue(null)){if(!h.isEditable||h.displayMemberPath!=h.selectedValuePath)return!1}else o=u}var d=i.DataType.Object;if(a.dataType)d=a.dataType;else{var g=this.getCellData(e,t,!1);d=i.getType(g)}if(i.isBoolean(a.isRequired))if(a.isRequired||""!==o&&null!==o){if(a.isRequired&&(""===o||null===o))return!1}else o=null,n=!1;if(n&&(o=i.changeType(o,d,a.format),d!=i.DataType.Object&&i.getType(o)!=d))return!1}if(l.dataItem&&a.binding){var p=a._binding,f=l.dataItem,_=p.getValue(f);if(o!==_&&!i.DateTime.equals(o,_)){p.setValue(f,o);var w=this._g.collectionView;if(w instanceof i.CollectionView&&f!=w.currentEditItem){var m=new i.NotifyCollectionChangedEventArgs(i.NotifyCollectionChangedAction.Change,f,w.items.indexOf(f));w.onCollectionChanged(m)}}}else l._ubv||(l._ubv={}),l._ubv[s._hash]=o;return r&&this._g&&this._g.invalidate(),!0},e.prototype.getCellBoundingRect=function(e,t,o){var n=this.rows[e],r=this.columns[t],s=new i.Rect(r.pos,n.pos,r.renderSize,n.renderSize);if(this._g.rightToLeft&&(s.left=this.hostElement.clientWidth-s.right,!i.isIE()&&!i.isFirefox())){var l=this.hostElement.parentElement;s.left-=l.offsetWidth-l.clientWidth}if(!o){var a=this.hostElement.getBoundingClientRect();s.left+=a.left,s.top+=a.top-this._offsetY}return e<this.rows.frozen&&(s.top-=this._g.scrollPosition.y),t<this.columns.frozen&&(s.left-=this._g.scrollPosition.x*(this._g.rightToLeft?-1:1)),s},e.prototype.getCellElement=function(t,i){for(var o=this.hostElement.children,n=Math.min(t+2,o.length),r=0;r<n;r++)for(var s=o[r].children,l=Math.min(i+2,s.length),a=0;a<l;a++){var h=s[a],c=h[e._INDEX_KEY];if(c&&(c.row==t&&c.col==i||c.rng&&c.rng.contains(t,i)))return h}return null},e.prototype.getSelectedState=function(e,t,i){var o=this._g,n=o.selectionMode,s=o._selHdl.selection,l=z,a=x;if(n!=l.None)switch(this._ct){case c.Cell:if(i||(i=o.getMergedRange(this,e,t)),i){if(i.contains(s.row,s.col))return o.showMarquee?a.None:a.Cursor;if(i.intersects(s))return a.Selected}if(s.row==e&&s.col==t)return o.showMarquee?a.None:a.Cursor;if(o.rows[e].isSelected||o.columns[t].isSelected)return a.Selected;if(i)switch(n){case l.Row:case l.RowRange:case l.ListBox:if(i.containsRow(s.row))return a.Selected}return s=o._selHdl._adjustSelection(s),n==z.ListBox?a.None:s.containsRow(e)&&s.containsColumn(t)?a.Selected:a.None;case c.ColumnHeader:if(o.showSelectedHeaders&r.Column&&(o.columns[t].isSelected||s.containsColumn(t)||s.intersectsColumn(i))&&(i&&(e=i.bottomRow),e==this.rows.length-1))return a.Selected;break;case c.RowHeader:if(o.showSelectedHeaders&r.Row&&(o.rows[e].isSelected||s.containsRow(e)||s.intersectsRow(i))&&(i&&(t=i.rightCol),t==this.columns.length-1))return a.Selected}return a.None},Object.defineProperty(e.prototype,"hostElement",{get:function(){return this._e},enumerable:!0,configurable:!0}),e.prototype._getOffsetY=function(){return this._offsetY},e.prototype._updateContent=function(e,t,i){var o=this._g,n=this._e,r=this._rows,s=this._cols,l=this._ct;if(l==c.ColumnHeader||l==c.ColumnFooter||l==c.RowHeader){var a=o._ptScrl,h=n.style;l==c.RowHeader?h.top=a.y+"px":o.rightToLeft?h.right=a.x+"px":h.left=a.x+"px"}this._offsetY!=i&&(e=!1,this._offsetY=i);var u,d=this._getViewRange();if(r.length<=o.virtualizationThreshold)u=new g(0,0,r.length-1,s.length-1);else if((u=d.clone()).isValid&&o.isTouching){u.row=Math.max(d.row-6,r.frozen),u.row2=Math.min(d.row2+6,r.length-1),u.col=Math.max(d.col-1,s.frozen),u.col2=Math.min(d.col2+1,s.length-1)}if(e&&!t&&this._vrb.contains(d)&&!r.frozen&&!s.frozen)return this._activeCell;e&&u.equals(this._vrb)||(t=!1),e&&!t&&this._ct!=c.TopLeft&&this._reorderCells(u,this._vrb),this._activeCell=null,this._vru=d,this._vrb=u,this._cf=o.cellFactory;var p=0;this._ct==c.Cell&&(p=this._renderColHdrRow(u,t));for(f=0;f<r.frozen&&f<r.length;f++)p=this._renderRow(f,u,t,p);for(var f=u.topRow;f<=u.bottomRow&&f>-1;f++)p=this._renderRow(f,u,t,p);for(;n.childElementCount>p;){var _=n.lastElementChild;n.removeChild(_),this._removeExtraCells(_,0)}return this._activeCell},e.prototype._clearCells=function(){for(var e=this.hostElement,t=e.childElementCount-1;t>=0;t--){var i=e.children[t];e.removeChild(i);for(var o=i.childElementCount-1;o>=0;o--)this._cf.disposeCell(i.children[o])}},e.prototype._reorderCells=function(e,t){if(!(this._rows.frozen>0||this._cols.frozen>0||e.columnSpan!=t.columnSpan||e.rowSpan!=t.rowSpan)&&t.isValid&&e.isValid&&e.intersects(t)&&e.row!=t.row){var i=e.row-t.row,o=Math.max(1,e.rowSpan-1),n=this._e;if(0!=i&&Math.abs(i)<o){var r=this._ct==c.Cell?1:0,s=n.childElementCount;if(i>0){var l=r,a=Math.min(r+i,s-1);(h=this._createRange(l,a))&&a<s-1&&n.appendChild(h.extractContents())}if(i<0){var a=s,l=Math.max(r,a+i),h=this._createRange(l,a);if(h&&l>r){var u=n.children[r];n.insertBefore(h.extractContents(),u)}}}}},e.prototype._createRange=function(e,t){var i,o=this._e.childElementCount;return t>e&&t<=o&&e>-1&&((i=document.createRange()).setStart(this._e,e),i.setEnd(this._e,t)),i},e.prototype._renderColHdrRow=function(e,t){var o=this._e.children[0];o||(o=i.createElement('<div class="wj-row" tabindex="-1" role="row"></div>',this._e)),i.setAttribute(o,"aria-selected",null);var n=0,r=this._g._getRowHeaderPath();r&&(n=this._renderRowHdrCell(o,-1,r.path));for(s=0;s<this.columns.frozen&&s<this.columns.length;s++)n=this._renderColHdrCell(o,s,e,t,n);for(var s=e.leftCol;s<=e.rightCol&&s>-1;s++)n=this._renderColHdrCell(o,s,e,t,n);return this._removeExtraCells(o,n),1},e.prototype._renderColHdrCell=function(t,o,n,r,s){var l=this.columns[o];if(l.renderSize<=0)return s;var a=t.children[s];a||(a=i.createElement('<div class="wj-cell" tabindex="-1" role="columnheader"></div>',t)),r||(a.textContent=this.columns[o].header,i.setCss(a,{position:"fixed",left:l.pos,top:-32e3,width:.1,height:.1,overflow:"hidden",opacity:"0"}));var h=this.grid;if(h.allowSorting){var c="none";switch(h._getBindingColumn(this,0,l).currentSort){case"+":c="ascending";break;case"-":c="descending"}i.setAttribute(a,"aria-sort",c)}return a[e._INDEX_KEY]={row:-1,col:o,panel:this},s+1},e.prototype._renderRowHdrCell=function(t,o,n){var r=t.children[0];return r||(r=i.createElement('<div class="wj-cell" tabindex="-1"></div>',t)),r.setAttribute("role",o<0?"columnheader":"rowheader"),r.textContent=n?n.toString():"",i.setCss(r,{position:"fixed",left:-32e3,top:-32e3,width:.1,height:.1,overflow:"hidden",opacity:"0"}),r[e._INDEX_KEY]={row:o,col:-1,panel:this},1},e.prototype._renderRow=function(e,t,o,n){var r=this._g,s=this.rows[e];if(s.renderSize<=0)return n;var l=this._e.children[n];if(l||(l=i.createElement('<div class="wj-row" tabindex="-1"></div>',this._e),this._ct==c.Cell&&l.setAttribute("role","row")),this._ct==c.Cell){var a=z;switch(r.selectionMode){case a.Row:case a.RowRange:case a.ListBox:var h=s.isSelected||this._g._selHdl.selection.containsRow(e);i.setAttribute(l,"aria-selected",!!h)}}var u=0;if(this._ct==c.Cell){var d=this._g._getRowHeaderPath();d&&(u=this._renderRowHdrCell(l,e,d.getValue(s.dataItem)))}for(g=0;g<this.columns.frozen&&g<this.columns.length;g++)u=this._renderCell(l,e,g,t,o,u);for(var g=t.leftCol;g<=t.rightCol&&g>-1;g++)u=this._renderCell(l,e,g,t,o,u);return this._removeExtraCells(l,u),n+1},e.prototype._renderCell=function(t,o,n,r,s,l){var a=this._g,h=a.getMergedRange(this,o,n);if(h){for(u=Math.max(r.row,h.row);u<o;u++)if(this.rows[u].isVisible)return l;for(var u=Math.max(r.col,h.col);u<n;u++)if(this.columns[u].isVisible)return l}if(this.columns[n].renderSize<=0&&(!h||h.getRenderSize(this).width<=0))return l;var d=!1;if(this.cellType==c.Cell){var g=a._selHdl.selection;d=g.row==o&&g.col==n||h&&h.contains(g.row,g.col)}var p=t.children[l],f=this.getSelectedState(o,n,h),_=x;return p&&s?(i.toggleClass(p,"wj-state-selected",f==_.Cursor),i.toggleClass(p,"wj-state-multi-selected",f==_.Selected),d&&(this._activeCell=p),l+1):(p||((p=document.createElement("div")).tabIndex=-1,this._ct==c.Cell&&p.setAttribute("role","gridcell"),t.appendChild(p)),d&&(this._activeCell=p),a.cellFactory.updateCell(this,o,n,p,h),p[e._INDEX_KEY]={row:o,col:n,rng:h,panel:this},l+1)},e.prototype._removeExtraCells=function(e,t){for(;e.childElementCount>t;){var i=e.lastElementChild;e.removeChild(i),this._cf.disposeCell(i)}},e.prototype._getViewRange=function(){var e=this._g,t=e._ptScrl,i=this._rows,o=this._cols,n=new g(0,0,i.length-1,o.length-1);if(this._ct==c.Cell||this._ct==c.RowHeader){var r=-t.y+this._offsetY,s=e._szClient.height;if((u=Math.min(i.frozen,i.length-1))>0&&(r+=d=i[u-1].pos,s-=d),n.row=Math.min(i.length-1,Math.max(i.frozen,i.getItemAt(r+1))),n.row2=i.getItemAt(r+s+1),e._clipToScreen()){var l=e.hostElement.getBoundingClientRect();l.top<0&&(n.row=Math.max(n.row,i.getItemAt(-l.top-e._ptScrl.y)-1)),l.bottom>innerHeight&&(n.row2=Math.min(n.row2,i.getItemAt(-l.top-e._ptScrl.y+innerHeight)+1))}}if(this._ct==c.Cell||this._ct==c.ColumnHeader){var a=-t.x,h=e._szClient.width,u=Math.min(o.frozen,o.length-1);if(u>0){var d=o[u-1].pos;a+=d,h-=d}n.col=Math.min(o.length-1,Math.max(o.frozen,o.getItemAt(a+1))),n.col2=o.getItemAt(a+h+1)}return i.length<=i.frozen&&(n.row=n.row2=-1),o.length<=o.frozen&&(n.col=n.col2=-1),n},e.prototype._getFrozenPos=function(){var e=this._rows.frozen,t=this._cols.frozen,o=e>0?this._rows[e-1]:null,n=t>0?this._cols[t-1]:null,r=o?o.pos+o.renderSize:0,s=n?n.pos+n.renderSize:0;return new i.Point(s,r)},e._INDEX_KEY="wj-cell-index",e}();t.GridPanel=u;var d=function(){function e(){}return e.prototype.updateCell=function(t,o,r,s,l,h){var u=t.grid,d=u.rightToLeft,p=t.cellType,f=t.rows,_=t.columns,w=f[o],v=_[r],y=o,C=r,b=w instanceof m?w:null,R=w instanceof N?w:null,E=v.renderWidth,S=w.renderHeight,z="wj-cell",H={display:""};if(0!=h&&s.firstElementChild&&(1==s.childNodes.length&&"checkbox"==s.firstElementChild.type||(s.textContent="")),l&&!l.isSingleCell){o=l.row,r=l.col,y=l.row2,C=l.col2,w=f[o],v=_[r],b=w instanceof m?w:null;var P=l.getRenderSize(t);S=P.height,E=P.width}var M=u._getBindingColumn(t,o,v),T=M.dataType==i.DataType.Boolean&&!M.dataMap,D=v.pos,O=w.pos;if(u._useFrozenDiv()&&p==c.Cell&&!u.editRange?(o<f.frozen&&r>=_.frozen&&(D+=u._ptScrl.x),r<_.frozen&&o>=f.frozen&&(O+=u._ptScrl.y)):(o<f.frozen&&(O-=u._ptScrl.y),r<_.frozen&&(D-=u._ptScrl.x)),d?H.right=D+"px":H.left=D+"px",H.top=O-t._getOffsetY()+"px",H.width=E+"px",H.height=S+"px",H.zIndex="",(o<f.frozen||r<_.frozen)&&(H.zIndex=o<f.frozen&&r<_.frozen?2:1),p==c.Cell?(b&&(z+=" wj-group"),u.showAlternatingRows&&w.visibleIndex%2!=0&&(l&&l.row!=l.row2||(z+=" wj-alt")),(o<f.frozen||r<_.frozen)&&(z+=" wj-frozen"),R&&(z+=" wj-new"),w.cssClass&&(z+=" "+w.cssClass),M.cssClass&&(z+=" "+M.cssClass)):(z+=" wj-header",u.showAlternatingRows&&o%2!=0&&(z+=" wj-header-alt")),(p==c.Cell||p==c.RowHeader)&&u._getShowErrors()){var L=u._getError(t,o,r);i.setAttribute(s,"title",L),L&&(z+=" wj-state-invalid")}var I=t.getSelectedState(o,r,l);switch(I!=x.None&&p==c.Cell&&!T&&u.editRange&&u.editRange.contains(o,r)&&(I=x.None),I){case x.Cursor:z+=" wj-state-selected";break;case x.Selected:z+=" wj-state-multi-selected"}if(y==f.frozen-1&&(z+=" wj-frozen-row"),C==_.frozen-1&&(z+=" wj-frozen-col"),(M.wordWrap||w.wordWrap)&&(z+=" wj-wrap"),H.textAlign=M.getAlignment(),H.paddingLeft=H.paddingRight=H.paddingTop=H.paddingBottom="",p==c.Cell&&u.rows.maxGroupLevel>-1&&r==u.columns.firstVisibleIndex&&u.treeIndent){var A=b?Math.max(0,b.level):u.rows.maxGroupLevel+1,k=u.treeIndent*A+u._cellPadding;d?H.paddingRight=k+"px":H.paddingLeft=k+"px"}if(0!=h){var B=t.getCellData(o,r,!1),V=t.getCellData(o,r,!0);if(p==c.Cell&&r==u.columns.firstVisibleIndex&&b&&b.hasChildren&&!this._isEditingCell(u,o,r))V||(V=b.getGroupHeader()),s.innerHTML=this._getTreeIcon(b)+" "+V,H.textAlign="";else if(p==c.ColumnHeader&&M.currentSort&&u.showSort&&(y==u._getSortRowIndex()||M!=v))z+=" wj-sort-"+("+"==M.currentSort?"asc":"desc"),s.innerHTML=i.escapeHtml(V)+"&nbsp;"+this._getSortIcon(M);else if(p!=c.RowHeader||r!=u.rowHeaders.columns.length-1||V)if(p!=c.Cell||M.dataType!=i.DataType.Boolean||M.dataMap||b&&!i.isBoolean(B))if(p==c.Cell&&this._isEditingCell(u,o,r)){var F=M.inputType;if(M.inputType||(F=M.dataType!=i.DataType.Number||M.dataMap?"text":"tel"),!M.dataMap&&!M.mask){var K=t.getCellData(o,r,!1);if(i.isNumber(K)){var W=K.toString(),G=M.format;if(G&&K!=Math.round(K)){var q=W.match(/\.(\d+)/)[1].length;G=G.replace(/([a-z])(\d*)(.*)/gi,"$01"+q+"$3")}V=i.Globalize.formatNumber(K,G,!0)}}s.innerHTML='<input type="'+F+'" class="wj-grid-editor wj-form-control">';var U=s.children[0];U.value=V,U.required=M.getIsRequired(),M.maxLength&&(U.maxLength=M.maxLength),U.style.textAlign=M.getAlignment(),H.paddingTop=H.paddingBottom="0px",M.mask&&new i._MaskProvider(U,M.mask),u._edtHdl._edt=U}else p==c.Cell&&(w.isContentHtml||M.isContentHtml)?s.innerHTML=V:s.textContent=V||"";else{var Y=s.firstChild;Y instanceof HTMLInputElement&&"checkbox"==Y.type||(s.innerHTML='<input type="checkbox" class="wj-cell-check" tabindex="-1"/>',Y=s.firstChild),Y.checked=1==B,Y.indeterminate=null==B,Y.disabled=!u.canEditCell(o,r),Y.disabled&&(Y.style.cursor="default"),u.editRange&&u.editRange.contains(o,r)&&(u._edtHdl._edt=Y)}else{var J=u.editableCollectionView,X=J?J.currentEditItem:null;X&&w.dataItem==X?s.innerHTML='<span class="wj-glyph-pencil"></span>':w instanceof N&&(s.innerHTML='<span class="wj-glyph-asterisk"></span>')}if(p==c.Cell&&n()&&M.dataMap&&u.showDropDown&&0!=M.showDropDown&&u.canEditCell(o,r)){e._ddIcon||(e._ddIcon=i.createElement('<div role="button" class="'+e._WJC_DROPDOWN+'"><span class="wj-glyph-down"></span></div>'));var Z=e._ddIcon.cloneNode(!0);s.appendChild(Z)}}var Q=!1;switch(p){case c.RowHeader:Q=!b&&!R&&w.allowDragging&&0!=(u.allowDragging&j.Rows),i.setAttribute(s,"draggable",Q?"true":null);break;case c.ColumnHeader:Q=v.allowDragging&&0!=(u.allowDragging&j.Columns),i.setAttribute(s,"draggable",Q?"true":null)}s.className!=z&&(s.className=z);var $=s.style;for(var ee in H)$[ee]=H[ee];if(u._edtHdl._edt&&u._edtHdl._edt.parentElement==s){var te=u._root,ie=te.getBoundingClientRect(),oe=s.getBoundingClientRect(),ne=ie.top+te.clientHeight-oe.top,re=ie.left+te.clientWidth-oe.left;oe.height>ne&&(s.style.height=ne+"px"),oe.width>re&&(s.style.width=re+"px")}if(u.itemFormatter&&u.itemFormatter(t,o,r,s),u.formatItem.hasHandlers){var se=e._fmtRng;se?se.setRange(o,r,y,C):se=e._fmtRng=new g(o,r,y,C);var le=new a(t,se,s);u.onFormatItem(le)}},e.prototype.disposeCell=function(e){},e.prototype.getEditorValue=function(e){var t=e._edtHdl._edt;if(t instanceof HTMLInputElement){if("checkbox"==t.type)return t.checked;var o=t.maxLength;return i.isNumber(o)&&o>-1&&t.value.length>o?t.value.substr(0,o):t.value}return null},e.prototype._isEditingCell=function(e,t,i){return e.editRange&&e.editRange.contains(t,i)},e.prototype._getTreeIcon=function(t){var i="wj-glyph-"+(t.isCollapsed?"":"down-")+(t.grid.rightToLeft?"left":"right");return'<span role="button" class="'+e._WJC_COLLAPSE+" "+i+'"></span>'},e.prototype._getSortIcon=function(e){return'<span class="wj-glyph-'+("+"==e.currentSort?"up":"down")+'"></span>'},e._WJC_COLLAPSE="wj-elem-collapse",e._WJC_DROPDOWN="wj-elem-dropdown",e}();t.CellFactory=d;var g=function(){function e(e,t,i,o){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===i&&(i=e),void 0===o&&(o=t),this.setRange(e,t,i,o)}return e.prototype.setRange=function(e,t,o,n){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===o&&(o=e),void 0===n&&(n=t),this._row=i.asInt(e),this._col=i.asInt(t),this._row2=i.asInt(o),this._col2=i.asInt(n)},Object.defineProperty(e.prototype,"row",{get:function(){return this._row},set:function(e){this._row=i.asInt(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},set:function(e){this._col=i.asInt(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"row2",{get:function(){return this._row2},set:function(e){this._row2=i.asInt(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col2",{get:function(){return this._col2},set:function(e){this._col2=i.asInt(e)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._row,this._col,this._row2,this._col2)},Object.defineProperty(e.prototype,"rowSpan",{get:function(){return Math.abs(this._row2-this._row)+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columnSpan",{get:function(){return Math.abs(this._col2-this._col)+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRow",{get:function(){return Math.min(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRow",{get:function(){return Math.max(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftCol",{get:function(){return Math.min(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightCol",{get:function(){return Math.max(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isValid",{get:function(){return this._row>-1&&this._col>-1&&this._row2>-1&&this._col2>-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingleCell",{get:function(){return this._row==this._row2&&this._col==this._col2},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,o){var n=i.tryCast(t,e);if(n)return n.topRow>=this.topRow&&n.bottomRow<=this.bottomRow&&n.leftCol>=this.leftCol&&n.rightCol<=this.rightCol;if(i.isInt(t)&&i.isInt(o))return t>=this.topRow&&t<=this.bottomRow&&o>=this.leftCol&&o<=this.rightCol;throw"contains expects a CellRange or row/column indices."},e.prototype.containsRow=function(e){return i.asInt(e)>=this.topRow&&e<=this.bottomRow},e.prototype.containsColumn=function(e){return i.asInt(e)>=this.leftCol&&e<=this.rightCol},e.prototype.intersects=function(e){return this.intersectsRow(e)&&this.intersectsColumn(e)},e.prototype.intersectsRow=function(e){return e&&!(this.bottomRow<e.topRow||this.topRow>e.bottomRow)},e.prototype.intersectsColumn=function(e){return e&&!(this.rightCol<e.leftCol||this.leftCol>e.rightCol)},e.prototype.getRenderSize=function(e){var t=new i.Size(0,0);if(this.isValid){for(var o=this.topRow;o<=this.bottomRow;o++)t.height+=e.rows[o].renderSize;for(var n=this.leftCol;n<=this.rightCol;n++)t.width+=e.columns[n].renderSize}return t},e.prototype.equals=function(t){return t instanceof e&&this._row==t._row&&this._col==t._col&&this._row2==t._row2&&this._col2==t._col2},e}();t.CellRange=g;var p;!function(e){e[e.Visible=1]="Visible",e[e.AllowResizing=2]="AllowResizing",e[e.AllowDragging=4]="AllowDragging",e[e.AllowMerging=8]="AllowMerging",e[e.AllowSorting=16]="AllowSorting",e[e.AutoGenerated=32]="AutoGenerated",e[e.Collapsed=64]="Collapsed",e[e.ParentCollapsed=128]="ParentCollapsed",e[e.Selected=256]="Selected",e[e.ReadOnly=512]="ReadOnly",e[e.HtmlContent=1024]="HtmlContent",e[e.WordWrap=2048]="WordWrap",e[e.HasTemplate=4096]="HasTemplate",e[e.RowDefault=3]="RowDefault",e[e.ColumnDefault=23]="ColumnDefault"}(p=t.RowColFlags||(t.RowColFlags={}));var f=function(){function e(){this._list=null,this._pos=0,this._idx=-1,this._vidx=-1}return Object.defineProperty(e.prototype,"visible",{get:function(){return this._getFlag(p.Visible)},set:function(e){this._setFlag(p.Visible,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisible",{get:function(){return!!this._getFlag(p.Visible)&&(!this._getFlag(p.ParentCollapsed)||this instanceof N)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._list&&this._list._dirty&&this._list._update(),this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._list&&this._list._dirty&&this._list._update(),this._idx},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibleIndex",{get:function(){return this._list&&this._list._dirty&&this._list._update(),this.isVisible?this._vidx:-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._sz},set:function(e){e!=this._sz&&(this._sz=i.asNumber(e,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderSize",{get:function(){if(!this.isVisible)return 0;var e=this._sz,t=this._list;return t&&((null==e||e<0)&&(e=Math.round(t.defaultSize)),null!=t.minSize&&e<t.minSize&&(e=t.minSize),null!=t.maxSize&&e>t.maxSize&&(e=t.maxSize)),null!=this._szMin&&e<this._szMin&&(e=this._szMin),null!=this._szMax&&e>this._szMax&&(e=this._szMax),Math.round(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowResizing",{get:function(){return this._getFlag(p.AllowResizing)},set:function(e){this._setFlag(p.AllowResizing,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowDragging",{get:function(){return this._getFlag(p.AllowDragging)},set:function(e){this._setFlag(p.AllowDragging,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowMerging",{get:function(){return this._getFlag(p.AllowMerging)},set:function(e){this._setFlag(p.AllowMerging,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){return this._getFlag(p.Selected)},set:function(e){if(this._setFlag(p.Selected,e,!0)){var t=this.grid;t&&t.refreshCells(!1,!0,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReadOnly",{get:function(){return this._getFlag(p.ReadOnly)},set:function(e){this._setFlag(p.ReadOnly,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isContentHtml",{get:function(){return this._getFlag(p.HtmlContent)},set:function(e){this.isContentHtml!=e&&(this._setFlag(p.HtmlContent,e),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wordWrap",{get:function(){return this._getFlag(p.WordWrap)},set:function(e){this._setFlag(p.WordWrap,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cssClass",{get:function(){return this._cssClass},set:function(e){e!=this._cssClass&&(this._cssClass=i.asString(e),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grid",{get:function(){return this._list?this._list._g:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collectionView",{get:function(){return this.grid?this.grid.collectionView:null},enumerable:!0,configurable:!0}),e.prototype.onPropertyChanged=function(){this._list&&(this._list._dirty=!0,this.grid.invalidate())},e.prototype._getFlag=function(e){return 0!=(this._f&e)},e.prototype._setFlag=function(e,t,i){return t!=this._getFlag(e)&&(this._f=t?this._f|e:this._f&~e,i||this.onPropertyChanged(),!0)},e}();t.RowCol=f;var _=function(e){function t(o){var n=e.call(this)||this;return n._f=p.ColumnDefault,n._hash=t._ctr.toString(36),t._ctr++,o&&i.copy(n,o),n}return __extends(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataType",{get:function(){return this._type},set:function(e){this._type!=e&&(this._type=i.asEnum(e,i.DataType),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRequired",{get:function(){return this._required},set:function(e){this._required=i.asBoolean(e,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showDropDown",{get:function(){return this._showDropDown},set:function(e){e!=this._showDropDown&&(this._showDropDown=i.asBoolean(e,!0),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropDownCssClass",{get:function(){return this._ddCssClass},set:function(e){this._ddCssClass=i.asString(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputType",{get:function(){return this._inpType},set:function(e){this._inpType=i.asString(e,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=i.asString(e,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxLength",{get:function(){return this._maxLen},set:function(e){this._maxLen=i.asNumber(e,!0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binding",{get:function(){return this._binding?this._binding.path:null},set:function(e){if(e!=this.binding){var t=i.asString(e);if(this._binding=t?new i.Binding(t):null,!this._type&&this.grid&&this._binding){var o=this.grid.collectionView;if(o&&o.sourceCollection&&o.sourceCollection.length){var n=o.sourceCollection[0];this._type=i.getType(this._binding.getValue(n))}}this.onPropertyChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortMemberPath",{get:function(){return this._bindingSort?this._bindingSort.path:null},set:function(e){if(e!=this.sortMemberPath){var t=i.asString(e);this._bindingSort=t?new i.Binding(t):null,this.onPropertyChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return null!=this._szStar?this._szStar:this.size},set:function(e){null!=t._parseStarSize(e)?(this._szStar=e,this.onPropertyChanged()):(this._szStar=null,this.size=i.asNumber(e,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minWidth",{get:function(){return this._szMin},set:function(e){e!=this._szMin&&(this._szMin=i.asNumber(e,!0,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._szMax},set:function(e){e!=this._szMax&&(this._szMax=i.asNumber(e,!0,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quickAutoSize",{get:function(){return this._quickSize},set:function(e){this._quickSize=i.asBoolean(e,!0)},enumerable:!0,configurable:!0}),t.prototype._getQuickAutoSize=function(){return!!this.grid._getQuickAutoSize()&&(i.isBoolean(this._quickSize)?this._quickSize:!this.isContentHtml&&!this._getFlag(p.HasTemplate))},Object.defineProperty(t.prototype,"renderWidth",{get:function(){return this.renderSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(e){this._align!=e&&(this._align=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),t.prototype.getAlignment=function(){var e=this._align;if(null==e&&(e="",!this._map))switch(this._type){case i.DataType.Boolean:e="center";break;case i.DataType.Number:e="right"}return e},t.prototype.getIsRequired=function(){return null!=this._required?this._required:this.dataType!=i.DataType.String||(null!=this.dataMap||this._mask&&this._mask.length>0)},Object.defineProperty(t.prototype,"header",{get:function(){return this._hdr?this._hdr:this.binding},set:function(e){this._hdr!=e&&(this._hdr=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataMap",{get:function(){return this._map},set:function(e){this._map!=e&&(this._map&&this._map.mapChanged.removeHandler(this.onPropertyChanged,this),i.isArray(e)&&(e=new S(e,null,null)),this._map=i.asType(e,S,!0),this._map&&this._map.mapChanged.addHandler(this.onPropertyChanged,this),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._fmt},set:function(e){this._fmt!=e&&(this._fmt=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowSorting",{get:function(){return this._getFlag(p.AllowSorting)},set:function(e){this._setFlag(p.AllowSorting,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSort",{get:function(){if(this.grid&&this.grid.collectionView&&this.grid.collectionView.canSort)for(var e=this.grid.collectionView.sortDescriptions,t=0;t<e.length;t++)if(e[t].property==this._getBindingSort())return e[t].ascending?"+":"-";return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aggregate",{get:function(){return null!=this._agg?this._agg:i.Aggregate.None},set:function(e){e!=this._agg&&(this._agg=i.asEnum(e,i.Aggregate),this.onPropertyChanged())},enumerable:!0,configurable:!0}),t.prototype._getBindingSort=function(){return this.sortMemberPath?this.sortMemberPath:this.binding?this.binding:null},t._parseStarSize=function(e){if(i.isString(e)&&e.length>0&&"*"==e[e.length-1]){var t=1==e.length?1:1*e.substr(0,e.length-1);if(t>0&&!isNaN(t))return t}return null},t._ctr=0,t}(f);t.Column=_;var w=function(e){function t(t){var i=e.call(this)||this;return i._f=p.ColumnDefault,i._data=t,i}return __extends(t,e),Object.defineProperty(t.prototype,"dataItem",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.size},set:function(e){this.size=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderHeight",{get:function(){return this.renderSize},enumerable:!0,configurable:!0}),t}(f);t.Row=w;var m=function(e){function t(){var t=e.call(this)||this;return t._level=-1,t.isReadOnly=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},set:function(e){i.asInt(e),e!=this._level&&(this._level=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasChildren",{get:function(){if(null!=this.grid&&null!=this._list){this._list._update();var e=this.index<this._list.length-1?this._list[this.index+1]:null,o=i.tryCast(e,t),n=i.tryCast(e,N);return null!=e&&null==n&&(null==o||o.level>this.level)}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCollapsed",{get:function(){return this._getFlag(p.Collapsed)},set:function(e){i.asBoolean(e),e!=this.isCollapsed&&null!=this._list&&this._setCollapsed(e)},enumerable:!0,configurable:!0}),t.prototype.getGroupHeader=function(){var e=this.grid,t=e.groupHeaderFormat?e.groupHeaderFormat:i.culture.FlexGrid.groupHeaderFormat,o=i.tryCast(this.dataItem,i.CollectionViewGroup);if(o&&t){var n=o.groupDescription.propertyName,r=o.name,s=e.getColumn(n),l=this.isContentHtml;s&&(l=l||s.isContentHtml,s.header&&(n=s.header),s.dataMap?r=s.dataMap.getDisplayValue(r):s.format&&(r=i.Globalize.format(r,s.format)));var a=o.getAggregate(i.Aggregate.CntAll,null,e.collectionView);return i.format(t,{name:i.escapeHtml(n),value:l?r:i.escapeHtml(r),level:o.level,count:a})}return""},t.prototype._setCollapsed=function(e){var o,n=this,r=this.grid,s=r.rows,a=this.getCellRange(),h=new l(r.cells,new g(this.index,-1));r.onGroupCollapsedChanging(h),h.cancel||(r.deferUpdate(function(){n._setFlag(p.Collapsed,e);for(var r=a.topRow+1;r<=a.bottomRow&&r>-1&&r<s.length;r++)s[r]._setFlag(p.ParentCollapsed,e),null!=(o=i.tryCast(s[r],t))&&o.isCollapsed&&(r=o.getCellRange().bottomRow)}),r.onGroupCollapsedChanged(h))},t.prototype.getCellRange=function(){for(var e=this._list,o=this.index,n=e.length-1,r=o+1;r<=n;r++){var s=i.tryCast(e[r],t);if(null!=s&&s.level<=this.level){n=r-1;break}}return new g(o,0,n,this.grid.columns.length-1)},t}(w);t.GroupRow=m;var v=function(e){function t(t,o){var n=e.call(this)||this;return n._frozen=0,n._vlen=0,n._szDef=28,n._szTot=0,n._dirty=!1,n._g=i.asType(t,s),n._szDef=i.asNumber(o,!1,!0),n}return __extends(t,e),Object.defineProperty(t.prototype,"defaultSize",{get:function(){return this._szDef},set:function(e){this._szDef!=e&&(this._szDef=i.asNumber(e,!1,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frozen",{get:function(){return this._frozen},set:function(e){e!=this._frozen&&(this._frozen=i.asNumber(e,!1,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),t.prototype.isFrozen=function(e){return e<this.frozen},Object.defineProperty(t.prototype,"minSize",{get:function(){return this._szMin},set:function(e){e!=this._szMin&&(this._szMin=i.asNumber(e,!0,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSize",{get:function(){return this._szMax},set:function(e){e!=this._szMax&&(this._szMax=i.asNumber(e,!0,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),t.prototype.getTotalSize=function(){return this._dirty&&this._update(),this._szTot},Object.defineProperty(t.prototype,"visibleLength",{get:function(){return this._dirty&&this._update(),this._vlen},enumerable:!0,configurable:!0}),t.prototype.getItemAt=function(e){if(this._dirty&&this._update(),e<=0&&this.length>0)return 0;e=Math.round(e);for(var t,i,o=this.length,n=0,r=o-1;n<=r;)if(t=n+r>>>1,(i=this[t])._pos>e&&t>0)r=t-1;else{if(!(i._pos+i.renderSize<=e&&t<o-1)){for(;t>0&&!this[t].visible;)t--;for(;t<o-1&&!this[t].visible;)t++;return t}n=t+1}return r},t.prototype.getNextCell=function(e,t,i){var o;switch(t){case H.Next:for(o=e+1;o<this.length;o++)if(this[o].renderSize>0)return o;break;case H.Prev:for(o=e-1;o>=0;o--)if(this[o].renderSize>0)return o;break;case H.End:for(o=this.length-1;o>=0;o--)if(this[o].renderSize>0)return o;break;case H.Home:for(o=0;o<this.length;o++)if(this[o].renderSize>0)return o;break;case H.NextPage:return(o=this.getItemAt(this[e].pos+i))<0?this.getNextCell(e,H.End,i):o==e&&o<this.length-1?o+1:o;case H.PrevPage:return(o=this.getItemAt(this[e].pos-i))<0?this.getNextCell(e,H.Home,i):o==e&&o>0?o-1:o}return e},t.prototype.canMoveElement=function(e,t){if(t==e)return!1;if(e<0||e>=this.length||t>=this.length)return!1;t<0&&(t=this.length-1);for(var i=Math.min(e,t),o=Math.max(e,t),n=i;n<=o;n++)if(!this[n].allowDragging)return!1;return!(this[t]instanceof N)},t.prototype.moveElement=function(e,t){if(this.canMoveElement(e,t)){var i=this[e];this.removeAt(e),t<0&&(t=this.length),this.insert(t,i)}},t.prototype.onCollectionChanged=function(t){void 0===t&&(t=i.NotifyCollectionChangedEventArgs.reset),this._dirty=!0,this._g.invalidate(),e.prototype.onCollectionChanged.call(this,t)},t.prototype.push=function(t){return t._list=this,e.prototype.push.call(this,t)},t.prototype.splice=function(t,i,o){return o&&(o._list=this),e.prototype.splice.call(this,t,i,o)},t.prototype.beginUpdate=function(){this._update(),e.prototype.beginUpdate.call(this)},t.prototype._update=function(){if(this._dirty&&!this.isUpdating){this._dirty=!1;for(var e=0,t=0,i=void 0,o=void 0,n=0;n<this.length;n++)(o=this[n])._idx=n,o._vidx=e,o._list=this,o._pos=t,(i=o.renderSize)>0&&(t+=i,e++);return this._vlen=e,this._szTot=t,!0}return!1},t}(i.ObservableArray);t.RowColCollection=v;var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._firstVisible=-1,t}return __extends(t,e),t.prototype.getColumn=function(e){var t=i.isNumber(e)?e:this.indexOf(e);return t>-1?this[t]:null},t.prototype.indexOf=function(t){if(t instanceof _)return e.prototype.indexOf.call(this,t);for(i=0;i<this.length;i++)if(this[i].name==t)return i;for(var i=0;i<this.length;i++)if(this[i].binding==t)return i;return-1},Object.defineProperty(t.prototype,"firstVisibleIndex",{get:function(){return this._dirty&&this._update(),this._firstVisible},enumerable:!0,configurable:!0}),t.prototype._update=function(){if(e.prototype._update.call(this)){this._firstVisible=-1;for(var t=0;t<this.length;t++)if(this[t].visible){this._firstVisible=t;break}return!0}return!1},t.prototype._updateStarSizes=function(e){for(var t,i=0,o=0;o<this.length;o++)(r=this[o]).isVisible&&(r._szStar?(i+=_._parseStarSize(r._szStar),t=r):e-=r.renderWidth);if(t){for(var n=e,o=0;o<this.length;o++){var r=this[o];r.isVisible&&r._szStar&&(r==t&&n>0?r._sz=n:(r._sz=Math.max(0,Math.round(_._parseStarSize(r._szStar)/i*e)),n-=r.renderWidth))}return this._dirty=!0,this._update(),!0}return!1},t}(v);t.ColumnCollection=y;var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._maxLevel=-1,t}return __extends(t,e),Object.defineProperty(t.prototype,"maxGroupLevel",{get:function(){return this._dirty&&this._update(),this._maxLevel},enumerable:!0,configurable:!0}),t.prototype._update=function(){if(e.prototype._update.call(this)){this._maxLevel=-1;for(var t=0;t<this.length;t++){var o=i.tryCast(this[t],m);o&&o.level>this._maxLevel&&(this._maxLevel=o.level)}return!0}return!1},t}(v);t.RowCollection=C;var b=function(){function e(t,o){this._row=-1,this._col=-1,this._edge=0;var n;if(t instanceof Element)(D=(T=i.closest(t,".wj-cell"))?T[u._INDEX_KEY]:null)&&(this._row=D.row,this._col=D.col,this._rng=D.rng,this._p=D.panel,this._g=D.panel.grid);else{if(t instanceof s)n=this._g=t;else{if(!(t instanceof u))throw"First parameter should be a FlexGrid or GridPanel.";this._p=t,n=this._g=this._p.grid}var l;o instanceof MouseEvent&&(l=o,"mousedown"==o.type&&(n._rcBounds=null)),o=i.mouseToPage(o),this._pt=o.clone();var a=n.controlRect,h=n._szClient,d=n.topLeftCells,g=n._eTL,p=n.headersVisibility,f=r,_=p&f.Row?d.columns.getTotalSize():0,w=p&f.Column?d.rows.getTotalSize():0,m=p&f.Column?w+g.offsetTop:0,v=n._eBL,y=v.offsetHeight;if(o.x-=a.left,o.y-=a.top,this._g.rightToLeft&&(o.x=a.width-o.x),!this._p&&o.x>=0&&o.y>=g.offsetTop&&h&&o.x<=h.width+_&&o.y<=h.height+m&&(o.y<m?this._p=o.x<_?n.topLeftCells:n.columnHeaders:o.y<v.offsetTop?this._p=o.x<_?n.rowHeaders:n.cells:this._p=o.x<_?n.bottomLeftCells:n.columnFooters),null!=this._p){var C=this._p.rows,b=this._p.columns,R=this._p.cellType,E=c,S=this._p._getFrozenPos(),z=R==E.TopLeft||R==E.ColumnHeader?w:R==E.BottomLeft||R==E.ColumnFooter?y:C.getTotalSize(),x=R==E.TopLeft||R==E.BottomLeft||R==E.RowHeader?_:b.getTotalSize();R==E.RowHeader||R==E.Cell?(o.y-=w,(o.y>S.y||S.y<=0)&&(o.y-=n._ptScrl.y,o.y+=this._p._getOffsetY())):R!=E.BottomLeft&&R!=E.ColumnFooter||(o.y-=v.offsetTop),R!=E.ColumnHeader&&R!=E.Cell&&R!=E.ColumnFooter||(o.x-=_,(o.x>S.x||S.x<=0)&&(o.x-=n._ptScrl.x)),R!=E.ColumnHeader&&R!=E.TopLeft||(o.y-=m-w),this._edge=0;var H=e._SZEDGE[this._g.isTouching?1:0];if(this._g.isTouching&&(H=e._SZEDGE[1],o.x-=H/2),this._row=o.y>z?-1:C.getItemAt(o.y),this._col=o.x>x?-1:b.getItemAt(o.x),this._row<0||this._col<0)return void(this._p=null);if(this._col>-1){var P=b[this._col];o.x-P.pos<=H&&(this._edge|=1),P.pos+P.renderSize-o.x<=H&&(this._edge|=4)}if(this._row>-1){var M=C[this._row];o.y-M.pos<=H&&(this._edge|=2),M.pos+M.renderSize-o.y<=H&&(this._edge|=8)}}if(!(8&this._edge)&&l instanceof MouseEvent){var T=i.closest(l.target,".wj-cell"),D=T?T[u._INDEX_KEY]:null;D&&!D.rng&&D.panel==this._p&&this._row!=D.row&&(this._row=D.row)}}}return Object.defineProperty(e.prototype,"point",{get:function(){return this._pt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellType",{get:function(){return this._p?this._p.cellType:c.None},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grid",{get:function(){return this._p?this._p.grid:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){return this._rng||(this._rng=new g(this._row,this._col)),this._rng},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeLeft",{get:function(){return 0!=(1&this._edge)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeTop",{get:function(){return 0!=(2&this._edge)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeRight",{get:function(){return 0!=(4&this._edge)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeBottom",{get:function(){return 0!=(8&this._edge)},enumerable:!0,configurable:!0}),e._SZEDGE=[5,30],e}();t.HitTestInfo=b;var R;!function(e){e[e.None=0]="None",e[e.Cells=1]="Cells",e[e.ColumnHeaders=2]="ColumnHeaders",e[e.RowHeaders=4]="RowHeaders",e[e.AllHeaders=6]="AllHeaders",e[e.All=7]="All"}(R=t.AllowMerging||(t.AllowMerging={}));var E=function(){function e(e){this._g=e}return e.prototype.getMergedRange=function(e,t,o,n){void 0===n&&(n=!0);var r,s,l=e.cellType,a=e.columns,h=e.rows,u=h[t],d=a[o];if(u instanceof N)return null;if(u instanceof m&&u.dataItem instanceof i.CollectionViewGroup){if(r=new g(t,o),d.aggregate==i.Aggregate.None){for(;r.col>0&&a[r.col-1].aggregate==i.Aggregate.None&&r.col!=a.frozen;)r.col--;for(;r.col2<a.length-1&&a[r.col2+1].aggregate==i.Aggregate.None&&r.col2+1!=a.frozen;)r.col2++}for(;r.col<o&&!a[r.col].visible;)r.col++;return r.isSingleCell?null:r}var p=!1;switch(this._g.allowMerging){case R.None:p=!0;break;case R.Cells:p=l!=c.Cell;break;case R.ColumnHeaders:p=l!=c.ColumnHeader&&l!=c.TopLeft;break;case R.RowHeaders:p=l!=c.RowHeader&&l!=c.TopLeft;break;case R.AllHeaders:p=l==c.Cell}if(p)return null;if(a[o].allowMerging){r=new g(t,o);var f=0,_=h.length-1;t>=h.frozen?!n||l!=c.Cell&&l!=c.RowHeader||(f=(s=e._getViewRange()).topRow,_=s.bottomRow):_=h.frozen-1;for(var w=t-1;w>=f&&this._mergeCell(e,w,o,t,o);w--)r.row=w;for(var v=t+1;v<=_&&this._mergeCell(e,t,o,v,o);v++)r.row2=v;for(;r.row<t&&!h[r.row].visible;)r.row++;if(!r.isSingleCell)return r}if(h[t].allowMerging){r=new g(t,o);var y=0,C=a.length-1;o>=a.frozen?!n||l!=c.Cell&&l!=c.ColumnHeader||(y=(s=e._getViewRange()).leftCol,C=s.rightCol):C=a.frozen-1;for(var b=o-1;b>=y&&this._mergeCell(e,t,b,t,o);b--)r.col=b;for(var E=o+1;E<=C&&this._mergeCell(e,t,o,t,E);E++)r.col2=E;for(;r.col<o&&!a[r.col].visible;)r.col++;if(!r.isSingleCell)return r}return null},e.prototype._mergeCell=function(e,t,i,o,n){var r=e.rows[t],s=e.rows[o];if(r instanceof m||r instanceof N||s instanceof m||s instanceof N)return!1;if(t!=o&&e.rows.isFrozen(t)!=e.rows.isFrozen(o))return!1;if(i!=n&&e.columns.isFrozen(i)!=e.columns.isFrozen(n))return!1;if(t!=o){if(i>0&&(r.allowMerging&&this._mergeCell(e,t,i-1,t,i)||s.allowMerging&&this._mergeCell(e,o,i-1,o,i)))return!1;if(n<e.columns.length-1&&(r.allowMerging&&this._mergeCell(e,t,n,t,n+1)||s.allowMerging&&this._mergeCell(e,o,n,o,n+1)))return!1}return e.getCellData(t,i,!0)==e.getCellData(o,n,!0)},e}();t.MergeManager=E;var S=function(){function e(e,t,o){if(this.mapChanged=new i.Event,i.isArray(e)&&!t&&!o){for(var n=[],r=0;r<e.length;r++)n.push({value:e[r]});e=n,t=o="value"}this._cv=i.asCollectionView(e),this._keyPath=i.asString(t,!1),this._displayPath=i.asString(o,!1),this._cv.collectionChanged.addHandler(this.onMapChanged,this)}return Object.defineProperty(e.prototype,"sortByDisplayValues",{get:function(){return 1!=this._sortByKey},set:function(e){this._sortByKey=!i.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedValuePath",{get:function(){return this._keyPath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayMemberPath",{get:function(){return this._displayPath},enumerable:!0,configurable:!0}),e.prototype.getKeyValue=function(e){var t=this._indexOf(e,this._displayPath,!1);return t>-1?this._cv.sourceCollection[t][this._keyPath]:null},e.prototype.getDisplayValue=function(e){if(!this._hash){this._hash={};var t=this._cv.sourceCollection;if(t&&this._keyPath&&this._displayPath)for(var i=t.length-1;i>=0;i--){var o=t[i],n=o[this._keyPath],r=o[this._displayPath];this._hash[n]=r}}var s=this._hash[e];return null!=s?s:e},e.prototype.getDisplayValues=function(e){var t=[];if(this._cv&&this._displayPath)for(var i=this._cv.items,o=0;o<i.length;o++)t.push(i[o][this._displayPath]);return t},e.prototype.getKeyValues=function(){var e=[];if(this._cv&&this._keyPath)for(var t=this._cv.items,i=0;i<t.length;i++)e.push(t[i][this._keyPath]);return e},Object.defineProperty(e.prototype,"isEditable",{get:function(){return this._editable},set:function(e){this._editable=i.asBoolean(e)},enumerable:!0,configurable:!0}),e.prototype.onMapChanged=function(e){this._hash=null,this.mapChanged.raise(this,e)},e.prototype._indexOf=function(e,t,i){var o=-1,n=-1;if(this._cv&&t)for(var r=null!=e?e.toString():"",s=i?r:r.toLowerCase(),l=this._cv.sourceCollection,a=0;a<l.length;a++){var h=l[a],c=h[t];if(c==e?o=a:i||c.length!=s.length||c.toLowerCase()!=s?null!=c&&c.toString()==r&&(o=a):o=a,o==a){if(!this._cv.filter||this._cv.filter(h))return o;n<0&&(n=o)}}return n},e}();t.DataMap=S;var z;!function(e){e[e.None=0]="None",e[e.Cell=1]="Cell",e[e.CellRange=2]="CellRange",e[e.Row=3]="Row",e[e.RowRange=4]="RowRange",e[e.ListBox=5]="ListBox"}(z=t.SelectionMode||(t.SelectionMode={}));var x;!function(e){e[e.None=0]="None",e[e.Selected=1]="Selected",e[e.Cursor=2]="Cursor"}(x=t.SelectedState||(t.SelectedState={}));var H;!function(e){e[e.None=0]="None",e[e.Next=1]="Next",e[e.Prev=2]="Prev",e[e.NextPage=3]="NextPage",e[e.PrevPage=4]="PrevPage",e[e.Home=5]="Home",e[e.End=6]="End",e[e.NextCell=7]="NextCell",e[e.PrevCell=8]="PrevCell"}(H=t.SelMove||(t.SelMove={}));var P=function(){function e(e){this._sel=new g(0,0),this._mode=z.CellRange,this._g=e}return Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this._mode},set:function(e){if(e!=this._mode){var t=z;if(e==t.ListBox||this._mode==t.ListBox)for(var i=this._g.rows,o=0;o<i.length;o++){var n=i[o],r=e==z.ListBox&&this._sel.containsRow(o);n._setFlag(p.Selected,r,!0)}switch(e){case t.None:this._sel.setRange(-1,-1);break;case t.Cell:this._sel.row2=this._sel.row,this._sel.col2=this._sel.col;break;case t.Row:this._sel.row2=this._sel.row}this._mode=e,this._g.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._sel},set:function(e){this.select(e)},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){void 0===t&&(t=!0),i.isNumber(e)&&i.isNumber(t)&&(e=new g(e,t),t=!0),e=i.asType(e,g);var o=this._g,n=this._sel,r=e,s=!1,a=z;switch(o.selectionMode){case a.Cell:e.row2=e.row,e.col2=e.col;break;case a.Row:e.row2=e.row;break;case a.ListBox:s=!0}var h=r.equals(n);if(s&&r.row>-1&&!o.rows[r.row].isSelected&&(h=!1),h)t&&o.scrollIntoView(r.row,r.col);else{var c=new l(o.cells,r);if(o.onSelectionChanging(c)){if(s&&(r.row!=n.row||r.rowRange>1)){for(var u=0;u<o.rows.length;u++)o.rows[u]._setFlag(p.Selected,r.containsRow(u),!0);o.refreshCells(!1,!0,!0)}if(r.row=Math.min(r.row,o.rows.length-1),r.row2=Math.min(r.row2,o.rows.length-1),this._sel=r,o.refreshCells(!1,!0,!0),t&&o.scrollIntoView(r.row,r.col),o.collectionView){var d=o._getCvIndex(r.row);o.collectionView.moveCurrentToPosition(d)}o.onSelectionChanged(c)}}},e.prototype.moveSelection=function(e,t,i){var o,n,r=this._g,s=r.rows,l=r.columns,a=this._getReferenceCell(e,t,i),h=Math.max(0,r._szClient.height-r.columnHeaders.height);if(t==H.NextCell)n=l.getNextCell(a.col,H.Next,h),o=a.row,n==a.col&&(o=s.getNextCell(o,H.Next,h))>a.row&&(n=l.getNextCell(0,H.Next,h),n=l.getNextCell(n,H.Prev,h)),r.select(o,n);else if(t==H.PrevCell)n=l.getNextCell(a.col,H.Prev,h),o=a.row,n==a.col&&(o=s.getNextCell(o,H.Prev,h))<a.row&&(n=l.getNextCell(l.length-1,H.Prev,h),n=l.getNextCell(n,H.Next,h)),r.select(o,n);else if(o=s.getNextCell(a.row,e,h),n=l.getNextCell(a.col,t,h),i){var c=r._selHdl._sel;r.select(new g(o,n,c.row2,c.col2))}else r.select(o,n)},e.prototype._getReferenceCell=function(e,t,i){var o=this._g,n=o._selHdl._sel,r=o.getMergedRange(o.cells,n.row,n.col);if(!r||r.isSingleCell)return n;switch(r=r.clone(),e){case H.Next:case H.NextCell:r.row=r.bottomRow;break;case H.None:r.row=n.row}switch(t){case H.Next:case H.NextCell:r.col=r.rightCol;break;case H.None:r.col=n.col}return r},e.prototype._adjustSelection=function(e){switch(this._mode){case z.Cell:return new g(e.row,e.col,e.row,e.col);case z.Row:return new g(e.row,0,e.row,this._g.columns.length-1);case z.RowRange:case z.ListBox:return new g(e.row,0,e.row2,this._g.columns.length-1)}return e},e}();t._SelectionHandler=P;var M;!function(e){e[e.None=0]="None",e[e.MoveDown=1]="MoveDown",e[e.MoveAcross=2]="MoveAcross",e[e.Cycle=3]="Cycle",e[e.CycleOut=4]="CycleOut"}(M=t.KeyAction||(t.KeyAction={}));var T=function(){function e(e){this._kaTab=M.None,this._kaEnter=M.MoveDown,this._g=e;var t=e.hostElement;e.addEventListener(t,"keypress",this._keypress.bind(this)),e.addEventListener(t,"keydown",this._keydown.bind(this))}return e.prototype._keydown=function(e){var t=this._g,o=t.selection,n=e.ctrlKey||e.metaKey,r=e.shiftKey,s=(e.target,!0);if(this._altDown=!1,!t._wantsInput(e.target)&&t.isRangeValid(o)&&!e.defaultPrevented&&(!t.activeEditor||!t._edtHdl._keydown(e))){var a=i.tryCast(t.rows[o.row],m),h=t.editableCollectionView,c=e.keyCode;if(t.autoClipboard){if(n&&(67==c||45==c)){var u=new l(t.cells,o);if(t.onCopying(u)){var d=t.getClipString()+"\r\n";i.Clipboard.copy(d),t.onCopied(u)}else e.preventDefault();return void e.stopPropagation()}if(n&&86==c||r&&45==c){if(!t.isReadOnly){var p=new l(t.cells,o);t.onPasting(p)?i.Clipboard.paste(function(e){t.setClipString(e),t.onPasted(p)}):e.preventDefault()}return void e.stopPropagation()}}if(t.rightToLeft)switch(c){case i.Key.Left:c=i.Key.Right;break;case i.Key.Right:c=i.Key.Left}var f=H,_=z;switch(c){case i.Key.Space:if(r&&o.isValid)switch(t.selectionMode){case _.CellRange:case _.Row:case _.RowRange:case _.ListBox:t.select(new g(o.row,0,o.row,t.columns.length-1))}else if(n&&o.isValid)switch(t.selectionMode){case _.CellRange:t.select(new g(0,o.col,t.rows.length-1,o.col))}else(s=this._startEditing(!0,e))&&setTimeout(function(){var e=t.activeEditor;e&&(e.disabled||e.readOnly?t.finishEditing():"checkbox"==e.type?(e.checked=!e.checked,t.finishEditing()):i.setSelectionRange(e,e.value.length))});break;case 65:if(n)switch(t.selectionMode){case _.CellRange:case _.Row:case _.RowRange:case _.ListBox:t.select(new g(0,0,t.rows.length-1,t.columns.length-1))}else s=!1;break;case i.Key.Left:n||e.altKey?s=!1:o.isValid&&0==o.col&&null!=a&&!a.isCollapsed&&a.hasChildren?a.isCollapsed=!0:this._moveSel(f.None,n?f.Home:f.Prev,r);break;case i.Key.Right:n||e.altKey?s=!1:o.isValid&&0==o.col&&null!=a&&a.isCollapsed?a.isCollapsed=!1:this._moveSel(f.None,n?f.End:f.Next,r);break;case i.Key.Up:n?s=!1:(this._altDown=e.altKey,e.altKey?s=t._edtHdl._toggleListBox(e):this._moveSel(f.Prev,f.None,r));break;case i.Key.Down:n?s=!1:(this._altDown=e.altKey,e.altKey?s=t._edtHdl._toggleListBox(e):this._moveSel(f.Next,f.None,r));break;case i.Key.PageUp:this._altDown=e.altKey,this._moveSel(e.altKey?f.Home:f.PrevPage,f.None,r);break;case i.Key.PageDown:this._altDown=e.altKey,this._moveSel(e.altKey?f.End:f.NextPage,f.None,r);break;case i.Key.Home:this._moveSel(n?f.Home:f.None,f.Home,r);break;case i.Key.End:this._moveSel(n?f.End:f.None,f.End,r);break;case i.Key.Tab:s=this._performKeyAction(t.keyActionTab,r);break;case i.Key.Enter:s=this._performKeyAction(t.keyActionEnter,r),!r&&h&&null!=h.currentEditItem&&t._edtHdl._commitRowEdits();break;case i.Key.Escape:if(s=!1,h&&(h.currentAddItem||h.currentEditItem)){var w=new l(t.cells,t.selection);w.cancel=!0,t.onRowEditEnding(w),h.currentAddItem&&h.cancelNew(),h.currentEditItem&&h.cancelEdit(),t.onRowEditEnded(w),s=!0}t._mouseHdl.resetMouseState();break;case i.Key.Delete:case i.Key.Back:s=this._deleteSel(e);break;case i.Key.F2:s=this._startEditing(!0,e);break;case i.Key.F4:s=t._edtHdl._toggleListBox(e);break;default:s=!1}s&&(t.containsFocus()||t.focus(),e.preventDefault(),e.stopPropagation())}},e.prototype._performKeyAction=function(e,t){var i=M,o=H;switch(e){case i.MoveDown:return this._moveSel(t?o.Prev:o.Next,o.None,!1),!0;case i.MoveAcross:return this._moveSel(o.None,t?o.Prev:o.Next,!1),!0;case i.Cycle:return this._moveSel(o.None,t?o.PrevCell:o.NextCell,!1),!0;case i.CycleOut:var n=this._g.selection;return this._moveSel(o.None,t?o.PrevCell:o.NextCell,!1),!n.equals(this._g.selection)}return!1},e.prototype._keypress=function(e){var t=this._g;if(!t._wantsInput(e.target)&&!e.defaultPrevented)if(this._altDown)e.preventDefault();else{if(t.activeEditor)t._edtHdl._keypress(e);else if(e.charCode>i.Key.Space&&this._startEditing(!1,e)&&t.activeEditor){var o=t.activeEditor;if(o&&"checkbox"!=o.type){var n=t.selection,r=t.getCellData(n.row,n.col,!0),s=t.getCellData(n.row,n.col,!1);o.value=String.fromCharCode(e.charCode),i.isNumber(s)&&r.indexOf("%")>-1&&(o.value+="%"),i.setSelectionRange(o,1),o.dispatchEvent(t._edtHdl._evtInput),t._edtHdl._keypress(e),e.preventDefault()}}e.stopPropagation()}},e.prototype._moveSel=function(e,t,i){this._g.selectionMode!=z.None&&this._g._selHdl.moveSelection(e,t,i)},e.prototype._deleteSel=function(e){var t=this._g,i=t.editableCollectionView,o=t.selection,n=t.rows,r=[],s=new g,l=new h(t.cells,s,e),a=z;if(t.allowDelete&&!t.isReadOnly&&(null==i||i.canRemove&&!i.isAddingNew&&!i.isEditingItem))switch(t.selectionMode){case a.CellRange:if(0==o.leftCol&&o.rightCol==t.columns.length-1)for(c=o.topRow;c>-1&&c<=o.bottomRow;c++)r.push(n[c]);break;case a.ListBox:for(c=0;c<n.length;c++)n[c].isSelected&&r.push(n[c]);break;case a.Row:o.topRow>-1&&r.push(n[o.topRow]);break;case a.RowRange:for(var c=o.topRow;c>-1&&c<=o.bottomRow;c++)r.push(n[c])}if(r.length>0){if(t.deferUpdate(function(){i&&i.beginUpdate();for(var e=r.length-1;e>=0;e--){var o=r[e];s.setRange(o.index,-1),t.onDeletingRow(l)&&(i&&o.dataItem?i.remove(o.dataItem):t.rows.removeAt(o.index),t.onDeletedRow(l))}i&&i.endUpdate()}),t.selectionMode==a.ListBox){var u=t.selection.row;u>-1&&u<t.rows.length&&(t.rows[u].isSelected=!0)}return t.childItemsPath&&t.collectionView&&t.collectionView.refresh(),!0}if(!t.isReadOnly&&0==r.length){var d=!1,p=t.scrollPosition;return t.deferUpdate(function(){for(var e=o.topRow;e<=o.bottomRow;e++){var n=t.rows[e];if(!n.isReadOnly)for(var r=o.leftCol;r<=o.rightCol;r++){var a=t._getBindingColumn(t.cells,e,t.columns[r]);a.getIsRequired()||a.isReadOnly||t.getCellData(e,r,!0)&&(s.setRange(e,r),l.cancel=!1,t.onBeginningEdit(l)&&(i&&(d||(d=!0,i.beginUpdate()),i.editItem(n.dataItem),t._edtHdl._edItem=i.currentEditItem),t.setCellData(e,r,"",!0,!1),t.onCellEditEnding(l),t.onCellEditEnded(l)))}}t.selection=o,t.scrollPosition=p,d&&i.endUpdate()}),!0}return!1},e.prototype._startEditing=function(e,t,i,o){return this._g._edtHdl.startEditing(e,i,o,!0,t)},e}();t._KeyboardHandler=T;var D;!function(e){e[e.None=0]="None",e[e.Columns=1]="Columns",e[e.Rows=2]="Rows",e[e.Both=3]="Both",e[e.ColumnsAllCells=4|e.Columns]="ColumnsAllCells",e[e.RowsAllCells=4|e.Rows]="RowsAllCells",e[e.BothAllCells=4|e.Both]="BothAllCells"}(D=t.AllowResizing||(t.AllowResizing={}));var O;!function(e){e[e.None=0]="None",e[e.Headers=1]="Headers",e[e.Cells=2]="Cells",e[e.Both=3]="Both"}(O=t.AutoSizeMode||(t.AutoSizeMode={}));var j;!function(e){e[e.None=0]="None",e[e.Columns=1]="Columns",e[e.Rows=2]="Rows",e[e.Both=3]="Both"}(j=t.AllowDragging||(t.AllowDragging={}));var L=function(){function e(e){var t=this;this._tsLast=0;var o=e.hostElement;this._g=e,this._dvMarker=i.createElement('<div class="wj-marker">&nbsp;</div>'),e.addEventListener(o,"mousedown",function(o){if(e._rcBounds=null,!o.defaultPrevented&&0==o.button){e.containsFocus()||e._setFocusNoScroll(e._eFocus),setTimeout(function(){o.defaultPrevented||e.focus()});var s=o.target;if(!e.activeEditor&&e._isInputElement(s)){if(i.getActiveElement()!=s&&"OPTION"!=s.tagName){var l=e.hitTest(o);switch(l.cellType){case c.Cell:e.select(l.range);break;case c.ColumnHeader:case c.ColumnFooter:e.scrollIntoView(-1,l.col);break;case c.RowHeader:e.scrollIntoView(l.row,-1)}s.focus()}return}var a=i.closest(o.target,".wj-flexgrid");a&&a!=e.hostElement||t._isDown||(t._isDown=!0,e.addEventListener(document,"mousemove",n),e.addEventListener(document,"mouseup",r),t._mousedown(o))}});var n=function(e){t._mousemove(e)},r=function(i){t._isDown=!1,e.removeEventListener(document,"mousemove"),e.removeEventListener(document,"mouseup"),t._mouseup(i)};e.addEventListener(o,"mouseup",function(e){t._tsLast=Date.now()}),e.addEventListener(o,"mouseenter",function(t){e._rcBounds=null}),e.addEventListener(o,"mousemove",this._hover.bind(this)),e.addEventListener(o,"dblclick",this._dblclick.bind(this)),e.addEventListener(o,"click",this._click.bind(this)),e.addEventListener(o,"selectstart",function(t){e._isInputElement(t.target)||t.preventDefault()}),e.addEventListener(o,"wheel",function(t){var o=e.cells.hostElement.parentElement,n=t.deltaY;if(n&&!t.ctrlKey&&!t.metaKey&&o.scrollHeight>o.offsetHeight&&i.closest(t.target,".wj-flexgrid")==e.hostElement){switch(t.deltaMode){case 1:o.scrollTop+=e.rows.defaultSize*(n<0?-1:1);break;case 2:o.scrollTop+=o.clientHeight*(n<0?-1:1);break;case 0:default:i.isSafari()&&(n=i.clamp(n,-150,150)),o.scrollTop+=n}t.preventDefault(),t.stopImmediatePropagation()}}),e.addEventListener(o,"dragstart",this._dragstart.bind(this)),e.addEventListener(o,"dragover",this._dragover.bind(this)),e.addEventListener(o,"dragleave",this._dragover.bind(this)),e.addEventListener(o,"drop",this._drop.bind(this)),e.addEventListener(o,"dragend",this._dragend.bind(this)),this._enableTouchResizing()}return e.prototype.resetMouseState=function(){this._dragSource&&i.removeClass(this._dragSource,"wj-state-dragsrc"),this._showDragMarker(null);var e=this._g.hostElement;e&&(e.style.cursor="");var t=this._g;t.removeEventListener(document,"mousemove"),t.removeEventListener(document,"mouseup"),this._tsLast=Date.now(),this._eMouse=null,this._isDown=null,this._htDown=null,this._lbSelRows=null,this._szRowCol=null,this._szArgs=null,this._dragSource=null},e.prototype._enableTouchResizing=function(){var e=this,t=this._g,o=t.hostElement,n="ontouchstart"in window?["touchstart","touchmove","touchend"]:"onpointerdown"in window?["pointerdown","pointermove","pointerup"]:null;n&&(t.addEventListener(o,n[0],function(n){if((null==n.pointerType||"touch"==n.pointerType)&&!i.closest(n.target,".wj-elem-filter")){var r=i.closest(n.target,".wj-cell");r instanceof HTMLElement&&(t._rcBounds=null,e._htDown=null,e._hover(n),e._szRowCol&&(r.removeAttribute("draggable"),o.style.touchAction="none",e._mousedown(n),n.preventDefault()))}}),t.addEventListener(o,n[1],function(t){null!=t.pointerType&&"touch"!=t.pointerType||e._szRowCol&&(e._mousemove(t),t.preventDefault())}),t.addEventListener(o,n[2],function(t){if(i.Control._touching=!1,(null==t.pointerType||"touch"==t.pointerType)&&e._szRowCol){if(e._szArgs)e._finishResizing(e._eMouse);else{var n=i.closest(t.target,".wj-cell");n instanceof HTMLElement&&n.click()}e.resetMouseState(),o.style.touchAction=""}}))},e.prototype._mousedown=function(e){var t=this._g,o=t.hitTest(e),n=o.cellType,r=e.ctrlKey||e.metaKey;if(this._selDown=t.selection,o.panel==t.cells){if(i.closestClass(e.target,d._WJC_DROPDOWN))return e.preventDefault(),void t._edtHdl._toggleListBox(e,o.range);if(t.editRange&&t.editRange.contains(o.range))return}var s=i.getActiveElement();if(e.target!=s||!t._isInputElement(e.target))if(n!=c.None){if(this._htDown=o,this._eMouse=e,null!=this._szRowCol)return t._eFocus.tabIndex=0,t._eFocus.focus(),void this._handleResizing(e);switch(n){case c.Cell:r&&t.selectionMode==z.ListBox&&this._startListBoxSelection(o.row),this._mouseSelect(e,e.shiftKey);break;case c.RowHeader:0==(this._g.allowDragging&j.Rows)&&(r&&t.selectionMode==z.ListBox&&this._startListBoxSelection(o.row),this._mouseSelect(e,e.shiftKey))}if(n==c.Cell&&t.rows.maxGroupLevel>-1&&i.closestClass(e.target,d._WJC_COLLAPSE)){var l=i.tryCast(t.rows[o.row],m);if(l)return r?t.collapseGroupsToLevel(l.isCollapsed?l.level+1:l.level):l.isCollapsed=!l.isCollapsed,void this.resetMouseState()}}else t._edtHdl._commitRowEdits()},e.prototype._mousemove=function(e){if(null!=this._htDown){if(0==e.buttons&&this._eMouse&&e.timeStamp-this._eMouse.timeStamp>600)return void this.resetMouseState();if(this._eMouse=e,this._szRowCol)this._handleResizing(e);else switch(this._htDown.cellType){case c.Cell:this._mouseSelect(e,!0);break;case c.RowHeader:0==(this._g.allowDragging&j.Rows)&&this._mouseSelect(e,!0)}}},e.prototype._mouseup=function(e){if(!this._g.isTouching||!(this._dragSource||e.target instanceof HTMLHtmlElement)){var t=this._g,i=t.hitTest(e),o=this._htDown,n=z;if(o&&!e.defaultPrevented)if(this._szArgs)this._finishResizing(e);else if(o.panel!=t.topLeftCells||this._szArgs)o.panel!=t.columnHeaders||e.dataTransfer?o.panel==t.cells&&(e.ctrlKey||e.metaKey||e.shiftKey||i.panel==o.panel&&i.range.equals(o.range)&&t.selection.equals(this._selDown)&&t._edtHdl.startEditing(!0,i.row,i.col,!0,e)):i.panel==o.panel&&i.col==o.col&&!i.edgeRight&&i.col>-1&&this._clickSort(e,i);else if(i.panel==o.panel&&i.row==o.row&&i.col==o.col&&t.rows.length&&t.columns.length)switch(t.selectionMode){case n.CellRange:case n.RowRange:case n.ListBox:t.select(new g(0,0,t.rows.length-1,t.columns.length-1))}this.resetMouseState()}},e.prototype._click=function(e){Date.now()-this._tsLast>50&&!e.pointerType&&this._handleClick(e)},e.prototype._handleClick=function(e){var t=this._g,o=e.target,n=new b(o,null);if(!e.defaultPrevented&&n.grid==t&&!t._isInputElement(o))if(n.panel==t.topLeftCells)t.select(new g(0,0,t.rows.length-1,t.columns.length-1));else if(n.panel==t.columnHeaders)this._clickSort(e,n);else if(n.panel==t.rowHeaders)t.select(new g(n.row,0,n.row,t.columns.length-1));else if(n.panel==t.cells)if(n.row<0)this._clickSort(e,n);else if(i.closestClass(o,d._WJC_COLLAPSE)){var r=t.rows[n.row];r instanceof m&&(e.ctrlKey?t.collapseGroupsToLevel(r.isCollapsed?r.level+1:r.level):r.isCollapsed=!r.isCollapsed)}else i.closestClass(o,d._WJC_DROPDOWN)?t._edtHdl._toggleListBox(e,n.range):t.select(n.range)},e.prototype._clickSort=function(e,t){var o=this._g,n=o.collectionView,r=e.ctrlKey||e.metaKey;if(n&&n.canSort&&o.allowSorting){var s=t.range.bottomRow,a=t.panel.columns[t.col],h=o._getBindingColumn(t.panel,t.row,a);if(!(s>-1&&s!=o._getSortRowIndex()&&a==h)&&h.allowSorting&&h.binding){for(var c=t.grid.collectionView.sortDescriptions,u=null,d=0;d<c.length;d++)if(c[d].property==h.binding){u=!c[d].ascending;break}if(null==u){if(r)return;u=!0}var g=new l(t.panel,t.range);o.onSortingColumn(g)&&(o._edtHdl._commitRowEdits(),r?c.clear():c.splice(0,c.length,new i.SortDescription(h._getBindingSort(),u)),o.onSortedColumn(g))}}},e.prototype._dblclick=function(e){var t,i=this._g,o=i.hitTest(e),n=o.cellType,r=i.selection,s=o.range;if(!e.defaultPrevented)if(o.edgeRight&&i.allowResizing&D.Columns){if(n==c.ColumnHeader||n==c.Cell&&4&i.allowResizing){e.preventDefault(),e.ctrlKey&&r.containsColumn(o.col)&&(s=r);for(var a=s.leftCol;a<=s.rightCol;a++)i.columns[a].allowResizing&&(t=new l(i.cells,new g(-1,a)),i.onAutoSizingColumn(t)&&i.onResizingColumn(t)&&(i.autoSizeColumn(a),i.onResizedColumn(t),i.onAutoSizedColumn(t)))}else n==c.TopLeft&&o.panel.columns[o.col].allowResizing&&(e.preventDefault(),t=new l(o.panel,new g(-1,o.col)),i.onAutoSizingColumn(t)&&i.onResizingColumn(t)&&(i.autoSizeColumn(o.col,!0),i.onAutoSizedColumn(t),i.onResizedColumn(t)));this.resetMouseState()}else if(o.edgeBottom&&i.allowResizing&D.Rows){if(n==c.RowHeader||n==c.Cell&&4&i.allowResizing){e.ctrlKey&&r.containsRow(o.row)&&(s=r);for(var h=s.topRow;h<=s.bottomRow;h++)i.rows[h].allowResizing&&(t=new l(i.cells,new g(h,-1)),i.onAutoSizingRow(t)&&i.onResizingRow(t)&&(i.autoSizeRow(h),i.onResizedRow(t),i.onAutoSizedRow(t)))}else n==c.TopLeft&&o.panel.rows[o.row].allowResizing&&(t=new l(o.panel,new g(o.row,-1)),i.onAutoSizingRow(t)&&i.onResizingRow(t)&&(i.autoSizeRow(o.row,!0),i.onResizedRow(t),i.onAutoSizedRow(t)));this.resetMouseState()}else;},e.prototype._hover=function(e){if(null==this._htDown){var t=this._g,i=t.hitTest(e),o=(i.panel,i.cellType),n="";return this._szRowCol=null,(o==c.ColumnHeader||o==c.TopLeft||o==c.Cell&&4&t.allowResizing)&&i.edgeRight&&0!=(t.allowResizing&D.Columns)&&(this._szRowCol=this._getResizeCol(i)),(o==c.RowHeader||o==c.TopLeft||o==c.Cell&&4&t.allowResizing)&&i.edgeBottom&&0!=(t.allowResizing&D.Rows)&&(this._szRowCol=this._getResizeRow(i)),this._szRowCol instanceof _?n="col-resize":this._szRowCol instanceof w&&(n="row-resize"),this._szStart=this._szRowCol?this._szRowCol.renderSize:0,t.hostElement.style.cursor=n,i}return null},e.prototype._getResizeCol=function(e){for(var t=e.panel.columns,i=t[e.col],o=e.col+1;o<t.length;o++)if((n=t[o]).visible){n.size<1&&(i=n);break}if(e.col==t.length-1&&(e.cellType==c.TopLeft||e.cellType==c.RowHeader)){t=this._g.columns;for(o=0;o<t.length;o++){var n=t[o];if(n.visible){n.size<1&&(i=n);break}}}return i.allowResizing?i:null},e.prototype._getResizeRow=function(e){for(var t=e.panel.rows,i=t[e.row],o=e.row+1;o<t.length;o++)if((n=t[o]).visible){n.size<1&&(i=n);break}if(e.row==t.length-1&&(e.cellType==c.TopLeft||e.cellType==c.ColumnHeader)){t=this._g.rows;for(o=0;o<t.length;o++){var n=t[o];if(n.visible){n.size<1&&(i=n);break}}}return i.allowResizing?i:null},e.prototype._mouseSelect=function(e,t){var o=this,n=this._g;if(this._htDown&&this._htDown.panel&&n.selectionMode!=z.None){var r=new b(this._htDown.panel,e);this._handleSelection(r,t),!i.isIE9()&&e.button>=0&&e.target!=n._root&&(r=new b(n,e)).cellType!=c.Cell&&r.cellType!=c.RowHeader&&setTimeout(function(){o._mouseSelect(o._eMouse,t)},100)}},e.prototype._handleResizing=function(t){if(t.preventDefault(),this._szRowCol instanceof _){var o=this._g,n=i.mouseToPage(t).x,r=Math.round(Math.max(e._SZ_MIN,this._szStart+(n-this._htDown.point.x)*(o.rightToLeft?-1:1)));if(this._szRowCol.renderSize!=r){if(null==this._szArgs){a=o.rowHeaders.columns.indexOf(this._szRowCol)>-1?o.rowHeaders:o.cells;this._szArgs=new l(a,new g(-1,this._szRowCol.index))}this._szArgs.cancel=!1,o.onResizingColumn(this._szArgs)&&(o.deferResizing?this._showResizeMarker(r):this._szRowCol.width=r)}}if(this._szRowCol instanceof w){var o=this._g,s=i.mouseToPage(t).y,r=Math.round(Math.max(e._SZ_MIN,this._szStart+(s-this._htDown.point.y)));if(this._szRowCol.renderSize!=r){if(null==this._szArgs){var a=o.columnHeaders.rows.indexOf(this._szRowCol)>-1?o.columnHeaders:o.cells;this._szArgs=new l(a,new g(this._szRowCol.index,-1))}this._szArgs.cancel=!1,o.onResizingRow(this._szArgs)&&(o.deferResizing?this._showResizeMarker(r):this._szRowCol.height=r)}}},e.prototype._dragstart=function(e){var t=this._g,o=this._htDown;if(o){if(this._dragSource=null,!this._szRowCol){var n=new l(o.panel,o.range);if(o.cellType==c.ColumnHeader&&t.allowDragging&j.Columns&&o.col>-1&&t.columns[o.col].allowDragging)t.onDraggingColumn(n)?this._dragSource=e.target:e.preventDefault();else if(o.cellType==c.RowHeader&&t.allowDragging&j.Rows&&o.row>-1&&t.rows[o.row].allowDragging){var r=t.rows[o.row];r instanceof m||r instanceof N||(t.onDraggingRow(n)?this._dragSource=e.target:e.preventDefault())}}this._dragSource&&e.dataTransfer&&!e.defaultPrevented&&(i._startDrag(e.dataTransfer,"move"),e.stopPropagation(),i.addClass(this._dragSource,"wj-state-dragsrc"),t.beginUpdate(),this._updating=!0)}},e.prototype._dragend=function(e){this._updating&&(this._g.endUpdate(),this._updating=!1),this.resetMouseState()},e.prototype._dragover=function(e){var t=this._g,i=t.hitTest(e),o=!1,n=new l(t.cells,i.range);this._htDown&&i.cellType==this._htDown.cellType&&(i.cellType==c.ColumnHeader?(n.cancel=!t.columns.canMoveElement(this._htDown.col,i.col),o=t.onDraggingColumnOver(n)):i.cellType==c.RowHeader&&(n.cancel=!t.rows.canMoveElement(this._htDown.row,i.row),o=t.onDraggingRowOver(n))),o?(e.dataTransfer.dropEffect="move",this._showDragMarker(i),e.preventDefault(),e.stopPropagation()):this._showDragMarker(null)},e.prototype._drop=function(e){var t=this._g,i=t.hitTest(e),o=new l(t.cells,i.range);if(this._htDown&&i.cellType==this._htDown.cellType){var n=t.selection;i.cellType==c.ColumnHeader?(t.columns.moveElement(this._htDown.col,i.col),t.select(n.row,i.col),t.onDraggedColumn(o)):i.cellType==c.RowHeader&&(t.rows.moveElement(this._htDown.row,i.row),t.select(i.row,n.col),t.onDraggedRow(o))}this.resetMouseState()},e.prototype._showResizeMarker=function(e){var t=this._g,o=this._dvMarker;o.parentElement||t.cells.hostElement.appendChild(o);var n,r=this._szArgs.panel.cellType;this._szRowCol instanceof _?(n={display:"",left:this._szRowCol.pos+e-1,top:-1e3,right:"",bottom:0,width:3,height:""},t.rightToLeft&&(n.left=t.cells.hostElement.clientWidth-n.left-n.width),r!=c.TopLeft&&r!=c.RowHeader||(n.left-=t.topLeftCells.hostElement.offsetWidth)):(n={left:-1e3,top:this._szRowCol.pos+e-1,right:0,bottom:"",width:"",height:3},r!=c.TopLeft&&r!=c.ColumnHeader||(n.top-=t.topLeftCells.hostElement.offsetHeight)),i.setCss(o,n)},e.prototype._showDragMarker=function(e){var t=this._g,o=this._dvMarker;if(!e)return o.parentElement&&o.parentElement.removeChild(o),void(this._rngTarget=null);if(!e.range.equals(this._rngTarget)){this._rngTarget=e.range,o.parentElement||e.panel.hostElement.appendChild(o);var n={display:"",left:0,top:0,width:6,height:6};switch(e.cellType){case c.ColumnHeader:n.height=e.panel.height;var r=t.columns[e.col];n.left=r.pos-n.width/2,e.col>this._htDown.col&&(n.left+=r.renderWidth),t.rightToLeft&&(n.left=o.parentElement.clientWidth-n.left-n.width);break;case c.RowHeader:n.width=e.panel.width;var s=t.rows[e.row];n.top=s.pos-n.height/2,e.row>this._htDown.row&&(n.top+=s.renderHeight)}i.setCss(o,n)}},e.prototype._finishResizing=function(t){var o=this._g,n=o.selection,r=this._szArgs,s=this._eMouse&&this._eMouse.ctrlKey;if(r&&!r.cancel){if(r.col>-1){var a=r.col,h=i.mouseToPage(t).x,u=Math.round(Math.max(e._SZ_MIN,this._szStart+(h-this._htDown.point.x)*(this._g.rightToLeft?-1:1)));if(r.panel.columns[a].width=Math.round(u),o.onResizedColumn(r),s&&this._htDown.cellType==c.ColumnHeader&&n.containsColumn(a))for(var d=n.leftCol;d<=n.rightCol;d++)o.columns[d].allowResizing&&d!=a&&(r=new l(o.cells,new g(-1,d)),o.onResizingColumn(r)&&(o.columns[d].size=o.columns[a].size,o.onResizedColumn(r)))}if(r.row>-1){var a=r.row,p=i.mouseToPage(t).y,u=Math.round(Math.max(e._SZ_MIN,this._szStart+(p-this._htDown.point.y)));if(r.panel.rows[a].height=Math.round(u),o.onResizedRow(r),s&&this._htDown.cellType==c.RowHeader&&n.containsRow(a))for(var f=n.topRow;f<=n.bottomRow;f++)o.rows[f].allowResizing&&f!=a&&(r=new l(o.cells,new g(f,-1)),o.onResizingRow(r)&&(o.rows[f].size=o.rows[a].size,o.onResizedRow(r)))}}},e.prototype._startListBoxSelection=function(e){var t=this._g.rows;this._lbSelState=!t[e].isSelected,this._lbSelRows={};for(var i=0;i<t.length;i++)t[i].isSelected&&(this._lbSelRows[i]=!0)},e.prototype._handleSelection=function(e,t){var i=this._g,o=i.rows,n=i._selHdl.selection,r=new g(e.row,e.col);if(e.row>-1&&e.col>-1)if(null!=this._lbSelRows){var s=!1;r=new g(e.row,e.col,this._htDown.row,this._htDown.col);for(var a=0;a<o.length;a++){var h=r.containsRow(a)?this._lbSelState:null!=this._lbSelRows[a];if(h!=o[a].isSelected){var u=new l(i.cells,new g(a,n.col,a,n.col2));i.onSelectionChanging(u)&&(o[a]._setFlag(p.Selected,h,!0),s=!0,i.onSelectionChanged(u))}}s&&i.refreshCells(!1,!0,!0),i.scrollIntoView(e.row,e.col)}else e.cellType==c.RowHeader&&(r.col=0,r.col2=i.columns.length-1),t&&(r.row2=n.row2,r.col2=n.col2),i.select(r)},e._SZ_MIN=0,e}();t._MouseHandler=L;var I=function(){function e(e){var t=this;this._fullEdit=!1,this._list=null,this._g=e,this._evtInput=document.createEvent("HTMLEvents"),this._evtInput.initEvent("input",!0,!1),e.selectionChanging.addHandler(function(i,o){if(t.finishEditing()){var n=e._selHdl.selection.row;if(n!=o.row){var r=e.rows.length;(n>-1&&n<r?e.rows[n].dataItem:null)!=(o.row>-1&&o.row<r?e.rows[o.row].dataItem:null)&&t._commitRowEdits()}}else o.cancel=!0}),e.lostFocus.addHandler(function(){if(!e.containsFocus()){var o=i.getActiveElement();o&&"fixed"==getComputedStyle(o).position||t._commitRowEdits()}}),e.addEventListener(e.hostElement,"mousedown",function(o){if(!o.defaultPrevented&&0==o.button&&!e._mouseHdl._szRowCol){e.selection;var n=e.hitTest(o);if(n.cellType!=c.Cell&&n.cellType!=c.None)t.finishEditing();else if(n.cellType!=c.None){var r=i.tryCast(o.target,HTMLInputElement);t._isNativeCheckbox(r)&&(r!=t.activeEditor&&(o.preventDefault(),t.startEditing(!1,n.row,n.col,!0,o)&&(r=t.activeEditor)),!r||"checkbox"!=r.type||r.disabled||r.readOnly||(r.checked=!r.checked,r.focus(),t.finishEditing()))}}},!0),e.addEventListener(e.hostElement,"click",function(e){t._isNativeCheckbox(e.target)&&e.preventDefault()})}return e.prototype.startEditing=function(e,t,o,n,r){void 0===e&&(e=!0);var s=this._g;if(t=i.asNumber(t,!0,!0),o=i.asNumber(o,!0,!0),null==t&&(t=s.selection.row),null==o&&(o=s.selection.col),null==n&&(n=!0),!this._allowEditing(t,o))return!1;var a=s.getMergedRange(s.cells,t,o,!1);a||(a=new g(t,o));var h=s.rows[t].dataItem;if(s.select(a,!0),!s.rows[t]||h!=s.rows[t].dataItem)return!1;if(a.equals(this._rng))return!0;if(this.activeEditor&&!this.finishEditing())return!1;var c=new l(s.cells,a,r);if(!s.onBeginningEdit(c))return!1;var u=s.editableCollectionView,d=!1;u&&((d=(h=s.rows[t].dataItem)!=u.currentEditItem)&&s.onRowEditStarting(c),u.editItem(h),d&&(s.onRowEditStarted(c),this._edItem=h)),this._fullEdit=i.asBoolean(e),this._rng=a,this._list=null;var p=s.columns[o].dataMap;p&&(this._list=p.getDisplayValues(h)),a.isSingleCell?this._updateEditorCell(t,o,d):s.refresh(!1);var f=this._edt;if(f){if("checkbox"==f.type)this._fullEdit=!1;else if(n){if(i.isNumber(s.getCellData(t,o,!1))&&f.value.indexOf("%")>-1){for(var _=f.value,w=0,m=_.length;m>0&&"%"==_[m-1];)m--;for(;w<m&&"%"==_[w];)w++;i.setSelectionRange(f,w,m)}else i.setSelectionRange(f,0,f.value.length);f.focus()}if(s.onPrepareCellForEdit(c),f.disabled||f.readOnly)return!1}return null!=f&&!f.disabled&&!f.readOnly},e.prototype.finishEditing=function(e){void 0===e&&(e=!1);var t=this._edt;if(!t)return this._removeListBox(),!0;var o=this._g,n=this._rng,r=new h(o.cells,n),s=o.containsFocus(),l=o.hostElement.querySelector(".wj-control.wj-state-focused");if(l){var a=i.Control.getControl(l);a&&a.onLostFocus(r)}if(r.cancel=e,!e&&o.validateEdits){var c=this._getValidationError();if(c){r.cancel=!0;var u=t.parentElement;u&&(i.toggleClass(u,"wj-state-invalid",!0),u.title=c,r.stayInEditMode=!0)}}if(!o.onCellEditEnding(r)&&r.stayInEditMode)return s?setTimeout(function(){t.select()}):t.select(),!1;if(!r.cancel){r.data=o.cells.getCellData(n.topRow,n.leftCol,!1);for(var d=o.cellFactory.getEditorValue(o),g=n.topRow;g<=n.bottomRow&&g<o.rows.length;g++)for(var p=n.leftCol;p<=n.rightCol&&p<o.columns.length;p++)o.cells.setCellData(g,p,d,!0,!1)}this._edt=null,this._rng=null,this._list=null,this._removeListBox();var f=i.closest(t,".wj-cell");return i.contains(f,i.getActiveElement())&&f.focus(),r.cancel?this._updateEditorCell(n.row,n.col,!1):o.refresh(!1),s&&o.focus(),o.onCellEditEnded(r),!0},Object.defineProperty(e.prototype,"activeEditor",{get:function(){return this._edt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editRange",{get:function(){return this._rng},enumerable:!0,configurable:!0}),e.prototype.getClipString=function(e){var t=this._g,o="",n=!0,r=z;if(!e)switch(e=t.selection,t.selectionMode){case r.Row:case r.RowRange:e.col=0,e.col2=t.columns.length-1;break;case r.ListBox:e.col=0,e.col2=t.columns.length-1;for(var s=0;s<t.rows.length;s++)t.rows[s].isSelected&&t.rows[s].isVisible&&(e.row=e.row2=s,o&&(o+="\n"),o+=this.getClipString(e));return o}for(var l=(e=i.asType(e,g)).topRow;l<=e.bottomRow;l++)if(t.rows[l].isVisible){n||(o+="\n"),n=!1;for(var a=e.leftCol,h=!0;a<=e.rightCol;a++)if(t.columns[a].isVisible){h||(o+="\t"),h=!1;var c=t.cells.getCellData(l,a,!0).toString();(c=c.replace(/\t/g," ")).indexOf("\n")>-1&&(c='"'+c.replace(/"/g,'""')+'"'),o+=c}}return o},e.prototype.setClipString=function(e,t){var o=this,n=this._g,r=null==t,s=z;if(!t)switch(t=n.selection,n.selectionMode){case s.Row:case s.RowRange:case s.ListBox:t.col=0,t.col2=n.columns.length-1}t=i.asType(t,g);var a=this._parseClipString(i.asString(e));r&&!t.isSingleCell&&a.length&&this._expandClipRows(a,t);var h,c=new g(t.topRow,t.leftCol),u=n.editableCollectionView,d=t.topRow,p=!1;n.deferUpdate(function(){u&&u.beginUpdate();for(var e=0;e<a.length&&d<n.rows.length;e++,d++)if(n.rows[d].isVisible)for(var i=a[e],r=t.leftCol,s=0;s<i.length&&r<n.columns.length;s++,r++)n.columns[r].isVisible?o._allowEditing(d,r)&&(h=new l(n.cells,new g(d,r),i[s]),n.onPastingCell(h)&&(u&&(u.editItem(n.rows[d].dataItem),o._edItem=u.currentEditItem),n.cells.setCellData(d,r,h.data)&&(n.onPastedCell(h),p=!0)),c.row2=Math.max(c.row2,d),c.col2=Math.max(c.col2,r)):s--;else e--;u&&u.endUpdate(),n.select(c)})},e.prototype._isNativeCheckbox=function(e){return e instanceof HTMLInputElement&&"checkbox"==e.type&&!e.disabled&&!e.readOnly&&i.hasClass(e,"wj-cell-check")&&i.closest(e,".wj-flexgrid")==this._g.hostElement},e.prototype._parseClipString=function(e){var t=[];e=(e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")).replace(/\n+$/g,"");var i=0,o=0;for(i=0;i<e.length;i++){var n='"'==e[i]&&e[i+1]>=" ",r=!1,s=!1;for(o=i;o<e.length&&!s;o++){var l=e[o];switch(l){case'"':n&&(r=!r);break;case"\t":case"\n":r||(this._parseClipCell(t,e,i,o,"\n"==l),i=o,s=!0)}}if(o==e.length){this._parseClipCell(t,e,i,e.length,!1);break}}return 0==t.length&&t.push([""]),t},e.prototype._parseClipCell=function(e,t,i,o,n){e.length||e.push([]);var r=t.substr(i,o-i),s=r.length;s>1&&'"'==r[0]&&'"'==r[s-1]&&(r=(r=r.substr(1,s-2)).replace(/""/g,'"')),e[e.length-1].push(r),n&&e.push([])},e.prototype._expandClipRows=function(e,t){for(var i=e.length,o=0,n=0;n<i;n++)o=Math.max(o,e[n].length);for(var r=this._g,s=0,l=0,a=t.topRow;a<=t.bottomRow;a++)r.rows[a].isVisible&&s++;for(h=t.leftCol;h<=t.rightCol;h++)r.columns[h].isVisible&&l++;if((s>1||l>1)&&(1==s&&(s=i),1==l&&(l=o),l%o==0&&s%i==0)){for(var h=o;h<l;h++)for(a=0;a<i;a++)e[a].push(e[a%i][h%o]);for(a=i;a<s;a++)e.push(e[a%i])}},e.prototype._updateEditorCell=function(e,t,i){var o=this._g,n=o.cells.getCellElement(e,t),s=o._useFrozenDiv()&&(e<o.frozenRows||t<o.frozenColumns);if(!n||s||o._hasPendingUpdates())o.refresh(!1);else if(this._updateCell(n),(i=i||o._getHasValidation())&&o.headersVisibility&r.Row){var l=o.rowHeaders,a=l.columns.length-1,h=l.getCellElement(e,a);h&&this._updateCell(h)}},e.prototype._updateCell=function(e){var t=new b(e,null);t.panel&&(e.classList.add(s._WJS_UPDATING),t.grid.cellFactory.updateCell(t.panel,t.row,t.col,e,t.range),e.classList.remove(s._WJS_UPDATING))},e.prototype._getValidationError=function(){var e=this._g;if(e._getHasValidation()){var t=this._rng.row,i=this._rng.col,o=e.cellFactory.getEditorValue(e),n=e.getCellData(t,i,!1);if(e.setCellData(t,i,o,!0,!1)){var r=e._getError(e.cells,t,i);return e.setCellData(t,i,n,!0,!1),r}}return null},e.prototype._allowEditing=function(e,t){var i=this._g;if(i.isReadOnly||i.selectionMode==z.None)return!1;if(e<0||e>=i.rows.length||i.rows[e].isReadOnly||!i.rows[e].isVisible)return!1;if(t<0||t>=i.columns.length)return!1;var o=i._getBindingColumn(i.cells,e,i.columns[t]);return!(!o||o.isReadOnly||!o.isVisible)},e.prototype._commitRowEdits=function(){var e=this._g;if(this.finishEditing()&&this._edItem){var t=e.editableCollectionView;if(t&&t.currentEditItem){var i=new l(e.cells,e.selection);e.onRowEditEnding(i),t.commitEdit(),e.onRowEditEnded(i)}this._edItem=null}},e.prototype._keydown=function(e){switch(e.keyCode){case i.Key.F2:return this._fullEdit=!this._fullEdit,e.preventDefault(),!0;case i.Key.F4:return this._toggleListBox(e),e.preventDefault(),!0;case i.Key.Space:var t=this._edt;return!t||"checkbox"!=t.type||t.disabled||t.readOnly||(t.checked=!t.checked,this.finishEditing(),e.preventDefault()),!0;case i.Key.Enter:case i.Key.Tab:return e.preventDefault(),!this.finishEditing();case i.Key.Escape:return e.preventDefault(),this.finishEditing(!0),!0;case i.Key.Up:case i.Key.Down:case i.Key.Left:case i.Key.Right:case i.Key.PageUp:case i.Key.PageDown:case i.Key.Home:case i.Key.End:if(this._lbx)return this._keydownListBox(e);if(e.altKey)switch(e.keyCode){case i.Key.Up:case i.Key.Down:return this._toggleListBox(e),e.preventDefault(),!0}if(!this._fullEdit&&this.finishEditing())return!1}return!0},e.prototype._keydownListBox=function(e){var t=!0;if(this._lbx)switch(e.keyCode){case i.Key.Up:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex>0&&this._lbx.selectedIndex--;break;case i.Key.Down:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex++;break;case i.Key.Home:case i.Key.PageUp:this._lbx.selectedIndex=0;break;case i.Key.End:case i.Key.PageDown:this._lbx.selectedIndex=this._lbx.collectionView.items.length-1;break;default:t=!1}return!!t&&(e.preventDefault(),!0)},e.prototype._keypress=function(e){var t=this._edt;if(t&&"checkbox"!=t.type&&this._list&&this._list.length>0&&e.charCode>=32){var o=t.selectionStart,n=t.value.substr(0,o);e.target==t&&(o++,n+=String.fromCharCode(e.charCode)),n=n.toLowerCase();for(var r=0;r<this._list.length;r++)if(0==this._list[r].toLowerCase().indexOf(n)){t.value=this._list[r],i.setSelectionRange(t,o,this._list[r].length),t.dispatchEvent(this._evtInput),e.preventDefault();break}}},e.prototype._toggleListBox=function(e,t){var i=this._g,o=i._selHdl.selection;if(t||(t=o),this._lbx&&(this._removeListBox(),o.contains(t)))return i.activeEditor?i.activeEditor.focus():i.containsFocus()||i.focus(),!0;var r=i.isTouching,s=i._getBindingColumn(i.cells,t.row,i.columns[t.col]);return!(!n()||!s.dataMap||!1===s.showDropDown)&&(!(!n()||!this.startEditing(!0,t.row,t.col,!r,e))&&(this._lbx=this._createListBox(),this._lbx.showSelection(),r&&this._lbx.focus(),!0))},e.prototype._createListBox=function(){var e=this,t=this._g,o=this._rng,r=t.rows[o.row],s=t._getBindingColumn(t.cells,o.row,t.columns[o.col]),l=document.createElement("div"),a=new(n().ListBox)(l);this._removeListBox(),l.classList.add("wj-dropdown-panel","wj-grid-listbox"),a.maxHeight=4*r.renderHeight,a.isContentHtml=s.isContentHtml,a.itemsSource=s.dataMap.getDisplayValues(r.dataItem),a.selectedValue=t.activeEditor?t.activeEditor.value:t.getCellData(o.row,o.col,!0),i.addClass(l,s.dropDownCssClass),a.addEventListener(a.hostElement,"click",function(){e._removeListBox(),t.focus(),e.finishEditing()}),a.lostFocus.addHandler(function(){e._removeListBox()}),a.selectedIndexChanged.addHandler(function(){var o=t.activeEditor;o&&(o.value=e._lbx.selectedValue,o.dispatchEvent(e._evtInput),i.setSelectionRange(o,0,o.value.length))});var h=t.cells.getCellElement(o.row,o.col);return h?i.showPopup(l,h,!1,!1,!1):(i.showPopup(l,t.getCellBoundingRect(o.row,o.col)),l[i.Control._OWNR_KEY]=t.hostElement),a},e.prototype._removeListBox=function(){this._lbx&&(i.hidePopup(this._lbx.hostElement,!0),this._lbx.dispose(),this._lbx=null)},e}();t._EditHandler=I;var A=function(){function e(e){this._nrt=new N,this._g=e,this._keydownBnd=this._keydown.bind(this),this._attach()}return Object.defineProperty(e.prototype,"newRowAtTop",{get:function(){return this._top},set:function(e){e!=this.newRowAtTop&&(this._top=i.asBoolean(e),this.updateNewRowTemplate())},enumerable:!0,configurable:!0}),e.prototype.updateNewRowTemplate=function(){var e=this._g,t=e.editableCollectionView,i=e.rows,o=t&&t.canAddNew&&e.allowAddNew&&!e.isReadOnly,n=i.indexOf(this._nrt),r=this._top?0:i.length-1,s=!1;if(!o&&n>-1){var l=e.selection;l.row==n&&e.select(l.row-1,l.col),i.removeAt(n)}else o&&(n<0?s=!0:n!=r&&(i.removeAt(n),s=!0),s&&(this._top?i.insert(0,this._nrt):i.push(this._nrt)),this._nrt&&this._nrt._setFlag(p.ParentCollapsed,!1))},e.prototype._attach=function(){var e=this._g;e&&(e.beginningEdit.addHandler(this._beginningEdit,this),e.pastingCell.addHandler(this._beginningEdit,this),e.rowEditEnded.addHandler(this._rowEditEnded,this),e.loadedRows.addHandler(this.updateNewRowTemplate,this),e.hostElement.addEventListener("keydown",this._keydownBnd,!0))},e.prototype._detach=function(){var e=this._g;e&&(e.beginningEdit.removeHandler(this._beginningEdit),e.pastingCell.removeHandler(this._beginningEdit),e.rowEditEnded.removeHandler(this._rowEditEnded),e.loadedRows.removeHandler(this.updateNewRowTemplate),e.hostElement.removeEventListener("keydown",this._keydownBnd,!0))},e.prototype._keydown=function(e){e.defaultPrevented||e.keyCode!=i.Key.Escape||null==this._g.activeEditor&&this._top&&this._nrt.dataItem&&(this._nrt.dataItem=null,this._g.invalidate())},e.prototype._beginningEdit=function(e,t){if(!t.cancel){var o=this._g.rows[t.row];if(i.tryCast(o,N)){var n=this._g.editableCollectionView;if(n&&n.canAddNew)if(this._top){if(null==this._nrt.dataItem){var r=null,s=n.sourceCollection,l=n.newItemCreator;r=i.isFunction(l)?l():s&&s.length?new s[0].constructor:{},this._nrt.dataItem=r}}else{r=n.currentAddItem&&n.currentAddItem==o.dataItem?n.currentAddItem:n.addNew();n.moveCurrentTo(r),this.updateNewRowTemplate(),this._g.refresh(!0),this._g.onRowAdded(t),t.cancel&&n.cancelNew()}}}},e.prototype._rowEditEnded=function(e,t){var i=this,o=this._g.editableCollectionView,n=this._nrt.dataItem;if(o)if(o.isAddingNew)o.commitNew();else if(n&&!t.cancel){this._nrt.dataItem=null;var r=o.addNew();for(var s in n)r[s]=n[s];this._g.onRowAdded(t),t.cancel?o.cancelNew():o.commitNew(),setTimeout(function(){i._g.select(0,i._g.columns.firstVisibleIndex),i.updateNewRowTemplate()},20)}},e}();t._AddNewHandler=A;var N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(w);t._NewRowTemplate=N;var k=function(){function e(t){this._g=t,this._tbx=i.createElement('<input class="wj-grid-editor wj-form-control wj-grid-ime"/>'),i.setCss(this._tbx,e._cssHidden),t.cells.hostElement.parentElement.appendChild(this._tbx),this._updateImeFocus();var o=t.hostElement;t.addEventListener(this._tbx,"compositionstart",this._compositionstart.bind(this)),t.addEventListener(o,"blur",this._updateImeFocus.bind(this),!0),t.addEventListener(o,"focus",this._updateImeFocus.bind(this),!0),t.addEventListener(o,"mousedown",this._mousedown.bind(this),!0),t.addEventListener(o,"mouseup",this._mouseup.bind(this),!0),t.cellEditEnded.addHandler(this._cellEditEnded,this),t.selectionChanged.addHandler(this._updateImeFocus,this)}return e.prototype.dispose=function(){var e=this._g,t=e.hostElement;e.removeEventListener(this._tbx,"compositionstart"),e.removeEventListener(t,"blur"),e.removeEventListener(t,"focus"),e.removeEventListener(t,"mousedown"),e.removeEventListener(t,"mouseup"),e.cellEditEnded.removeHandler(this._cellEditEnded),e.selectionChanged.removeHandler(this._updateImeFocus),this._tbx.parentElement&&this._tbx.parentElement.removeChild(this._tbx)},e.prototype._cellEditEnded=function(){i.setCss(this._tbx,e._cssHidden),this._tbx.value=""},e.prototype._compositionstart=function(){var e=this,t=this._g;if(null==t.activeEditor){var o=t._selHdl.selection;if(t.startEditing(!1,o.row,o.col,!1)){o=t.editRange;var n=t.cells.hostElement,r=t.columns[o.col].pos+n.offsetLeft,s=t.rows[o.row].pos+n.offsetTop,l=t.getCellBoundingRect(o.row,o.col);if(!o.isSingleCell){var a=t.cells.getCellElement(o.row,o.col);l.width=a.offsetWidth,l.height=a.offsetHeight}o.row<t.frozenRows&&(s+=n.parentElement.scrollTop),o.col<t.frozenColumns&&(r+=n.parentElement.scrollLeft);var h=t.activeEditor,c=h&&h.parentElement?h.parentElement.style.zIndex:"";i.setCss(this._tbx,{position:"absolute",pointerEvents:"",opacity:"",left:r,top:s,width:l.width-1,height:l.height-1,zIndex:c}),h instanceof HTMLInputElement&&["minLength","maxLength","pattern"].forEach(function(t){i.setAttribute(e._tbx,t,h.getAttribute(t))}),t._edtHdl._edt=this._tbx}}},e.prototype._mousedown=function(e){this._mouseDown=!0,this._updateImeFocus()},e.prototype._mouseup=function(e){this._mouseDown=!1,this._updateImeFocus()},e.prototype._updateImeFocus=function(){var e=this._g,t=i.getActiveElement();if(!e.activeEditor&&!e.isTouching&&!this._mouseDown&&i.contains(e.hostElement,t)){var o=this._tbx;this._enableIme()?t!=o&&(o.disabled=!1,o.select()):o.disabled=!0}},e.prototype._enableIme=function(){var e=this._g,t=e.selection,o=t.isValid?e._getBindingColumn(e.cells,t.row,e.columns[t.col]):null;return!!e.canEditCell(t.row,t.col)&&!(!o||o.dataType==i.DataType.Boolean)},e._cssHidden={position:"fixed",pointerEvents:"none",opacity:0,left:-10,top:-10,width:0},e}();t._ImeHandler=k});