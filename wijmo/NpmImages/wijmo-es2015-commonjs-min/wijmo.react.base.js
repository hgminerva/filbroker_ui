/*!
    *
    * Wijmo Library 5.20192.631
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("wijmo/wijmo"),ReactDOM=require("react-dom"),React=require("react");class ComponentBase extends React.Component{constructor(e,t,i){super(e),this._beforeRender=new wijmo_1.Event,this._afterRender=new wijmo_1.Event,this._beforeWillUnmount=new wijmo_1.Event,this._afterWillUnmount=new wijmo_1.Event,this._objPropHash={},this._isMounted=!1,this._mountedCBs=[],this.props=e,this.controlType=t;for(let e of i&&i.objectProps||[])this._objPropHash[e]=!0}render(){this._onBeforeRender();const e=this._renderImpl();return this._onAfterRender(),e}componentDidMount(){if(this._isChild()){let e=this.props[ComponentBase._propsParent];e&&e._mountedCB(()=>{this._setParent(e)})}else this._prepareControl();return this.control}componentWillUnmount(){this._onBeforeWillUnmount(),this._siblingInsertedEH&&this._getElement().removeEventListener("DOMNodeInserted",this._siblingInsertedEH);let e=this.control;if(e)if(this._isChild()){let t=this._getParentProp();if(t){let i=this.parent.control[t];if(wijmo_1.isArray(i)){let t=i.indexOf(e);t>-1&&i.splice(t,1)}}}else e instanceof wijmo_1.Control&&setTimeout(()=>{e.hostElement&&e.dispose()});this._onAfterWillUnmount()}shouldComponentUpdate(e){var t=this.control;return this._copy(t,e,this.props),!0}_mountedCB(e){this._isMounted?e():this._mountedCBs.push(e)}_renderImpl(){let e={};e[ComponentBase._propsParent]=this;let t=React.Children.map(this.props.children,t=>React.cloneElement(t,e));return React.createElement("div",this._isChild()?{style:{display:"none"}}:null,t)}_onBeforeRender(e){this._beforeRender.raise(this,e)}_onAfterRender(e){this._afterRender.raise(this,e)}_onBeforeWillUnmount(e){this._beforeWillUnmount.raise(this,e)}_onAfterWillUnmount(e){this._afterWillUnmount.raise(this,e)}_createControl(){let e=this._isChild()?this._isParentInCtor()?this.parent.control:void 0:this._getElement();return new this.controlType(e)}_prepareControl(){let e=this.control=this._createControl(),t=this._getElement(),i=this.props,n=e instanceof wijmo_1.Control,s=ComponentBase;this._siblingId||(null==this.constructor[s._typeSiblingIdProp]&&(this.constructor[s._typeSiblingIdProp]=++s._siblingDirId+""),this._siblingId=this.constructor[s._typeSiblingIdProp]),t.setAttribute(s._typeSiblingIdProp,this._siblingId);var r={};for(var o in i)if(!this._ignoreProp(o))if(o in e)r[o]=i[o];else switch(o){case"className":wijmo_1.addClass(t,i.className);break;case"style":wijmo_1.setCss(t,i.style);break;default:null!=t[o]&&(t[o]=i[o])}n?e.initialize(r):this._copy(e,r,null,!0),this._isMounted=!0;let l=this._mountedCBs;this._mountedCBs=[];for(let e of l)e();wijmo_1.isFunction(i.initialized)&&i.initialized(e)}_initParent(){let e=this._getParentProp();if(e){let t=this.parent.control,i=t[e];if(wijmo_1.isArray(i)){let e=this._getSiblingIndex();(e<0||e>=i.length)&&(e=i.length),i.splice(e,0,this.control),this._siblingInsertedEH=this._siblingInserted.bind(this),this._getElement().addEventListener("DOMNodeInserted",this._siblingInsertedEH)}else t[e]=this.control}}_setParent(e){if(e!==this.parent){if(this.parent)throw"Wijmo child component is already attached to a different parent.";this.parent=e,this._prepareControl(),this._initParent()}}_isChild(){return null!=this._parentProp||null!=this._parentInCtor}_isParentInCtor(){return!0===this._parentInCtor}_getParentProp(){return this.props.wjProperty||this._parentProp}_getSiblingIndex(){var e=this._getElement(),t=e.parentElement;if(!t)return-1;for(var i=t.childNodes,n=-1,s=this._siblingId,r=0;r<i.length;r++){var o=i[r];if(1==o.nodeType&&o.getAttribute(ComponentBase._typeSiblingIdProp)==s&&(++n,o===e))return n}return-1}_siblingInserted(e){if(e.target===this._getElement()){var t=this._getSiblingIndex(),i=this.control,n=this.parent.control[this._getParentProp()],s=n.indexOf(i);t>=0&&s>=0&&t!==s&&(n.splice(s,1),t=Math.min(t,n.length),n.splice(t,0,i))}}_copy(e,t,i,n=!1){if(!e||!t)return;let s,r=e===this.control;for(var o in t)if(!this._ignoreProp(o)||!r){var l=t[o];if(o in e){if(this._isEvent(e,o))n&&wijmo_1.isFunction(l)&&e[o].addHandler(l);else if(!(i&&this._sameValue(i[o],l)||this._sameValue(e[o],l)))if(null==l)e[o]=l;else if(wijmo_1.isPrimitive(l)||wijmo_1.isFunction(l)||this._objPropHash[o]&&e===(s||(s=this.control)))e[o]=l;else if(wijmo_1.isArray(l)&&wijmo_1.isArray(e[o])){let t=e[o],i=l;if(i.length==t.length)for(var h=0;h<i.length;h++)this._copy(t[h],i[h])}else wijmo_1.isObject(l)&&this._copy(e[o],t[o])}else"className"==o?e.hostElement&&wijmo_1.addClass(e.hostElement,t[o]):"style"==o&&e.hostElement&&wijmo_1.setCss(e.hostElement,t[o])}}_sameValue(e,t){return e==t||wijmo_1.DateTime.equals(e,t)}_isEvent(e,t){let i=e&&e[t];return null!=i&&i instanceof wijmo_1.Event}_getElement(){return ReactDOM.findDOMNode(this)}_ignoreProp(e){return"children"===e}}ComponentBase._propsParent="$parent",ComponentBase._typeSiblingIdProp="_wjSiblingIdProp",ComponentBase._siblingDirId=0,exports.ComponentBase=ComponentBase;