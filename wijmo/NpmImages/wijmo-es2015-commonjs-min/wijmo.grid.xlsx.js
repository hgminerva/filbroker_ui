/*!
    *
    * Wijmo Library 5.20192.631
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("wijmo/wijmo"),wijmo_grid_1=require("wijmo/wijmo.grid"),mXlsx=require("wijmo/wijmo.xlsx"),selfModule=require("wijmo/wijmo.grid.xlsx");function softDetail(){return wijmo_1._getModule("wijmo.grid.detail")}function softMultiRow(){return wijmo_1._getModule("wijmo.grid.multirow")}exports.softDetail=softDetail,exports.softMultiRow=softMultiRow;class FlexGridXlsxConverter{static save(e,l,t){var o=this._saveFlexGridToWorkbook(e,l);return t&&o.save(t),o}static saveAsync(e,l,t,o,r){var s=this._saveFlexGridToWorkbook(e,l);return t&&s.saveAsync(t,o,r),s}static load(e,l,t){if(l instanceof Blob){var o=new FileReader;o.onload=(()=>{var l=mXlsx.Workbook._base64EncArr(new Uint8Array(o.result)),r=new mXlsx.Workbook;r.load(l),l=null,e.deferUpdate(()=>{this._loadToFlexGrid(e,r,t),r=null})}),o.readAsArrayBuffer(l)}else if(l instanceof mXlsx.Workbook)e.deferUpdate(()=>{this._loadToFlexGrid(e,l,t),l=null});else{if(l instanceof ArrayBuffer)l=mXlsx.Workbook._base64EncArr(new Uint8Array(l));else if(!wijmo_1.isString(l))throw"Invalid workbook.";var r=new mXlsx.Workbook;r.load(l),l=null,e.deferUpdate(()=>{this._loadToFlexGrid(e,r,t),r=null})}}static loadAsync(e,l,t,o,r){if(l instanceof Blob){var s=new FileReader;s.onload=(()=>{var l=mXlsx.Workbook._base64EncArr(new Uint8Array(s.result)),i=new mXlsx.Workbook;i.loadAsync(l,r=>{l=null,i=null,e.deferUpdate(()=>{this._loadToFlexGrid(e,r,t),o&&o(r),r=null})},r)}),s.readAsArrayBuffer(l)}else if(l instanceof mXlsx.Workbook)e.deferUpdate(()=>{this._loadToFlexGrid(e,l,t),o&&o(l),l=null});else{if(l instanceof ArrayBuffer)l=mXlsx.Workbook._base64EncArr(new Uint8Array(l));else if(!wijmo_1.isString(l))throw"Invalid workbook.";(new mXlsx.Workbook).loadAsync(l,r=>{l=null,e.deferUpdate(()=>{this._loadToFlexGrid(e,r,t),o&&o(r),r=null})},r)}}static _saveFlexGridToWorkbook(e,l){var t,o,r,s,i,n,a,d,u,m,c,h,w,f,g=new mXlsx.Workbook,p=new mXlsx.WorkSheet,_=(new mXlsx.WorkbookStyle,new mXlsx.WorkbookFrozenPane),x=!l||null==l.includeColumnHeaders||l.includeColumnHeaders,b=!(!l||null==l.includeRowHeaders)&&l.includeRowHeaders,y=!l||null==l.includeCellStyles||l.includeCellStyles,C=l?l.activeWorksheet:null,k=l?l.includeColumns:null,v=l?l.formatItem:null,S=0,j=0,T=0,R=[];if(null==this.hasCssText&&(this.hasCssText="cssText"in document.body.style),m=e.wj_sheetInfo,p.name=l?l.sheetName:"",p.visible=!l||!1!==l.sheetVisible,m&&m.tables&&m.tables.length>0)for(var W=0;W<m.tables.length;W++)p.tables.push(m.tables[W]);if(n=[],m||!y&&!v||((c=document.createElement("div")).style.visibility="hidden",c.setAttribute(wijmo_grid_1.FlexGrid._WJS_MEASURE,"true"),e.hostElement.appendChild(c)),b){for(d=0,a=0;a<e.rowHeaders.rows.length;a++)if(!(e.rowHeaders.rows[a].renderSize<=0)){for(n[d]=[],u=0;u<e.rowHeaders.columns.length;u++)r=e._getBindingColumn(e.rowHeaders,a,e.rowHeaders.columns[u]),(s=this._getColumnSetting(r,u,e.columnHeaders.columns))&&(n[d][u]=s,0===d&&((i=new mXlsx.WorkbookColumn)._deserialize(s),p._addWorkbookColumn(i,u)));d++}T=u}if(e.columnHeaders.rows.length>0){for(d=0,a=0;a<e.columnHeaders.rows.length;a++)if(!(e.columnHeaders.rows[a].renderSize<=0)){n[d]||(n[d]=[]);for(let l=0,t=0;l<e.columnHeaders.columns.length;l++)r=e._getBindingColumn(e.columnHeaders,a,e.columnHeaders.columns[l]),(s=this._getColumnSetting(r,l,e.columnHeaders.columns))&&(n[d][T+l]=s,0===d&&(k&&!k(r)||((i=new mXlsx.WorkbookColumn)._deserialize(s),p._addWorkbookColumn(i,T+t++))));x&&(T=0,t={},o=new mXlsx.WorkbookRow,b&&(T=this._parseFlexGridRowToSheetRow(e.topLeftCells,t,a,0,n,y,c,R,!1,0,k,v)),this._parseFlexGridRowToSheetRow(e.columnHeaders,t,a,T,n,y,c,R,!1,0,k,v),t.cells.length>0&&(o._deserialize(t),p._addWorkbookRow(o,d))),d++}j=x?d:0}for(a=0;a<e.cells.rows.length;a++)T=0,t={},o=new mXlsx.WorkbookRow,(h=e.rows[a])instanceof wijmo_grid_1._NewRowTemplate||((w=h instanceof wijmo_grid_1.GroupRow)?S=wijmo_1.tryCast(h,wijmo_grid_1.GroupRow).level:e.rows.maxGroupLevel>-1&&(S=e.rows.maxGroupLevel+1),b&&(T=this._parseFlexGridRowToSheetRow(e.rowHeaders,t,a,0,n,y,c,R,w,S,k,v)),this._parseFlexGridRowToSheetRow(e.cells,t,a,T,n,y,c,R,w,S,k,v),t.cells.length>0&&(o._deserialize(t),p._addWorkbookRow(o,j+a)));for(f=e.cells.rows.length,a=0;a<e.columnFooters.rows.length;a++)T=0,t={},o=new mXlsx.WorkbookRow,w=(h=e.columnFooters.rows[a])instanceof wijmo_grid_1.GroupRow,b&&(T=this._parseFlexGridRowToSheetRow(e.rowHeaders,t,a,0,n,y,c,R,w,0,k,v)),this._parseFlexGridRowToSheetRow(e.columnFooters,t,a,T,n,y,c,R,w,0,k,v),t.cells.length>0&&(o._deserialize(t),p._addWorkbookRow(o,j+f+a));return _.rows=x?e.frozenRows+j:e.frozenRows,_.columns=b?e.frozenColumns+T:e.frozenColumns,p.frozenPane=_,g._addWorkSheet(p),m||!y&&!v||(e.hostElement.removeChild(c),R.forEach(e=>e.forEach(e=>{e&&e.parentElement&&e.parentElement.removeChild(e)}))),g.activeWorksheet=C,g}static _loadToFlexGrid(e,l,t){t=t||{};let o,r=null!=e.wj_sheetInfo,s={},i=[],n=[],a={};e.itemsSource=null,e.columns.clear(),e.columnHeaders.rows.clear(),e.rows.clear(),e.frozenColumns=0,e.frozenRows=0;let d=null==t.sheetIndex||isNaN(t.sheetIndex)?0:t.sheetIndex;if(d<0||d>=l.sheets.length)throw"The sheet index option is out of the sheet range of current workbook.";if(null!=t.sheetName)for(let e=0;e<l.sheets.length;e++)if(t.sheetName===l.sheets[e].name){o=l.sheets[e];break}if(null==(o=o||l.sheets[d]).rows)return;let u=this._getColumnCount(o.rows),m=this._getRowCount(o.rows,u),c=o.columns;for(let l=0;l<u;l++)e.columns.push(new wijmo_grid_1.Column),c[l]&&(isNaN(+c[l].width)||(e.columns[l].width=+c[l].width),c[l].visible||null==c[l].visible||(e.columns[l].visible=!!c[l].visible),c[l].style&&c[l].style.wordWrap&&(e.columns[l].wordWrap=c[l].style.wordWrap));let h,w=(null==t.includeColumnHeaders||t.includeColumnHeaders)&&o.rows.length>0,f=w?this._getColumnHeadersHeight(o):0,g=!1,p=[];for(let l=f;l<m;l++){let t=!1,d=null,m=o.rows[l];if(m){let e=l+1;for(;e<o.rows.length;){let l=o.rows[e];if(l){(isNaN(m.groupLevel)&&!isNaN(l.groupLevel)||!isNaN(m.groupLevel)&&m.groupLevel<l.groupLevel)&&(t=!0);break}e++}}if(t&&!o.summaryBelow)h&&(h.isCollapsed=g),(h=new wijmo_grid_1.GroupRow).isReadOnly=!1,g=null!=m.collapsed&&m.collapsed,h.level=isNaN(m.groupLevel)?0:m.groupLevel,a[h.level]=g,this._checkParentCollapsed(a,h.level)&&h._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,!0),e.rows.push(h);else{let l=new wijmo_grid_1.Row;m&&this._checkParentCollapsed(a,m.groupLevel)&&l._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,!0),e.rows.push(l)}m&&m.height&&!isNaN(m.height)&&(e.rows[l-f].height=m.height);for(let o=0;o<u;o++)if(m){let a=m.cells[o],c=a?a.formula:null;c&&"="!==c[0]&&(c="="+c),a&&a.textRuns&&a.textRuns.length>0?(e.rows[l-f].isContentHtml=!0,e.setCellData(l-f,o,this._parseTextRunsToHTML(a.textRuns))):e.setCellData(l-f,o,c&&r?c:this._getItemValue(a)),t||this._setColumn(p,o,a);let h,w=l*u+o,g=a?a.style:null,_=mXlsx.Workbook._parseExcelFormat(a);if(g){if(d=null==d?!!g.wordWrap:d&&!!g.wordWrap,g.hAlign)h=mXlsx.Workbook._parseHAlignToString(wijmo_1.asEnum(g.hAlign,mXlsx.HAlign));else switch(this._getItemType(a)){case wijmo_1.DataType.Number:h="right";break;case wijmo_1.DataType.Boolean:h="center";break;default:h=_&&0===_.search(/[n,c,p]/i)?"right":"left"}s[w]={fontWeight:g.font&&g.font.bold?"bold":"none",fontStyle:g.font&&g.font.italic?"italic":"none",textDecoration:g.font&&g.font.underline?"underline":"none",textAlign:h,fontFamily:g.font&&g.font.family?g.font.family:"",fontSize:g.font&&g.font.size?g.font.size+"px":"",color:g.font&&g.font.color?g.font.color:"",backgroundColor:g.fill&&g.fill.color?g.fill.color:"",whiteSpace:g.wordWrap?"pre-wrap":"normal",format:_},g.borders&&(g.borders.left&&(this._parseBorderStyle(g.borders.left.style,"Left",s[w]),s[w].borderLeftColor=g.borders.left.color),g.borders.right&&(this._parseBorderStyle(g.borders.right.style,"Right",s[w]),s[w].borderRightColor=g.borders.right.color),g.borders.top&&(this._parseBorderStyle(g.borders.top.style,"Top",s[w]),s[w].borderTopColor=g.borders.top.color),g.borders.bottom&&(this._parseBorderStyle(g.borders.bottom.style,"Bottom",s[w]),s[w].borderBottomColor=g.borders.bottom.color)),g.font&&-1===n.indexOf(g.font.family)&&n.push(g.font.family)}a&&wijmo_1.isNumber(a.rowSpan)&&a.rowSpan>0&&wijmo_1.isNumber(a.colSpan)&&a.colSpan>0&&(a.rowSpan>1||a.colSpan>1)&&i.push(new wijmo_grid_1.CellRange(l,o,l+a.rowSpan-1,o+a.colSpan-1))}m&&(this._checkParentCollapsed(a,m.groupLevel)||m.visible||null==m.visible||(e.rows[l-f].visible=m.visible),e.rows[l-f].wordWrap=!!m.style&&!!m.style.wordWrap||!!d)}if(h&&(h.isCollapsed=g),o.frozenPane){let l=o.frozenPane.columns;wijmo_1.isNumber(l)&&!isNaN(l)&&(e.frozenColumns=l);let t=o.frozenPane.rows;wijmo_1.isNumber(t)&&!isNaN(t)&&(e.frozenRows=w&&t>0?t-1:t)}for(let l=0;l<e.columnHeaders.columns.length;l++){let t=p[l],o=e.columns[l];o.isRequired=!1,t&&(t.dataType===wijmo_1.DataType.Boolean&&(o.dataType=t.dataType),o.format=t.format,o.align=t.hAlign,o.wordWrap=o.wordWrap||!!t.wordWrap)}for(let l=0;l<Math.max(f,1);l++)e.columnHeaders.rows.push(new wijmo_grid_1.Row);let _=Object.keys(o.rows);for(let l=0;l<f;l++)for(let t=0;t<o.columns.length;t++){let r=o.rows[_[l]].cells[t],s=r&&r.value||"",i=e.columnHeaders.columns[t];if(s){let e=mXlsx.Workbook._parseExcelFormat(r);s=wijmo_1.Globalize.format(s,e)}i.header=i.header||s,e.columnHeaders.setCellData(l,t,s)}if(r){let l=null==t.sheetVisible||t.sheetVisible;e.wj_sheetInfo.name=o.name,e.wj_sheetInfo.visible=!0===l||!1!==o.visible,e.wj_sheetInfo.styledCells=s,e.wj_sheetInfo.mergedRanges=i,e.wj_sheetInfo.fonts=n,e.wj_sheetInfo.tables=o.tables}}static _getColumnHeadersHeight(e){if(!e&&!e.rows.length)return 0;let l=1;for(var t=0;t<e.rows.length;t++){var o=e.rows[t];if(o){o.cells.forEach(e=>{l=Math.max(l,e.rowSpan||0)});break}}return l}static _escapePlainText(e){return""===e?"'":e&&"'"===e[0]?"'"+e:e}static _parseFlexGridRowToSheetRow(e,l,t,o,r,s,i,n,a,d,u,m){var c,h,w,f,g,p,_,x,b,y,C,k,v,S,j,T,R,W,X,A,F,H,D,B,N,E,I,M,G,z,L=!1,O=!1;for((X=(c=e.grid).wj_sheetInfo)&&(A=X.evaluateFormula),null==(h=e.rows[t]).recordIndex?(B=0,e.cellType===wijmo_grid_1.CellType.ColumnHeader&&e.rows.length>1&&(B=t===r.length?t-1:t)):B=h.recordIndex,l.cells||(l.cells=[]),l.visible=h.isVisible,l.height=h.renderHeight||e.rows.defaultSize,l.groupLevel=d,a&&(l.collapsed=h.isCollapsed),h.wordWrap&&(l.style={wordWrap:h.wordWrap}),(h.constructor===wijmo_grid_1.Row||h.constructor===wijmo_grid_1._NewRowTemplate||softDetail()&&h.constructor===softDetail().DetailRow||softMultiRow()&&h.constructor===softMultiRow()._MultiRow)&&(L=!0),softDetail()&&h.constructor===softDetail().DetailRow&&(O=!0),f=0;f<e.columns.length;f++)if(g=null,W=1,R=1,G=0,D=!1,j=null,I=null,E=null,x=null,H=c._getBindingColumn(e,t,e.columns[f]),T=null,X&&e===c.cells?(S=t*e.columns.length+f,X.mergedRanges&&(T=this._getMergedRange(t,f,X.mergedRanges)),X.styledCells&&(j=X.styledCells[S])):s&&(E=this._getMeasureCell(e,f,i,n),j=(T=c.getMergedRange(e,t,f,!1))?this._getCellStyle(e,E,T.bottomRow,T.rightCol)||{}:this._getCellStyle(e,E,t,f)||{}),T||(T=c.getMergedRange(e,t,f,!1)),T?t===T.topRow&&f===T.leftCol&&(R=T.bottomRow-T.topRow+1,W=this._getColSpan(e,T,u),D=!0):D=!0,!u||u(H)){if(w=r[B]?r[B][f+o]:null,L||a?(_=D?e.getCellData(t,f,!0):null,b=D?e.getCellData(t,f,!1):null,C=!1,v=null,_&&wijmo_1.isString(_)&&_.length>1&&"="===_[0]&&(C=!0),F=wijmo_1.isDate(b),j&&j.format&&null!=b?(g=j.format,/[hsmyt\:]/i.test(g)&&(F=!0),p=mXlsx.Workbook._parseCellFormat(j.format,F)):w&&w.style&&w.style.format?(g=H.format,p=w.style.format):p=null,C&&null!=A&&wijmo_1.isFunction(A)&&(v=A(_)),p||(F?p="m/d/yyyy":wijmo_1.isNumber(b)&&!H.dataMap?p=wijmo_1.isInt(b)?"#,##0":"#,##0.00":C?(k=_.toLowerCase()).indexOf("now()")>-1?(p="m/d/yyyy h:mm",F=!0):k.indexOf("today()")>-1||k.indexOf("date(")>-1?(p="m/d/yyyy",F=!0):k.indexOf("time(")>-1&&(p="h:mm AM/PM",F=!0):p="General")):(_=D?c.columnHeaders.getCellData(0,f,!0):null,p="General"),wijmo_1.isString(_)&&-1!==_.indexOf("<span")&&(x=this._parseToTextRuns(_),_=null),I=this._parseCellStyle(j)||{},e===c.cells&&a&&h.hasChildren&&f===c.columns.firstVisibleIndex){if(C&&null!=v?y=v:_?y=_:D&&(y=h.getGroupHeader().replace(/<\/?\w+>/g,"").replace(/&#39;/g,"'")),null==y&&!j)continue;!(F=wijmo_1.isDate(y))&&g&&"d"===g.toLowerCase()&&wijmo_1.isInt(y)&&(p="0"),y=wijmo_1.isString(y)?mXlsx.Workbook._unescapeXML(y):y,f===c.columns.firstVisibleIndex&&c.treeIndent&&(G=d),N={value:y,isDate:F,formula:C?this._parseToExcelFormula(_,F):null,colSpan:W,rowSpan:R,style:this._extend(I,{format:p,font:{bold:!0},hAlign:mXlsx.HAlign.Left,indent:G}),textRuns:x}}else _=wijmo_1.isString(_)?mXlsx.Workbook._unescapeXML(_):_,b=wijmo_1.isString(b)?mXlsx.Workbook._unescapeXML(b):b,!F&&g&&"d"===g.toLowerCase()&&wijmo_1.isInt(b)&&(p="0"),M=I&&I.hAlign?I.hAlign:w&&w.style&&null!=w.style.hAlign?wijmo_1.asEnum(w.style.hAlign,mXlsx.HAlign,!0):wijmo_1.isDate(b)?mXlsx.HAlign.Left:mXlsx.HAlign.General,f!==c.columns.firstVisibleIndex||!c.treeIndent||M!==mXlsx.HAlign.Left&&M!==mXlsx.HAlign.General||(G=d),N={value:C?v:"General"===p?this._escapePlainText(_):this._escapePlainText(b),isDate:F,formula:C?this._parseToExcelFormula(_,F):null,colSpan:f<c.columns.firstVisibleIndex?1:W,rowSpan:R,style:this._extend(I,{format:p,hAlign:M,vAlign:R>1?e===c.cells||!1===c.centerHeadersVertically?mXlsx.VAlign.Top:mXlsx.VAlign.Center:null,indent:G}),textRuns:x},O&&(z=e.getCellElement(t,f))&&z.appendChild(h.detail);m&&m(new XlsxFormatItemEventArgs(e,new wijmo_grid_1.CellRange(t,f),E,i,n,N)),l.cells.push(N)}return o+f}static _parseCellStyle(e,l=!1){if(null==e)return null;var t=e.fontSize;t=t?+t.substring(0,t.indexOf("px")):null,isNaN(t)&&(t=null);var o=e.fontWeight;o="bold"===o||+o>=700;var r="italic"===e.fontStyle,s=e.textDecorationStyle;null==s&&(s=e.textDecoration),s="underline"===s;var i=e.whiteSpace;return i=!!i&&i.indexOf("pre")>-1,{font:{bold:o,italic:r,underline:s,family:this._parseToExcelFontFamily(e.fontFamily),size:t,color:e.color},fill:{color:e.backgroundColor},borders:this._parseBorder(e,l),hAlign:mXlsx.Workbook._parseStringToHAlign(e.textAlign),wordWrap:i}}static _parseBorder(e,l){var t={};return t.left=this._parseEgdeBorder(e,"Left"),t.right=this._parseEgdeBorder(e,"Right"),t.top=this._parseEgdeBorder(e,"Top"),t.bottom=this._parseEgdeBorder(e,"Bottom"),l&&(t.vertical=this._parseEgdeBorder(e,"Vertical"),t.horizontal=this._parseEgdeBorder(e,"Horizontal")),t}static _parseEgdeBorder(e,l){var t,o=e["border"+l+"Style"],r=e["border"+l+"Width"];if(r&&r.length>2&&(r=+r.substring(0,r.length-2)),o&&"none"!==o&&"hidden"!==o){switch(t={},o=o.toLowerCase()){case"dotted":t.style=r>1?mXlsx.BorderStyle.MediumDashDotted:mXlsx.BorderStyle.Dotted;break;case"dashed":t.style=r>1?mXlsx.BorderStyle.MediumDashed:mXlsx.BorderStyle.Dashed;break;case"double":t.style=mXlsx.BorderStyle.Double;break;default:t.style=r>2?mXlsx.BorderStyle.Thick:r>1?mXlsx.BorderStyle.Medium:mXlsx.BorderStyle.Thin}t.color=e["border"+l+"Color"]}return t}static _parseBorderStyle(e,l,t){var o="border"+l+"Style",r="border"+l+"Width";switch(e){case mXlsx.BorderStyle.Dotted:case mXlsx.BorderStyle.Hair:t[o]="dotted",t[r]="1px";break;case mXlsx.BorderStyle.Dashed:case mXlsx.BorderStyle.ThinDashDotDotted:case mXlsx.BorderStyle.ThinDashDotted:t[o]="dashed",t[r]="1px";break;case mXlsx.BorderStyle.MediumDashed:case mXlsx.BorderStyle.MediumDashDotDotted:case mXlsx.BorderStyle.MediumDashDotted:case mXlsx.BorderStyle.SlantedMediumDashDotted:t[o]="dashed",t[r]="2px";break;case mXlsx.BorderStyle.Double:t[o]="double",t[r]="3px";break;case mXlsx.BorderStyle.Medium:t[o]="solid",t[r]="2px";break;default:t[o]="solid",t[r]="1px"}}static _parseToExcelFontFamily(e){var l;return e&&(l=e.split(","))&&l.length>0&&(e=l[0].replace(/\"|\'/g,"")),e}static _parseToExcelFormula(e,l){var t,o,r,s,i,n,a,d=/\"?\w+\"?\s*\,\s*\"(\w+)\"/i;if(t=e.match(/(floor|ceiling)\([+-]?\d+\.?\d*\)/gi))for(i=0;i<t.length;i++)a=(n=t[i]).substring(0,n.lastIndexOf(")"))+", 1)",e=e.replace(n,a);if(t=null,t=e.match(/text\(\"?\w+\"?\s*\,\s*\"\w+\"\)/gi))for(i=0;i<t.length;i++)(o=(n=t[i]).match(d))&&2===o.length&&(r=o[1],/^d{1,4}?$/.test(r)||(s=mXlsx.Workbook._parseCellFormat(r,l),a=n.replace(r,s),e=e.replace(n,a)));return e}static _parseToTextRuns(e){var l,t,o,r=e.split("<span "),s=[];for(l=0;l<r.length;l++)o=-1!==(t=r[l]).indexOf("</span>")?{text:t.substring(t.indexOf(">")+1,t.indexOf("</span>")),font:this._parseToTextRunFont(t.substring(t.indexOf('style="')+7,t.indexOf(';"')))}:{text:t},s.push(o);return s}static _parseToTextRunFont(e){var l,t,o,r,s,i,n,a,d,u=e.split(";");if(u.length>0){for(l=0;l<u.length;l++)if(2===(t=u[l].split(":")).length)switch(t[1]=t[1].trim(),t[0]){case"font-size":i=+t[1].substring(0,t[1].indexOf("px")),isNaN(i)&&(i=null);break;case"font-weight":o="bold"===t[1]||+t[1]>=700;break;case"font-style":r="italic"===t[1];break;case"text-decoration-style":case"text-decoration":s="underline"===t[1];break;case"font-family":n=this._parseToExcelFontFamily(t[1]);break;case"color":a=t[1]}d={bold:o,italic:r,underline:s,family:n,size:i,color:a}}return d}static _getMeasureCell(e,l,t,o){let r=o[e.cellType],s=r&&r[l],i=null==s;if(s){if(this.hasCssText){s.style;s.style.cssText="",s.style.visibility="hidden"}}else r||(o[e.cellType]=r=[]),r[l]=s=t.cloneNode();return!i&&s.parentElement||(e.hostElement.children.length>0?e.hostElement.children[0].appendChild(s):e.hostElement.appendChild(s)),s}static _getColumnSetting(e,l,t){let o=e;return null!=e.colspan&&(o=this._getRenderColumn(l,t)),o?{autoWidth:!0,width:o.renderWidth||t.defaultSize,visible:o.visible,style:{format:e.format?mXlsx.Workbook._parseCellFormat(e.format,e.dataType===wijmo_1.DataType.Date):"",hAlign:mXlsx.Workbook._parseStringToHAlign(this._toExcelHAlign(e.getAlignment())),wordWrap:e.wordWrap}}:null}static _toExcelHAlign(e){return(e=e?e.trim().toLowerCase():e)?e.indexOf("center")>-1?"center":e.indexOf("right")>-1||e.indexOf("end")>-1?"right":e.indexOf("justify")>-1?"justify":"left":e}static _getColumnCount(e){for(var l,t=0,o=0,r=0;r<e.length;r++)(l=e[r]&&e[r].cells?e[r].cells:[])&&l.length>0&&(o=l.length,wijmo_1.isInt(l[o-1].colSpan)&&l[o-1].colSpan>1&&(o=o+l[o-1].colSpan-1),o>t&&(t=o));return t}static _getRowCount(e,l){for(var t,o,r=e.length,s=r-1,i=0;i<l;i++)e:for(;s>=0;s--)if((o=((t=e[s])&&t.cells?t.cells:[])[i])&&(null!=o.value&&""!==o.value||wijmo_1.isInt(o.rowSpan)&&o.rowSpan>1)){wijmo_1.isInt(o.rowSpan)&&o.rowSpan>1&&s+o.rowSpan>r&&(r=s+o.rowSpan);break e}return r}static _numAlpha(e){var l=Math.floor(e/26)-1;return(l>-1?this._numAlpha(l):"")+String.fromCharCode(65+e%26)}static _getItemType(e){return null==e||null==e.value||isNaN(e.value)?null:wijmo_1.getType(e.value)}static _setColumn(e,l,t){var o,r,s,i=e[l];i?(o=this._getItemType(t),i.dataType!==o&&i.dataType===wijmo_1.DataType.Boolean&&o!==wijmo_1.DataType.Boolean&&(i.dataType=o),!t||null==t.value||wijmo_1.isString(t.value)&&wijmo_1.isNullOrWhiteSpace(t.value)||(r=mXlsx.Workbook._parseExcelFormat(t))&&i.format!==r&&"General"!==r&&(i.format=r),t&&t.style&&(t.style.hAlign&&(s=mXlsx.Workbook._parseHAlignToString(wijmo_1.asEnum(t.style.hAlign,mXlsx.HAlign))),null==i.wordWrap?i.wordWrap=!!t.style.wordWrap:i.wordWrap=i.wordWrap&&!!t.style.wordWrap),s||o!==wijmo_1.DataType.Number||(s="right"),i.hAlign=s):e[l]={dataType:this._getItemType(t),format:mXlsx.Workbook._parseExcelFormat(t),hAlign:"",wordWrap:null}}static _getItemValue(e){if(null==e||null==e.value)return null;var l=e.value;return wijmo_1.isString(l)&&"'"===l[0]&&(l=l.substr(1)),wijmo_1.isNumber(l)&&isNaN(l)?"":l instanceof Date&&isNaN(l.getTime())?"":l}static _getCellStyle(e,l,t,o){try{e.grid.cellFactory.updateCell(e,t,o,l),l.className=l.className.replace("wj-state-selected",""),l.className=l.className.replace("wj-state-multi-selected","")}catch(e){return null}return window.getComputedStyle(l)}static _parseTextRunsToHTML(e){var l,t,o,r;for(o="",r=0;r<e.length;r++)o+=(t=(l=e[r]).font)?'<span style="'+(t.bold?"font-weight: bold;":"")+(t.italic?"font-style: italic;":"")+(t.underline?"text-decoration: underline;":"")+(t.family?"font-family: "+t.family+";":"")+(null!=t.size?"font-size: "+t.size+"px;":"")+(t.color?"color: "+t.color+";":"")+'">'+l.text+"</span>":l.text;return o}static _extend(e,l){for(var t in l){var o=l[t];wijmo_1.isObject(o)&&e[t]?wijmo_1.copy(e[t],o):e[t]=o}return e}static _checkParentCollapsed(e,l){var t=!1;return Object.keys(e).forEach(o=>{!0===e[o]&&!1===t&&!isNaN(l)&&+o<l&&(t=!0)}),t}static _getColSpan(e,l,t){for(var o=0,r=l.leftCol;r<=l.rightCol;r++)t&&!t(e.columns[r])||o++;return o}static _getRenderColumn(e,l){return e>=l.length?null:l[e]}static _getMergedRange(e,l,t){let o,r;for(o=0;o<t.length;o++)if(e>=(r=t[o]).topRow&&e<=r.bottomRow&&l>=r.leftCol&&l<=r.rightCol)return r;return null}}exports.FlexGridXlsxConverter=FlexGridXlsxConverter;class XlsxFormatItemEventArgs extends wijmo_grid_1.CellRangeEventArgs{constructor(e,l,t,o,r,s){super(e,l),this._cell=t,this._patternCell=o,this._xlsxCell=s,this._cellsCache=r}get cell(){return this._cell}get xlsxCell(){return this._xlsxCell}set xlsxCell(e){this._xlsxCell=e}getFormattedCell(){return this._cell||(this._cell=FlexGridXlsxConverter._getMeasureCell(this.panel,this.col,this._patternCell,this._cellsCache),FlexGridXlsxConverter._getCellStyle(this.panel,this._cell,this.row,this.col)),this._cell}}exports.XlsxFormatItemEventArgs=XlsxFormatItemEventArgs,wijmo_1._registerModule("wijmo.grid.xlsx",selfModule);